=== RUN   TestAuthHandler_Login_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:16.850+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"30bd0f9eaba83feaadfd8c93de724a1c","trace_id":"30bd0f9eaba83feaadfd8c93de724a1c","span_id":"d726be04ee8c2dca","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"30bd0f9eaba83feaadfd8c93de724a1c","trace_id":"30bd0f9eaba83feaadfd8c93de724a1c","span_id":"d726be04ee8c2dca","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.850+0530","caller":"rest/auth_handler.go:95","message":"Login attempt started","request_id":"30bd0f9eaba83feaadfd8c93de724a1c","trace_id":"30bd0f9eaba83feaadfd8c93de724a1c","span_id":"d726be04ee8c2dca","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.851+0530","caller":"rest/auth_handler.go:149","message":"Login validation passed","request_id":"30bd0f9eaba83feaadfd8c93de724a1c","trace_id":"30bd0f9eaba83feaadfd8c93de724a1c","span_id":"d726be04ee8c2dca","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","email":"test@example.com","tenant_id":"tenant-123","tenant_name":"Test Tenant"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.867+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"30bd0f9eaba83feaadfd8c93de724a1c","trace_id":"30bd0f9eaba83feaadfd8c93de724a1c","span_id":"d726be04ee8c2dca","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"30bd0f9eaba83feaadfd8c93de724a1c","trace_id":"30bd0f9eaba83feaadfd8c93de724a1c","span_id":"d726be04ee8c2dca","user_id":"user-123","tenant_id":"tenant-123","auth_method":"password","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.867+0530","caller":"rest/auth_handler.go:187","message":"Business event","request_id":"30bd0f9eaba83feaadfd8c93de724a1c","trace_id":"30bd0f9eaba83feaadfd8c93de724a1c","span_id":"d726be04ee8c2dca","event_type":"user_login","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","tenant_name":"Test Tenant","tenant_plan":"pro","login_method":"password","roles":["user"],"duration_ms":16}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.867+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"30bd0f9eaba83feaadfd8c93de724a1c","trace_id":"30bd0f9eaba83feaadfd8c93de724a1c","span_id":"d726be04ee8c2dca","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"30bd0f9eaba83feaadfd8c93de724a1c","trace_id":"30bd0f9eaba83feaadfd8c93de724a1c","span_id":"d726be04ee8c2dca","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.017363125}
--- PASS: TestAuthHandler_Login_Success (0.02s)
=== RUN   TestAuthHandler_Login_InvalidEmail
{"level":"INFO","timestamp":"2025-06-26T12:40:16.867+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"9659f7f5b203b8de4b613f0ed840b51c","trace_id":"9659f7f5b203b8de4b613f0ed840b51c","span_id":"8a052f6874659c58","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"9659f7f5b203b8de4b613f0ed840b51c","trace_id":"9659f7f5b203b8de4b613f0ed840b51c","span_id":"8a052f6874659c58","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.867+0530","caller":"rest/auth_handler.go:95","message":"Login attempt started","request_id":"9659f7f5b203b8de4b613f0ed840b51c","trace_id":"9659f7f5b203b8de4b613f0ed840b51c","span_id":"8a052f6874659c58","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.867+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"9659f7f5b203b8de4b613f0ed840b51c","trace_id":"9659f7f5b203b8de4b613f0ed840b51c","span_id":"8a052f6874659c58","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"9659f7f5b203b8de4b613f0ed840b51c","trace_id":"9659f7f5b203b8de4b613f0ed840b51c","span_id":"8a052f6874659c58","user_id":"","tenant_id":"","auth_method":"password","reason":"validation_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:102\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:157\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.867+0530","caller":"rest/auth_handler.go:103","message":"Login validation failed","request_id":"9659f7f5b203b8de4b613f0ed840b51c","trace_id":"9659f7f5b203b8de4b613f0ed840b51c","span_id":"8a052f6874659c58","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","error":"Key: 'LoginRequest.Email' Error:Field validation for 'Email' failed on the 'email' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:103\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:157\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.867+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"9659f7f5b203b8de4b613f0ed840b51c","trace_id":"9659f7f5b203b8de4b613f0ed840b51c","span_id":"8a052f6874659c58","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"9659f7f5b203b8de4b613f0ed840b51c","trace_id":"9659f7f5b203b8de4b613f0ed840b51c","span_id":"8a052f6874659c58","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000214709}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.867+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"9659f7f5b203b8de4b613f0ed840b51c","trace_id":"9659f7f5b203b8de4b613f0ed840b51c","span_id":"8a052f6874659c58","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":75,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:157\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Login_InvalidEmail (0.00s)
=== RUN   TestAuthHandler_Login_MissingFields
{"level":"INFO","timestamp":"2025-06-26T12:40:16.867+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","trace_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","span_id":"605ba09932caa5db","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","trace_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","span_id":"605ba09932caa5db","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.867+0530","caller":"rest/auth_handler.go:95","message":"Login attempt started","request_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","trace_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","span_id":"605ba09932caa5db","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.867+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","trace_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","span_id":"605ba09932caa5db","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","trace_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","span_id":"605ba09932caa5db","user_id":"","tenant_id":"","auth_method":"password","reason":"validation_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:102\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:194\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.868+0530","caller":"rest/auth_handler.go:103","message":"Login validation failed","request_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","trace_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","span_id":"605ba09932caa5db","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","error":"Key: 'LoginRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:103\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:194\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.868+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","trace_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","span_id":"605ba09932caa5db","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","trace_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","span_id":"605ba09932caa5db","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000080542}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.868+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","trace_id":"bbc0ef71fb4e6d84cdf28652ecd4dd6a","span_id":"605ba09932caa5db","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":28,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:194\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Login_MissingFields (0.00s)
=== RUN   TestAuthHandler_Register_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:16.868+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"885ee051515f1b842204693f7f6819b8","trace_id":"885ee051515f1b842204693f7f6819b8","span_id":"862fb17f30a8282c","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"885ee051515f1b842204693f7f6819b8","trace_id":"885ee051515f1b842204693f7f6819b8","span_id":"862fb17f30a8282c","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.868+0530","caller":"rest/auth_handler.go:235","message":"Registration attempt started","request_id":"885ee051515f1b842204693f7f6819b8","trace_id":"885ee051515f1b842204693f7f6819b8","span_id":"862fb17f30a8282c","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.868+0530","caller":"rest/auth_handler.go:251","message":"Registration validation passed","request_id":"885ee051515f1b842204693f7f6819b8","trace_id":"885ee051515f1b842204693f7f6819b8","span_id":"862fb17f30a8282c","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","email":"newuser@example.com","tenant_id":"tenant-123","first_name":"John","last_name":"Doe"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"rest/auth_handler.go:280","message":"Business event","request_id":"885ee051515f1b842204693f7f6819b8","trace_id":"885ee051515f1b842204693f7f6819b8","span_id":"862fb17f30a8282c","event_type":"user_registration","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","email":"newuser@example.com","first_name":"John","last_name":"Doe","duration_ms":37}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"885ee051515f1b842204693f7f6819b8","trace_id":"885ee051515f1b842204693f7f6819b8","span_id":"862fb17f30a8282c","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"885ee051515f1b842204693f7f6819b8","trace_id":"885ee051515f1b842204693f7f6819b8","span_id":"862fb17f30a8282c","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.037230208}
--- PASS: TestAuthHandler_Register_Success (0.04s)
=== RUN   TestAuthHandler_Register_InvalidEmail
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"163fbe53f5c08de9e89e3022b98d9dc6","trace_id":"163fbe53f5c08de9e89e3022b98d9dc6","span_id":"2af07667836b01ad","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"163fbe53f5c08de9e89e3022b98d9dc6","trace_id":"163fbe53f5c08de9e89e3022b98d9dc6","span_id":"2af07667836b01ad","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"rest/auth_handler.go:235","message":"Registration attempt started","request_id":"163fbe53f5c08de9e89e3022b98d9dc6","trace_id":"163fbe53f5c08de9e89e3022b98d9dc6","span_id":"2af07667836b01ad","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.905+0530","caller":"rest/auth_handler.go:242","message":"Registration validation failed","request_id":"163fbe53f5c08de9e89e3022b98d9dc6","trace_id":"163fbe53f5c08de9e89e3022b98d9dc6","span_id":"2af07667836b01ad","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","error":"Key: 'RegisterRequest.Email' Error:Field validation for 'Email' failed on the 'email' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Register\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:242\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:275\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"163fbe53f5c08de9e89e3022b98d9dc6","trace_id":"163fbe53f5c08de9e89e3022b98d9dc6","span_id":"2af07667836b01ad","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"163fbe53f5c08de9e89e3022b98d9dc6","trace_id":"163fbe53f5c08de9e89e3022b98d9dc6","span_id":"2af07667836b01ad","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000111333}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.905+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"163fbe53f5c08de9e89e3022b98d9dc6","trace_id":"163fbe53f5c08de9e89e3022b98d9dc6","span_id":"2af07667836b01ad","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":113,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:275\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Register_InvalidEmail (0.00s)
=== RUN   TestAuthHandler_Register_MissingFields
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"bf5b365edc5b64d3515097f177bd5c9d","trace_id":"bf5b365edc5b64d3515097f177bd5c9d","span_id":"c95a927647df0ff2","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"bf5b365edc5b64d3515097f177bd5c9d","trace_id":"bf5b365edc5b64d3515097f177bd5c9d","span_id":"c95a927647df0ff2","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"rest/auth_handler.go:235","message":"Registration attempt started","request_id":"bf5b365edc5b64d3515097f177bd5c9d","trace_id":"bf5b365edc5b64d3515097f177bd5c9d","span_id":"c95a927647df0ff2","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.905+0530","caller":"rest/auth_handler.go:242","message":"Registration validation failed","request_id":"bf5b365edc5b64d3515097f177bd5c9d","trace_id":"bf5b365edc5b64d3515097f177bd5c9d","span_id":"c95a927647df0ff2","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","error":"Key: 'RegisterRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag\nKey: 'RegisterRequest.TenantID' Error:Field validation for 'TenantID' failed on the 'required' tag\nKey: 'RegisterRequest.FirstName' Error:Field validation for 'FirstName' failed on the 'required' tag\nKey: 'RegisterRequest.LastName' Error:Field validation for 'LastName' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Register\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:242\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:312\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"bf5b365edc5b64d3515097f177bd5c9d","trace_id":"bf5b365edc5b64d3515097f177bd5c9d","span_id":"c95a927647df0ff2","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"bf5b365edc5b64d3515097f177bd5c9d","trace_id":"bf5b365edc5b64d3515097f177bd5c9d","span_id":"c95a927647df0ff2","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000068084}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.905+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"bf5b365edc5b64d3515097f177bd5c9d","trace_id":"bf5b365edc5b64d3515097f177bd5c9d","span_id":"c95a927647df0ff2","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":28,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:312\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Register_MissingFields (0.00s)
=== RUN   TestAuthHandler_RefreshToken_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"ff4ef8a902645d97e0a6bfdc72a4676c","trace_id":"ff4ef8a902645d97e0a6bfdc72a4676c","span_id":"73efe9179c883828","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"ff4ef8a902645d97e0a6bfdc72a4676c","trace_id":"ff4ef8a902645d97e0a6bfdc72a4676c","span_id":"73efe9179c883828","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"rest/auth_handler.go:323","message":"Token refresh attempt started","request_id":"ff4ef8a902645d97e0a6bfdc72a4676c","trace_id":"ff4ef8a902645d97e0a6bfdc72a4676c","span_id":"73efe9179c883828","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/auth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.905+0530","caller":"rest/auth_handler.go:339","message":"Token refresh validation passed","request_id":"ff4ef8a902645d97e0a6bfdc72a4676c","trace_id":"ff4ef8a902645d97e0a6bfdc72a4676c","span_id":"73efe9179c883828","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","refresh_token_prefix":"valid-refr..."}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.911+0530","caller":"rest/auth_handler.go:366","message":"Business event","request_id":"ff4ef8a902645d97e0a6bfdc72a4676c","trace_id":"ff4ef8a902645d97e0a6bfdc72a4676c","span_id":"73efe9179c883828","event_type":"token_refresh","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","duration_ms":5}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.911+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"ff4ef8a902645d97e0a6bfdc72a4676c","trace_id":"ff4ef8a902645d97e0a6bfdc72a4676c","span_id":"73efe9179c883828","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"ff4ef8a902645d97e0a6bfdc72a4676c","trace_id":"ff4ef8a902645d97e0a6bfdc72a4676c","span_id":"73efe9179c883828","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.005705792}
--- PASS: TestAuthHandler_RefreshToken_Success (0.01s)
=== RUN   TestAuthHandler_RefreshToken_MissingToken
{"level":"INFO","timestamp":"2025-06-26T12:40:16.911+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"28a39bd96e8fd1b55da4e3fd6e191f64","trace_id":"28a39bd96e8fd1b55da4e3fd6e191f64","span_id":"0b8f27826b47777f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"28a39bd96e8fd1b55da4e3fd6e191f64","trace_id":"28a39bd96e8fd1b55da4e3fd6e191f64","span_id":"0b8f27826b47777f","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.911+0530","caller":"rest/auth_handler.go:323","message":"Token refresh attempt started","request_id":"28a39bd96e8fd1b55da4e3fd6e191f64","trace_id":"28a39bd96e8fd1b55da4e3fd6e191f64","span_id":"0b8f27826b47777f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/auth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.911+0530","caller":"rest/auth_handler.go:330","message":"Token refresh validation failed","request_id":"28a39bd96e8fd1b55da4e3fd6e191f64","trace_id":"28a39bd96e8fd1b55da4e3fd6e191f64","span_id":"0b8f27826b47777f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","error":"Key: 'RefreshTokenRequest.RefreshToken' Error:Field validation for 'RefreshToken' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).RefreshToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:330\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:385\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.911+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"28a39bd96e8fd1b55da4e3fd6e191f64","trace_id":"28a39bd96e8fd1b55da4e3fd6e191f64","span_id":"0b8f27826b47777f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"28a39bd96e8fd1b55da4e3fd6e191f64","trace_id":"28a39bd96e8fd1b55da4e3fd6e191f64","span_id":"0b8f27826b47777f","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000053042}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.911+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"28a39bd96e8fd1b55da4e3fd6e191f64","trace_id":"28a39bd96e8fd1b55da4e3fd6e191f64","span_id":"0b8f27826b47777f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":2,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:385\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_RefreshToken_MissingToken (0.00s)
=== RUN   TestAuthHandler_Logout_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:16.911+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","trace_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","span_id":"2ddc0d9d7b7f9d3c","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","request_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","trace_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","span_id":"2ddc0d9d7b7f9d3c","parent_span_id":"","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.911+0530","caller":"rest/auth_handler.go:400","message":"Logout attempt started","request_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","trace_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","span_id":"2ddc0d9d7b7f9d3c","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","endpoint":"/auth/logout","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.922+0530","caller":"rest/auth_handler.go:413","message":"Business event","request_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","trace_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","span_id":"2ddc0d9d7b7f9d3c","event_type":"user_logout","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","duration_ms":10}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.922+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","trace_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","span_id":"2ddc0d9d7b7f9d3c","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","request_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","trace_id":"b13bd60f33f4fc9ccfb58bf6f44697dd","span_id":"2ddc0d9d7b7f9d3c","parent_span_id":"","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.01081075}
--- PASS: TestAuthHandler_Logout_Success (0.01s)
=== RUN   TestAuthHandler_Login_InvalidJSON
{"level":"INFO","timestamp":"2025-06-26T12:40:16.922+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"60f964710fe06ce70b7708fe6771b032","trace_id":"60f964710fe06ce70b7708fe6771b032","span_id":"90150641552a456c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"60f964710fe06ce70b7708fe6771b032","trace_id":"60f964710fe06ce70b7708fe6771b032","span_id":"90150641552a456c","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.922+0530","caller":"rest/auth_handler.go:95","message":"Login attempt started","request_id":"60f964710fe06ce70b7708fe6771b032","trace_id":"60f964710fe06ce70b7708fe6771b032","span_id":"90150641552a456c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.922+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"60f964710fe06ce70b7708fe6771b032","trace_id":"60f964710fe06ce70b7708fe6771b032","span_id":"90150641552a456c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"60f964710fe06ce70b7708fe6771b032","trace_id":"60f964710fe06ce70b7708fe6771b032","span_id":"90150641552a456c","user_id":"","tenant_id":"","auth_method":"password","reason":"validation_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:102\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:444\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.922+0530","caller":"rest/auth_handler.go:103","message":"Login validation failed","request_id":"60f964710fe06ce70b7708fe6771b032","trace_id":"60f964710fe06ce70b7708fe6771b032","span_id":"90150641552a456c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","error":"unexpected EOF","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:103\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:444\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.922+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"60f964710fe06ce70b7708fe6771b032","trace_id":"60f964710fe06ce70b7708fe6771b032","span_id":"90150641552a456c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"60f964710fe06ce70b7708fe6771b032","trace_id":"60f964710fe06ce70b7708fe6771b032","span_id":"90150641552a456c","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000108333}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.922+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"60f964710fe06ce70b7708fe6771b032","trace_id":"60f964710fe06ce70b7708fe6771b032","span_id":"90150641552a456c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":82,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:444\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Login_InvalidJSON (0.00s)
=== RUN   TestAuthHandler_Register_EmptyPassword
{"level":"INFO","timestamp":"2025-06-26T12:40:16.922+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"e2ef6917036fda12233e14af03253af1","trace_id":"e2ef6917036fda12233e14af03253af1","span_id":"f02a8fe2763d2632","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"e2ef6917036fda12233e14af03253af1","trace_id":"e2ef6917036fda12233e14af03253af1","span_id":"f02a8fe2763d2632","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.922+0530","caller":"rest/auth_handler.go:235","message":"Registration attempt started","request_id":"e2ef6917036fda12233e14af03253af1","trace_id":"e2ef6917036fda12233e14af03253af1","span_id":"f02a8fe2763d2632","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.922+0530","caller":"rest/auth_handler.go:242","message":"Registration validation failed","request_id":"e2ef6917036fda12233e14af03253af1","trace_id":"e2ef6917036fda12233e14af03253af1","span_id":"f02a8fe2763d2632","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","error":"Key: 'RegisterRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Register\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:242\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:483\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.922+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"e2ef6917036fda12233e14af03253af1","trace_id":"e2ef6917036fda12233e14af03253af1","span_id":"f02a8fe2763d2632","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"e2ef6917036fda12233e14af03253af1","trace_id":"e2ef6917036fda12233e14af03253af1","span_id":"f02a8fe2763d2632","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000054167}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.923+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"e2ef6917036fda12233e14af03253af1","trace_id":"e2ef6917036fda12233e14af03253af1","span_id":"f02a8fe2763d2632","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":105,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:483\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Register_EmptyPassword (0.00s)
=== RUN   TestAuthHandler_NewAuthHandler
--- PASS: TestAuthHandler_NewAuthHandler (0.00s)
=== RUN   TestOAuthHandler_GoogleLogin_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"441426da7eaf6b586b4d80d2995c6acb","trace_id":"441426da7eaf6b586b4d80d2995c6acb","span_id":"5bb7ac4650ae7c0b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"441426da7eaf6b586b4d80d2995c6acb","trace_id":"441426da7eaf6b586b4d80d2995c6acb","span_id":"5bb7ac4650ae7c0b","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"441426da7eaf6b586b4d80d2995c6acb","trace_id":"441426da7eaf6b586b4d80d2995c6acb","span_id":"5bb7ac4650ae7c0b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"441426da7eaf6b586b4d80d2995c6acb","trace_id":"441426da7eaf6b586b4d80d2995c6acb","span_id":"5bb7ac4650ae7c0b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"441426da7eaf6b586b4d80d2995c6acb","trace_id":"441426da7eaf6b586b4d80d2995c6acb","span_id":"5bb7ac4650ae7c0b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"441426da7eaf6b586b4d80d2995c6acb","trace_id":"441426da7eaf6b586b4d80d2995c6acb","span_id":"5bb7ac4650ae7c0b","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"441426da7eaf6b586b4d80d2995c6acb","trace_id":"441426da7eaf6b586b4d80d2995c6acb","span_id":"5bb7ac4650ae7c0b","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"http://localhost:8080/api/v1/oauth/google/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"441426da7eaf6b586b4d80d2995c6acb","trace_id":"441426da7eaf6b586b4d80d2995c6acb","span_id":"5bb7ac4650ae7c0b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"441426da7eaf6b586b4d80d2995c6acb","trace_id":"441426da7eaf6b586b4d80d2995c6acb","span_id":"5bb7ac4650ae7c0b","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000058083}
--- PASS: TestOAuthHandler_GoogleLogin_Success (0.00s)
=== RUN   TestOAuthHandler_GoogleLogin_WithCustomRedirectURI
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"6ed2adc747fd504277d5e1c799983412","trace_id":"6ed2adc747fd504277d5e1c799983412","span_id":"aaca15bb2c8dbb3b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"6ed2adc747fd504277d5e1c799983412","trace_id":"6ed2adc747fd504277d5e1c799983412","span_id":"aaca15bb2c8dbb3b","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"6ed2adc747fd504277d5e1c799983412","trace_id":"6ed2adc747fd504277d5e1c799983412","span_id":"aaca15bb2c8dbb3b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"6ed2adc747fd504277d5e1c799983412","trace_id":"6ed2adc747fd504277d5e1c799983412","span_id":"aaca15bb2c8dbb3b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":"https://custom.example.com/callback"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"6ed2adc747fd504277d5e1c799983412","trace_id":"6ed2adc747fd504277d5e1c799983412","span_id":"aaca15bb2c8dbb3b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"6ed2adc747fd504277d5e1c799983412","trace_id":"6ed2adc747fd504277d5e1c799983412","span_id":"aaca15bb2c8dbb3b","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"6ed2adc747fd504277d5e1c799983412","trace_id":"6ed2adc747fd504277d5e1c799983412","span_id":"aaca15bb2c8dbb3b","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","redirect_uri":"https://custom.example.com/callback","duration_ms":0,"provider":"google"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"6ed2adc747fd504277d5e1c799983412","trace_id":"6ed2adc747fd504277d5e1c799983412","span_id":"aaca15bb2c8dbb3b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"6ed2adc747fd504277d5e1c799983412","trace_id":"6ed2adc747fd504277d5e1c799983412","span_id":"aaca15bb2c8dbb3b","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000077375}
--- PASS: TestOAuthHandler_GoogleLogin_WithCustomRedirectURI (0.00s)
=== RUN   TestOAuthHandler_GoogleLogin_MissingTenantID
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"56a851b45a4ed3f1344828231c7d8147","trace_id":"56a851b45a4ed3f1344828231c7d8147","span_id":"68299ab6fc3dbfef","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"56a851b45a4ed3f1344828231c7d8147","trace_id":"56a851b45a4ed3f1344828231c7d8147","span_id":"68299ab6fc3dbfef","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"56a851b45a4ed3f1344828231c7d8147","trace_id":"56a851b45a4ed3f1344828231c7d8147","span_id":"68299ab6fc3dbfef","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"56a851b45a4ed3f1344828231c7d8147","trace_id":"56a851b45a4ed3f1344828231c7d8147","span_id":"68299ab6fc3dbfef","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"56a851b45a4ed3f1344828231c7d8147","trace_id":"56a851b45a4ed3f1344828231c7d8147","span_id":"68299ab6fc3dbfef","user_id":"","tenant_id":"","auth_method":"google_oauth","reason":"missing_tenant_id","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleLogin\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:74\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:115\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:75","message":"Google OAuth login failed - missing tenant ID","request_id":"56a851b45a4ed3f1344828231c7d8147","trace_id":"56a851b45a4ed3f1344828231c7d8147","span_id":"68299ab6fc3dbfef","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).GoogleLogin\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:75\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:115\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"56a851b45a4ed3f1344828231c7d8147","trace_id":"56a851b45a4ed3f1344828231c7d8147","span_id":"68299ab6fc3dbfef","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"56a851b45a4ed3f1344828231c7d8147","trace_id":"56a851b45a4ed3f1344828231c7d8147","span_id":"68299ab6fc3dbfef","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000060584}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.923+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"56a851b45a4ed3f1344828231c7d8147","trace_id":"56a851b45a4ed3f1344828231c7d8147","span_id":"68299ab6fc3dbfef","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:115\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleLogin_MissingTenantID (0.00s)
=== RUN   TestOAuthHandler_GoogleCallback_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.923+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","code_prefix":"test-auth-..."}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.974+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","user_id":"google-user-123","tenant_id":"tenant-123","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.974+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","provider":"google","step":"callback_success","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.974+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":51}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.974+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"40366d95a545de37ba5cd6b90bdcaad2","trace_id":"40366d95a545de37ba5cd6b90bdcaad2","span_id":"f638a94adc476a0d","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.051222}
--- PASS: TestOAuthHandler_GoogleCallback_Success (0.05s)
=== RUN   TestOAuthHandler_GoogleCallback_MissingCode
{"level":"INFO","timestamp":"2025-06-26T12:40:16.974+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"76f4f8549c0e84649e093acab0eb5888","trace_id":"76f4f8549c0e84649e093acab0eb5888","span_id":"71d2ad57d5033074","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"76f4f8549c0e84649e093acab0eb5888","trace_id":"76f4f8549c0e84649e093acab0eb5888","span_id":"71d2ad57d5033074","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.974+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"76f4f8549c0e84649e093acab0eb5888","trace_id":"76f4f8549c0e84649e093acab0eb5888","span_id":"71d2ad57d5033074","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.974+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"76f4f8549c0e84649e093acab0eb5888","trace_id":"76f4f8549c0e84649e093acab0eb5888","span_id":"71d2ad57d5033074","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"76f4f8549c0e84649e093acab0eb5888","trace_id":"76f4f8549c0e84649e093acab0eb5888","span_id":"71d2ad57d5033074","user_id":"","tenant_id":"tenant-123","auth_method":"google_oauth","reason":"missing_code","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:164\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.975+0530","caller":"rest/oauth_handler.go:165","message":"Google OAuth callback failed - missing authorization code","request_id":"76f4f8549c0e84649e093acab0eb5888","trace_id":"76f4f8549c0e84649e093acab0eb5888","span_id":"71d2ad57d5033074","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:165\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.975+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"76f4f8549c0e84649e093acab0eb5888","trace_id":"76f4f8549c0e84649e093acab0eb5888","span_id":"71d2ad57d5033074","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"76f4f8549c0e84649e093acab0eb5888","trace_id":"76f4f8549c0e84649e093acab0eb5888","span_id":"71d2ad57d5033074","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000090959}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.975+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"76f4f8549c0e84649e093acab0eb5888","trace_id":"76f4f8549c0e84649e093acab0eb5888","span_id":"71d2ad57d5033074","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleCallback_MissingCode (0.00s)
=== RUN   TestOAuthHandler_GoogleCallback_OAuthError
{"level":"INFO","timestamp":"2025-06-26T12:40:16.975+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.975+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.975+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","user_id":"","tenant_id":"tenant-123","auth_method":"google_oauth","reason":"oauth_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:153\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:197\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.975+0530","caller":"logger/logger.go:225","message":"OAuth flow failed","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","provider":"google","step":"callback_error","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","error":"oauth error: access_denied","stacktrace":"auth-service/internal/logger.(*RequestLogger).OAuthFlow\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:225\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:154\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:197\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.975+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000066375}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.975+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"e4dd34e4d7f82f62836645ebe28df5ea","trace_id":"e4dd34e4d7f82f62836645ebe28df5ea","span_id":"b322cee47b846389","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:197\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleCallback_OAuthError (0.00s)
=== RUN   TestOAuthHandler_ClientCredentials_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:16.975+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"bb8c67b81d89307474f54d277a612b38","trace_id":"bb8c67b81d89307474f54d277a612b38","span_id":"792b5c069264c838","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"bb8c67b81d89307474f54d277a612b38","trace_id":"bb8c67b81d89307474f54d277a612b38","span_id":"792b5c069264c838","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.975+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"bb8c67b81d89307474f54d277a612b38","trace_id":"bb8c67b81d89307474f54d277a612b38","span_id":"792b5c069264c838","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.975+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"bb8c67b81d89307474f54d277a612b38","trace_id":"bb8c67b81d89307474f54d277a612b38","span_id":"792b5c069264c838","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"service-client-123","grant_type":"client_credentials","scope":"read:users write:users"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"bb8c67b81d89307474f54d277a612b38","trace_id":"bb8c67b81d89307474f54d277a612b38","span_id":"792b5c069264c838","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"bb8c67b81d89307474f54d277a612b38","trace_id":"bb8c67b81d89307474f54d277a612b38","span_id":"792b5c069264c838","user_id":"service-client-123","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"bb8c67b81d89307474f54d277a612b38","trace_id":"bb8c67b81d89307474f54d277a612b38","span_id":"792b5c069264c838","event_type":"client_credentials_success","user_id":"service-client-123","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"read:users write:users","duration_ms":21}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"bb8c67b81d89307474f54d277a612b38","trace_id":"bb8c67b81d89307474f54d277a612b38","span_id":"792b5c069264c838","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"bb8c67b81d89307474f54d277a612b38","trace_id":"bb8c67b81d89307474f54d277a612b38","span_id":"792b5c069264c838","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.021168042}
--- PASS: TestOAuthHandler_ClientCredentials_Success (0.02s)
=== RUN   TestOAuthHandler_ClientCredentials_UnsupportedGrantType
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"service-client-123","grant_type":"authorization_code","scope":"read:users write:users"}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.996+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","user_id":"service-client-123","tenant_id":"","auth_method":"client_credentials","reason":"unsupported_grant_type","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).ClientCredentials\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:284\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:273\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.996+0530","caller":"rest/oauth_handler.go:285","message":"Unsupported grant type","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","grant_type":"authorization_code","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).ClientCredentials\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:285\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:273\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000097542}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.996+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"aa2ff6eed0621527ed6ad64dd166f79a","trace_id":"aa2ff6eed0621527ed6ad64dd166f79a","span_id":"028545b8f12f9142","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":138,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:273\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_ClientCredentials_UnsupportedGrantType (0.00s)
=== RUN   TestOAuthHandler_ClientCredentials_InvalidJSON
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"b6f278ab196b479231386eec29c12e7a","trace_id":"b6f278ab196b479231386eec29c12e7a","span_id":"e18515fa1bf6d41d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"b6f278ab196b479231386eec29c12e7a","trace_id":"b6f278ab196b479231386eec29c12e7a","span_id":"e18515fa1bf6d41d","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"b6f278ab196b479231386eec29c12e7a","trace_id":"b6f278ab196b479231386eec29c12e7a","span_id":"e18515fa1bf6d41d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:16.996+0530","caller":"rest/oauth_handler.go:268","message":"Client credentials validation failed","request_id":"b6f278ab196b479231386eec29c12e7a","trace_id":"b6f278ab196b479231386eec29c12e7a","span_id":"e18515fa1bf6d41d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","error":"unexpected EOF","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).ClientCredentials\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:268\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:303\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"b6f278ab196b479231386eec29c12e7a","trace_id":"b6f278ab196b479231386eec29c12e7a","span_id":"e18515fa1bf6d41d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"b6f278ab196b479231386eec29c12e7a","trace_id":"b6f278ab196b479231386eec29c12e7a","span_id":"e18515fa1bf6d41d","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000082041}
{"level":"WARN","timestamp":"2025-06-26T12:40:16.996+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"b6f278ab196b479231386eec29c12e7a","trace_id":"b6f278ab196b479231386eec29c12e7a","span_id":"e18515fa1bf6d41d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":70,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:303\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_ClientCredentials_InvalidJSON (0.00s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"94b655f3abb338df4190dc33238b7edd","trace_id":"94b655f3abb338df4190dc33238b7edd","span_id":"97652add2d5594df","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"94b655f3abb338df4190dc33238b7edd","trace_id":"94b655f3abb338df4190dc33238b7edd","span_id":"97652add2d5594df","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.996+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"94b655f3abb338df4190dc33238b7edd","trace_id":"94b655f3abb338df4190dc33238b7edd","span_id":"97652add2d5594df","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:16.997+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"94b655f3abb338df4190dc33238b7edd","trace_id":"94b655f3abb338df4190dc33238b7edd","span_id":"97652add2d5594df","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":3600,"max_uses":1}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.013+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"94b655f3abb338df4190dc33238b7edd","trace_id":"94b655f3abb338df4190dc33238b7edd","span_id":"97652add2d5594df","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","expires_in":3600,"max_uses":1,"duration_ms":16}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.013+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"94b655f3abb338df4190dc33238b7edd","trace_id":"94b655f3abb338df4190dc33238b7edd","span_id":"97652add2d5594df","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"94b655f3abb338df4190dc33238b7edd","trace_id":"94b655f3abb338df4190dc33238b7edd","span_id":"97652add2d5594df","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.016154875}
--- PASS: TestOAuthHandler_CreateOneTimeToken_Success (0.02s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_MissingURL
{"level":"INFO","timestamp":"2025-06-26T12:40:17.013+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8bb76a734e0aa2f59e6fb9650c32a473","trace_id":"8bb76a734e0aa2f59e6fb9650c32a473","span_id":"5ea72c38adaa52ac","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"8bb76a734e0aa2f59e6fb9650c32a473","trace_id":"8bb76a734e0aa2f59e6fb9650c32a473","span_id":"5ea72c38adaa52ac","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.013+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"8bb76a734e0aa2f59e6fb9650c32a473","trace_id":"8bb76a734e0aa2f59e6fb9650c32a473","span_id":"5ea72c38adaa52ac","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.013+0530","caller":"rest/oauth_handler.go:371","message":"One-time token validation failed","request_id":"8bb76a734e0aa2f59e6fb9650c32a473","trace_id":"8bb76a734e0aa2f59e6fb9650c32a473","span_id":"5ea72c38adaa52ac","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","error":"Key: 'OneTimeTokenRequest.URL' Error:Field validation for 'URL' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).CreateOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:371\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:385\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.013+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8bb76a734e0aa2f59e6fb9650c32a473","trace_id":"8bb76a734e0aa2f59e6fb9650c32a473","span_id":"5ea72c38adaa52ac","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"8bb76a734e0aa2f59e6fb9650c32a473","trace_id":"8bb76a734e0aa2f59e6fb9650c32a473","span_id":"5ea72c38adaa52ac","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000076708}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.013+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"8bb76a734e0aa2f59e6fb9650c32a473","trace_id":"8bb76a734e0aa2f59e6fb9650c32a473","span_id":"5ea72c38adaa52ac","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":87,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:385\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_CreateOneTimeToken_MissingURL (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:17.013+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"5e804cc9c00f0518ad0b7b67b4d77c32","trace_id":"5e804cc9c00f0518ad0b7b67b4d77c32","span_id":"4a54d2d24fda4cca","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"5e804cc9c00f0518ad0b7b67b4d77c32","trace_id":"5e804cc9c00f0518ad0b7b67b4d77c32","span_id":"4a54d2d24fda4cca","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.013+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"5e804cc9c00f0518ad0b7b67b4d77c32","trace_id":"5e804cc9c00f0518ad0b7b67b4d77c32","span_id":"4a54d2d24fda4cca","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.013+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"5e804cc9c00f0518ad0b7b67b4d77c32","trace_id":"5e804cc9c00f0518ad0b7b67b4d77c32","span_id":"4a54d2d24fda4cca","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.024+0530","caller":"rest/oauth_handler.go:542","message":"Business event","request_id":"5e804cc9c00f0518ad0b7b67b4d77c32","trace_id":"5e804cc9c00f0518ad0b7b67b4d77c32","span_id":"4a54d2d24fda4cca","event_type":"one_time_token_verified","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","duration_ms":11,"session_id":"survey-session-456","is_valid":true}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.024+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"5e804cc9c00f0518ad0b7b67b4d77c32","trace_id":"5e804cc9c00f0518ad0b7b67b4d77c32","span_id":"4a54d2d24fda4cca","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"5e804cc9c00f0518ad0b7b67b4d77c32","trace_id":"5e804cc9c00f0518ad0b7b67b4d77c32","span_id":"4a54d2d24fda4cca","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.011208292}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_Success (0.01s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_MissingToken
{"level":"INFO","timestamp":"2025-06-26T12:40:17.024+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"5517a0a2fd64c74b6255c2ee1025283b","trace_id":"5517a0a2fd64c74b6255c2ee1025283b","span_id":"9d319aef5bb93bc5","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"5517a0a2fd64c74b6255c2ee1025283b","trace_id":"5517a0a2fd64c74b6255c2ee1025283b","span_id":"9d319aef5bb93bc5","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.024+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"5517a0a2fd64c74b6255c2ee1025283b","trace_id":"5517a0a2fd64c74b6255c2ee1025283b","span_id":"9d319aef5bb93bc5","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.024+0530","caller":"rest/oauth_handler.go:469","message":"One-time token verification failed - missing token","request_id":"5517a0a2fd64c74b6255c2ee1025283b","trace_id":"5517a0a2fd64c74b6255c2ee1025283b","span_id":"9d319aef5bb93bc5","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:469\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:440\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.024+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"5517a0a2fd64c74b6255c2ee1025283b","trace_id":"5517a0a2fd64c74b6255c2ee1025283b","span_id":"9d319aef5bb93bc5","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"5517a0a2fd64c74b6255c2ee1025283b","trace_id":"5517a0a2fd64c74b6255c2ee1025283b","span_id":"9d319aef5bb93bc5","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.00007925}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.024+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"5517a0a2fd64c74b6255c2ee1025283b","trace_id":"5517a0a2fd64c74b6255c2ee1025283b","span_id":"9d319aef5bb93bc5","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:440\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_MissingToken (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_InvalidToken
{"level":"INFO","timestamp":"2025-06-26T12:40:17.024+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.024+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.024+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"invalid-to...","session_id":"session-123"}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.036+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","user_id":"","tenant_id":"","auth_method":"one_time_token","reason":"invalid_token","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:513\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:466\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.036+0530","caller":"rest/oauth_handler.go:514","message":"One-time token verification failed - invalid token or session","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:514\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:466\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.036+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":401,"duration":0.011135625}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.036+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","trace_id":"070e76e522c7ab7d8c3dcc7e6351dcf7","span_id":"920c748fca33dbac","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:466\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_InvalidToken (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_Success
{"level":"INFO","timestamp":"2025-06-26T12:40:17.036+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"ad73976a405ea7f6628367e1f4ef5140","trace_id":"ad73976a405ea7f6628367e1f4ef5140","span_id":"0a6448de94677f1f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"ad73976a405ea7f6628367e1f4ef5140","trace_id":"ad73976a405ea7f6628367e1f4ef5140","span_id":"0a6448de94677f1f","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.036+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"ad73976a405ea7f6628367e1f4ef5140","trace_id":"ad73976a405ea7f6628367e1f4ef5140","span_id":"0a6448de94677f1f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.036+0530","caller":"rest/oauth_handler.go:598","message":"Session refresh validation passed","request_id":"ad73976a405ea7f6628367e1f4ef5140","trace_id":"ad73976a405ea7f6628367e1f4ef5140","span_id":"0a6448de94677f1f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.044+0530","caller":"rest/oauth_handler.go:637","message":"Business event","request_id":"ad73976a405ea7f6628367e1f4ef5140","trace_id":"ad73976a405ea7f6628367e1f4ef5140","span_id":"0a6448de94677f1f","event_type":"session_refreshed","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","duration_ms":8}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.044+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"ad73976a405ea7f6628367e1f4ef5140","trace_id":"ad73976a405ea7f6628367e1f4ef5140","span_id":"0a6448de94677f1f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"ad73976a405ea7f6628367e1f4ef5140","trace_id":"ad73976a405ea7f6628367e1f4ef5140","span_id":"0a6448de94677f1f","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.008497583}
--- PASS: TestOAuthHandler_RefreshSession_Success (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_MissingSessionID
{"level":"INFO","timestamp":"2025-06-26T12:40:17.044+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"ffd76de417490691d82b215dc52ec14b","trace_id":"ffd76de417490691d82b215dc52ec14b","span_id":"21ebee8a9bcf45f4","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"ffd76de417490691d82b215dc52ec14b","trace_id":"ffd76de417490691d82b215dc52ec14b","span_id":"21ebee8a9bcf45f4","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.044+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"ffd76de417490691d82b215dc52ec14b","trace_id":"ffd76de417490691d82b215dc52ec14b","span_id":"21ebee8a9bcf45f4","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.044+0530","caller":"rest/oauth_handler.go:589","message":"Session refresh failed - missing parameters","request_id":"ffd76de417490691d82b215dc52ec14b","trace_id":"ffd76de417490691d82b215dc52ec14b","span_id":"21ebee8a9bcf45f4","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).RefreshSession\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:589\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:522\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.045+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"ffd76de417490691d82b215dc52ec14b","trace_id":"ffd76de417490691d82b215dc52ec14b","span_id":"21ebee8a9bcf45f4","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"ffd76de417490691d82b215dc52ec14b","trace_id":"ffd76de417490691d82b215dc52ec14b","span_id":"21ebee8a9bcf45f4","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000089792}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.045+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"ffd76de417490691d82b215dc52ec14b","trace_id":"ffd76de417490691d82b215dc52ec14b","span_id":"21ebee8a9bcf45f4","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:522\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_RefreshSession_MissingSessionID (0.00s)
=== RUN   TestOAuthHandler_NewOAuthHandler
--- PASS: TestOAuthHandler_NewOAuthHandler (0.00s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithAllFields
{"level":"INFO","timestamp":"2025-06-26T12:40:17.045+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"887988bbd45b91e926253908d8cb1449","trace_id":"887988bbd45b91e926253908d8cb1449","span_id":"0b4ba6593654220f","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"887988bbd45b91e926253908d8cb1449","trace_id":"887988bbd45b91e926253908d8cb1449","span_id":"0b4ba6593654220f","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.045+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"887988bbd45b91e926253908d8cb1449","trace_id":"887988bbd45b91e926253908d8cb1449","span_id":"0b4ba6593654220f","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.045+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"887988bbd45b91e926253908d8cb1449","trace_id":"887988bbd45b91e926253908d8cb1449","span_id":"0b4ba6593654220f","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":7200,"max_uses":5}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.060+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"887988bbd45b91e926253908d8cb1449","trace_id":"887988bbd45b91e926253908d8cb1449","span_id":"0b4ba6593654220f","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","expires_in":7200,"max_uses":5,"duration_ms":15,"session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.060+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"887988bbd45b91e926253908d8cb1449","trace_id":"887988bbd45b91e926253908d8cb1449","span_id":"0b4ba6593654220f","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"887988bbd45b91e926253908d8cb1449","trace_id":"887988bbd45b91e926253908d8cb1449","span_id":"0b4ba6593654220f","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.015259708}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithAllFields (0.02s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithDefaultValues
{"level":"INFO","timestamp":"2025-06-26T12:40:17.060+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"f361db6ffe857da9f00101e21e1737e9","trace_id":"f361db6ffe857da9f00101e21e1737e9","span_id":"9ac7e1ab543acc8d","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"f361db6ffe857da9f00101e21e1737e9","trace_id":"f361db6ffe857da9f00101e21e1737e9","span_id":"9ac7e1ab543acc8d","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.060+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"f361db6ffe857da9f00101e21e1737e9","trace_id":"f361db6ffe857da9f00101e21e1737e9","span_id":"9ac7e1ab543acc8d","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.060+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"f361db6ffe857da9f00101e21e1737e9","trace_id":"f361db6ffe857da9f00101e21e1737e9","span_id":"9ac7e1ab543acc8d","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":0,"max_uses":0}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.076+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"f361db6ffe857da9f00101e21e1737e9","trace_id":"f361db6ffe857da9f00101e21e1737e9","span_id":"9ac7e1ab543acc8d","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","duration_ms":16,"session_id":"survey-session-456","expires_in":0,"max_uses":0}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.076+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"f361db6ffe857da9f00101e21e1737e9","trace_id":"f361db6ffe857da9f00101e21e1737e9","span_id":"9ac7e1ab543acc8d","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"f361db6ffe857da9f00101e21e1737e9","trace_id":"f361db6ffe857da9f00101e21e1737e9","span_id":"9ac7e1ab543acc8d","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.016124542}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithDefaultValues (0.02s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON
{"level":"INFO","timestamp":"2025-06-26T12:40:17.076+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"499e20e9a0d139e6efe720ca6244dcb1","trace_id":"499e20e9a0d139e6efe720ca6244dcb1","span_id":"1d1272908198fb83","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"499e20e9a0d139e6efe720ca6244dcb1","trace_id":"499e20e9a0d139e6efe720ca6244dcb1","span_id":"1d1272908198fb83","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.076+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"499e20e9a0d139e6efe720ca6244dcb1","trace_id":"499e20e9a0d139e6efe720ca6244dcb1","span_id":"1d1272908198fb83","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.076+0530","caller":"rest/oauth_handler.go:371","message":"One-time token validation failed","request_id":"499e20e9a0d139e6efe720ca6244dcb1","trace_id":"499e20e9a0d139e6efe720ca6244dcb1","span_id":"1d1272908198fb83","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","error":"unexpected EOF","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).CreateOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:371\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:638\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.076+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"499e20e9a0d139e6efe720ca6244dcb1","trace_id":"499e20e9a0d139e6efe720ca6244dcb1","span_id":"1d1272908198fb83","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"499e20e9a0d139e6efe720ca6244dcb1","trace_id":"499e20e9a0d139e6efe720ca6244dcb1","span_id":"1d1272908198fb83","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.00016}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.076+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"499e20e9a0d139e6efe720ca6244dcb1","trace_id":"499e20e9a0d139e6efe720ca6244dcb1","span_id":"1d1272908198fb83","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":44,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:638\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON (0.00s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithEmptyBody
{"level":"INFO","timestamp":"2025-06-26T12:40:17.077+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"d16115737db52f67a5003dc2da71b81b","trace_id":"d16115737db52f67a5003dc2da71b81b","span_id":"1b9b1f1139229b70","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"d16115737db52f67a5003dc2da71b81b","trace_id":"d16115737db52f67a5003dc2da71b81b","span_id":"1b9b1f1139229b70","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.077+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"d16115737db52f67a5003dc2da71b81b","trace_id":"d16115737db52f67a5003dc2da71b81b","span_id":"1b9b1f1139229b70","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.077+0530","caller":"rest/oauth_handler.go:371","message":"One-time token validation failed","request_id":"d16115737db52f67a5003dc2da71b81b","trace_id":"d16115737db52f67a5003dc2da71b81b","span_id":"1b9b1f1139229b70","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","error":"EOF","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).CreateOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:371\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:665\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.077+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"d16115737db52f67a5003dc2da71b81b","trace_id":"d16115737db52f67a5003dc2da71b81b","span_id":"1b9b1f1139229b70","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"d16115737db52f67a5003dc2da71b81b","trace_id":"d16115737db52f67a5003dc2da71b81b","span_id":"1b9b1f1139229b70","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000039917}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.077+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"d16115737db52f67a5003dc2da71b81b","trace_id":"d16115737db52f67a5003dc2da71b81b","span_id":"1b9b1f1139229b70","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:665\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithEmptyBody (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_WithAllFields
{"level":"INFO","timestamp":"2025-06-26T12:40:17.077+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"375a8432bd76400d3fd6b6024df10d33","trace_id":"375a8432bd76400d3fd6b6024df10d33","span_id":"1445c18f410bd6a3","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"375a8432bd76400d3fd6b6024df10d33","trace_id":"375a8432bd76400d3fd6b6024df10d33","span_id":"1445c18f410bd6a3","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.077+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"375a8432bd76400d3fd6b6024df10d33","trace_id":"375a8432bd76400d3fd6b6024df10d33","span_id":"1445c18f410bd6a3","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.077+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"375a8432bd76400d3fd6b6024df10d33","trace_id":"375a8432bd76400d3fd6b6024df10d33","span_id":"1445c18f410bd6a3","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.088+0530","caller":"rest/oauth_handler.go:542","message":"Business event","request_id":"375a8432bd76400d3fd6b6024df10d33","trace_id":"375a8432bd76400d3fd6b6024df10d33","span_id":"1445c18f410bd6a3","event_type":"one_time_token_verified","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","duration_ms":11,"session_id":"survey-session-456","is_valid":true}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.088+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"375a8432bd76400d3fd6b6024df10d33","trace_id":"375a8432bd76400d3fd6b6024df10d33","span_id":"1445c18f410bd6a3","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"375a8432bd76400d3fd6b6024df10d33","trace_id":"375a8432bd76400d3fd6b6024df10d33","span_id":"1445c18f410bd6a3","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.011169334}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_WithAllFields (0.01s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID
{"level":"INFO","timestamp":"2025-06-26T12:40:17.088+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"5eccfbad8cfa5e4d708a669ddd1edb35","trace_id":"5eccfbad8cfa5e4d708a669ddd1edb35","span_id":"4d7b5eda0db1211f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"5eccfbad8cfa5e4d708a669ddd1edb35","trace_id":"5eccfbad8cfa5e4d708a669ddd1edb35","span_id":"4d7b5eda0db1211f","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.088+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"5eccfbad8cfa5e4d708a669ddd1edb35","trace_id":"5eccfbad8cfa5e4d708a669ddd1edb35","span_id":"4d7b5eda0db1211f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.088+0530","caller":"rest/oauth_handler.go:479","message":"One-time token verification failed - missing session ID","request_id":"5eccfbad8cfa5e4d708a669ddd1edb35","trace_id":"5eccfbad8cfa5e4d708a669ddd1edb35","span_id":"4d7b5eda0db1211f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:479\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:723\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.088+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"5eccfbad8cfa5e4d708a669ddd1edb35","trace_id":"5eccfbad8cfa5e4d708a669ddd1edb35","span_id":"4d7b5eda0db1211f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"5eccfbad8cfa5e4d708a669ddd1edb35","trace_id":"5eccfbad8cfa5e4d708a669ddd1edb35","span_id":"4d7b5eda0db1211f","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000080625}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.088+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"5eccfbad8cfa5e4d708a669ddd1edb35","trace_id":"5eccfbad8cfa5e4d708a669ddd1edb35","span_id":"4d7b5eda0db1211f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:723\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken
{"level":"INFO","timestamp":"2025-06-26T12:40:17.088+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.088+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.088+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"invalid-to...","session_id":"invalid-session"}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.099+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","user_id":"","tenant_id":"","auth_method":"one_time_token","reason":"invalid_token","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:513\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:750\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.099+0530","caller":"rest/oauth_handler.go:514","message":"One-time token verification failed - invalid token or session","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:514\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:750\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.099+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":401,"duration":0.011117958}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.099+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"3f9146652860a7fecf3b8bda3640c93a","trace_id":"3f9146652860a7fecf3b8bda3640c93a","span_id":"0ce962af79f5c08a","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:750\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_WithAllFields
{"level":"INFO","timestamp":"2025-06-26T12:40:17.099+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"38bf5b0448c20450b94b98242039d9c3","trace_id":"38bf5b0448c20450b94b98242039d9c3","span_id":"a098a61c115a00ed","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"38bf5b0448c20450b94b98242039d9c3","trace_id":"38bf5b0448c20450b94b98242039d9c3","span_id":"a098a61c115a00ed","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.099+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"38bf5b0448c20450b94b98242039d9c3","trace_id":"38bf5b0448c20450b94b98242039d9c3","span_id":"a098a61c115a00ed","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.099+0530","caller":"rest/oauth_handler.go:598","message":"Session refresh validation passed","request_id":"38bf5b0448c20450b94b98242039d9c3","trace_id":"38bf5b0448c20450b94b98242039d9c3","span_id":"a098a61c115a00ed","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.108+0530","caller":"rest/oauth_handler.go:637","message":"Business event","request_id":"38bf5b0448c20450b94b98242039d9c3","trace_id":"38bf5b0448c20450b94b98242039d9c3","span_id":"a098a61c115a00ed","event_type":"session_refreshed","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","duration_ms":9}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.109+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"38bf5b0448c20450b94b98242039d9c3","trace_id":"38bf5b0448c20450b94b98242039d9c3","span_id":"a098a61c115a00ed","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"38bf5b0448c20450b94b98242039d9c3","trace_id":"38bf5b0448c20450b94b98242039d9c3","span_id":"a098a61c115a00ed","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.009153834}
--- PASS: TestOAuthHandler_RefreshSession_WithAllFields (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_WithInvalidJSON
{"level":"INFO","timestamp":"2025-06-26T12:40:17.109+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"51a32cbe60b06241646649914c38b71b","trace_id":"51a32cbe60b06241646649914c38b71b","span_id":"aa997d74d2a21d7e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"51a32cbe60b06241646649914c38b71b","trace_id":"51a32cbe60b06241646649914c38b71b","span_id":"aa997d74d2a21d7e","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.109+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"51a32cbe60b06241646649914c38b71b","trace_id":"51a32cbe60b06241646649914c38b71b","span_id":"aa997d74d2a21d7e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.109+0530","caller":"rest/oauth_handler.go:589","message":"Session refresh failed - missing parameters","request_id":"51a32cbe60b06241646649914c38b71b","trace_id":"51a32cbe60b06241646649914c38b71b","span_id":"aa997d74d2a21d7e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).RefreshSession\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:589\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:810\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.109+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"51a32cbe60b06241646649914c38b71b","trace_id":"51a32cbe60b06241646649914c38b71b","span_id":"aa997d74d2a21d7e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"51a32cbe60b06241646649914c38b71b","trace_id":"51a32cbe60b06241646649914c38b71b","span_id":"aa997d74d2a21d7e","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000120334}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.109+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"51a32cbe60b06241646649914c38b71b","trace_id":"51a32cbe60b06241646649914c38b71b","span_id":"aa997d74d2a21d7e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":33,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:810\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_RefreshSession_WithInvalidJSON (0.00s)
=== RUN   TestOAuthHandler_RefreshSession_WithEmptyBody
{"level":"INFO","timestamp":"2025-06-26T12:40:17.109+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"6e2daa671172c0074ec02c97b9d28ea9","trace_id":"6e2daa671172c0074ec02c97b9d28ea9","span_id":"e7efe074d522eb58","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"6e2daa671172c0074ec02c97b9d28ea9","trace_id":"6e2daa671172c0074ec02c97b9d28ea9","span_id":"e7efe074d522eb58","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.109+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"6e2daa671172c0074ec02c97b9d28ea9","trace_id":"6e2daa671172c0074ec02c97b9d28ea9","span_id":"e7efe074d522eb58","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.109+0530","caller":"rest/oauth_handler.go:589","message":"Session refresh failed - missing parameters","request_id":"6e2daa671172c0074ec02c97b9d28ea9","trace_id":"6e2daa671172c0074ec02c97b9d28ea9","span_id":"e7efe074d522eb58","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).RefreshSession\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:589\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:837\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.109+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"6e2daa671172c0074ec02c97b9d28ea9","trace_id":"6e2daa671172c0074ec02c97b9d28ea9","span_id":"e7efe074d522eb58","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"6e2daa671172c0074ec02c97b9d28ea9","trace_id":"6e2daa671172c0074ec02c97b9d28ea9","span_id":"e7efe074d522eb58","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.00004825}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.109+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"6e2daa671172c0074ec02c97b9d28ea9","trace_id":"6e2daa671172c0074ec02c97b9d28ea9","span_id":"e7efe074d522eb58","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:837\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_RefreshSession_WithEmptyBody (0.00s)
=== RUN   TestOAuthHandler_ClientCredentials_WithScope
{"level":"INFO","timestamp":"2025-06-26T12:40:17.110+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"a07e7c4fbc79d61dc67cbe2a734a9896","trace_id":"a07e7c4fbc79d61dc67cbe2a734a9896","span_id":"fe05d7e718e7f81c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"a07e7c4fbc79d61dc67cbe2a734a9896","trace_id":"a07e7c4fbc79d61dc67cbe2a734a9896","span_id":"fe05d7e718e7f81c","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.110+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"a07e7c4fbc79d61dc67cbe2a734a9896","trace_id":"a07e7c4fbc79d61dc67cbe2a734a9896","span_id":"fe05d7e718e7f81c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.110+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"a07e7c4fbc79d61dc67cbe2a734a9896","trace_id":"a07e7c4fbc79d61dc67cbe2a734a9896","span_id":"fe05d7e718e7f81c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":"read:users write:users"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.131+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"a07e7c4fbc79d61dc67cbe2a734a9896","trace_id":"a07e7c4fbc79d61dc67cbe2a734a9896","span_id":"fe05d7e718e7f81c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"a07e7c4fbc79d61dc67cbe2a734a9896","trace_id":"a07e7c4fbc79d61dc67cbe2a734a9896","span_id":"fe05d7e718e7f81c","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.131+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"a07e7c4fbc79d61dc67cbe2a734a9896","trace_id":"a07e7c4fbc79d61dc67cbe2a734a9896","span_id":"fe05d7e718e7f81c","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","duration_ms":21,"scope":"read:users write:users"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.131+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"a07e7c4fbc79d61dc67cbe2a734a9896","trace_id":"a07e7c4fbc79d61dc67cbe2a734a9896","span_id":"fe05d7e718e7f81c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"a07e7c4fbc79d61dc67cbe2a734a9896","trace_id":"a07e7c4fbc79d61dc67cbe2a734a9896","span_id":"fe05d7e718e7f81c","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.021344917}
--- PASS: TestOAuthHandler_ClientCredentials_WithScope (0.02s)
=== RUN   TestOAuthHandler_ClientCredentials_WithoutScope
{"level":"INFO","timestamp":"2025-06-26T12:40:17.131+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"22f5fb336ae558df026555279d7911c5","trace_id":"22f5fb336ae558df026555279d7911c5","span_id":"cc840297713bb8ca","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"22f5fb336ae558df026555279d7911c5","trace_id":"22f5fb336ae558df026555279d7911c5","span_id":"cc840297713bb8ca","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.131+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"22f5fb336ae558df026555279d7911c5","trace_id":"22f5fb336ae558df026555279d7911c5","span_id":"cc840297713bb8ca","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.131+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"22f5fb336ae558df026555279d7911c5","trace_id":"22f5fb336ae558df026555279d7911c5","span_id":"cc840297713bb8ca","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.152+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"22f5fb336ae558df026555279d7911c5","trace_id":"22f5fb336ae558df026555279d7911c5","span_id":"cc840297713bb8ca","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"22f5fb336ae558df026555279d7911c5","trace_id":"22f5fb336ae558df026555279d7911c5","span_id":"cc840297713bb8ca","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.152+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"22f5fb336ae558df026555279d7911c5","trace_id":"22f5fb336ae558df026555279d7911c5","span_id":"cc840297713bb8ca","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"","duration_ms":20}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.152+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"22f5fb336ae558df026555279d7911c5","trace_id":"22f5fb336ae558df026555279d7911c5","span_id":"cc840297713bb8ca","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"22f5fb336ae558df026555279d7911c5","trace_id":"22f5fb336ae558df026555279d7911c5","span_id":"cc840297713bb8ca","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.02090375}
--- PASS: TestOAuthHandler_ClientCredentials_WithoutScope (0.02s)
=== RUN   TestOAuthHandler_ClientCredentials_WithEmptyScope
{"level":"INFO","timestamp":"2025-06-26T12:40:17.152+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8c717677b09217bfb439649627ad1e25","trace_id":"8c717677b09217bfb439649627ad1e25","span_id":"0883a10dcec0476c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"8c717677b09217bfb439649627ad1e25","trace_id":"8c717677b09217bfb439649627ad1e25","span_id":"0883a10dcec0476c","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.152+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"8c717677b09217bfb439649627ad1e25","trace_id":"8c717677b09217bfb439649627ad1e25","span_id":"0883a10dcec0476c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.152+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"8c717677b09217bfb439649627ad1e25","trace_id":"8c717677b09217bfb439649627ad1e25","span_id":"0883a10dcec0476c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"8c717677b09217bfb439649627ad1e25","trace_id":"8c717677b09217bfb439649627ad1e25","span_id":"0883a10dcec0476c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"8c717677b09217bfb439649627ad1e25","trace_id":"8c717677b09217bfb439649627ad1e25","span_id":"0883a10dcec0476c","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"8c717677b09217bfb439649627ad1e25","trace_id":"8c717677b09217bfb439649627ad1e25","span_id":"0883a10dcec0476c","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"","duration_ms":20}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8c717677b09217bfb439649627ad1e25","trace_id":"8c717677b09217bfb439649627ad1e25","span_id":"0883a10dcec0476c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"8c717677b09217bfb439649627ad1e25","trace_id":"8c717677b09217bfb439649627ad1e25","span_id":"0883a10dcec0476c","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.020303083}
--- PASS: TestOAuthHandler_ClientCredentials_WithEmptyScope (0.02s)
=== RUN   TestOAuthHandler_GoogleLogin_WithEmptyRedirectURI
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"5cf822c604390f111e56b3e8e398772b","trace_id":"5cf822c604390f111e56b3e8e398772b","span_id":"5740a001067e702f","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"5cf822c604390f111e56b3e8e398772b","trace_id":"5cf822c604390f111e56b3e8e398772b","span_id":"5740a001067e702f","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"5cf822c604390f111e56b3e8e398772b","trace_id":"5cf822c604390f111e56b3e8e398772b","span_id":"5740a001067e702f","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"5cf822c604390f111e56b3e8e398772b","trace_id":"5cf822c604390f111e56b3e8e398772b","span_id":"5740a001067e702f","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"5cf822c604390f111e56b3e8e398772b","trace_id":"5cf822c604390f111e56b3e8e398772b","span_id":"5740a001067e702f","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"5cf822c604390f111e56b3e8e398772b","trace_id":"5cf822c604390f111e56b3e8e398772b","span_id":"5740a001067e702f","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"5cf822c604390f111e56b3e8e398772b","trace_id":"5cf822c604390f111e56b3e8e398772b","span_id":"5740a001067e702f","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"http://localhost:8080/api/v1/oauth/google/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"5cf822c604390f111e56b3e8e398772b","trace_id":"5cf822c604390f111e56b3e8e398772b","span_id":"5740a001067e702f","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"5cf822c604390f111e56b3e8e398772b","trace_id":"5cf822c604390f111e56b3e8e398772b","span_id":"5740a001067e702f","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000067}
--- PASS: TestOAuthHandler_GoogleLogin_WithEmptyRedirectURI (0.00s)
=== RUN   TestOAuthHandler_GoogleCallback_WithEmptyState
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.173+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"","code_prefix":"test-auth-..."}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.224+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","user_id":"google-user-123","tenant_id":"","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.224+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","provider":"google","step":"callback_success","tenant_id":"","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.224+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":50}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.224+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"09bd92aad4631ee07e9489526d277ae5","trace_id":"09bd92aad4631ee07e9489526d277ae5","span_id":"8f22ef229d6968b2","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.050753291}
--- PASS: TestOAuthHandler_GoogleCallback_WithEmptyState (0.05s)
=== RUN   TestOAuthHandler_GoogleCallback_WithOnlyCode
{"level":"INFO","timestamp":"2025-06-26T12:40:17.224+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.224+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.224+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"","code_prefix":"test-auth-..."}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.276+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","user_id":"google-user-123","tenant_id":"","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.276+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","provider":"google","step":"callback_success","tenant_id":"","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.276+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":51}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.278+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"8af93cabd187e57da174d3cb8ec92664","trace_id":"8af93cabd187e57da174d3cb8ec92664","span_id":"f27232dc29cd708f","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.051858666}
--- PASS: TestOAuthHandler_GoogleCallback_WithOnlyCode (0.05s)
=== RUN   TestOAuthHandler_GoogleCallback_WithOnlyError
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.280+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","user_id":"","tenant_id":"","auth_method":"google_oauth","reason":"oauth_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:153\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:1063\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T12:40:17.280+0530","caller":"logger/logger.go:225","message":"OAuth flow failed","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","provider":"google","step":"callback_error","tenant_id":"","client_ip":"192.0.2.1:1234","error":"oauth error: access_denied","stacktrace":"auth-service/internal/logger.(*RequestLogger).OAuthFlow\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:225\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:154\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:1063\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000087625}
{"level":"WARN","timestamp":"2025-06-26T12:40:17.280+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"117b72b10a170b39e84636498c538b50","trace_id":"117b72b10a170b39e84636498c538b50","span_id":"95b7b149d76518fe","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:1063\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleCallback_WithOnlyError (0.00s)
=== RUN   TestOAuthHandler_Integration
=== RUN   TestOAuthHandler_Integration/GoogleLogin
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"96fb4f03737ebac8a3960eeaa62caa1c","trace_id":"96fb4f03737ebac8a3960eeaa62caa1c","span_id":"3d6f00073ab52ccb","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"96fb4f03737ebac8a3960eeaa62caa1c","trace_id":"96fb4f03737ebac8a3960eeaa62caa1c","span_id":"3d6f00073ab52ccb","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"96fb4f03737ebac8a3960eeaa62caa1c","trace_id":"96fb4f03737ebac8a3960eeaa62caa1c","span_id":"3d6f00073ab52ccb","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"96fb4f03737ebac8a3960eeaa62caa1c","trace_id":"96fb4f03737ebac8a3960eeaa62caa1c","span_id":"3d6f00073ab52ccb","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"96fb4f03737ebac8a3960eeaa62caa1c","trace_id":"96fb4f03737ebac8a3960eeaa62caa1c","span_id":"3d6f00073ab52ccb","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"96fb4f03737ebac8a3960eeaa62caa1c","trace_id":"96fb4f03737ebac8a3960eeaa62caa1c","span_id":"3d6f00073ab52ccb","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"96fb4f03737ebac8a3960eeaa62caa1c","trace_id":"96fb4f03737ebac8a3960eeaa62caa1c","span_id":"3d6f00073ab52ccb","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"http://localhost:8080/api/v1/oauth/google/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"96fb4f03737ebac8a3960eeaa62caa1c","trace_id":"96fb4f03737ebac8a3960eeaa62caa1c","span_id":"3d6f00073ab52ccb","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"96fb4f03737ebac8a3960eeaa62caa1c","trace_id":"96fb4f03737ebac8a3960eeaa62caa1c","span_id":"3d6f00073ab52ccb","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000047625}
=== RUN   TestOAuthHandler_Integration/GoogleCallback
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.280+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","code_prefix":"test-code..."}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.331+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","user_id":"google-user-123","tenant_id":"tenant-123","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.331+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","provider":"google","step":"callback_success","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.331+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":50}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.331+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"9bfe6ae25467b644a112155e46a37427","trace_id":"9bfe6ae25467b644a112155e46a37427","span_id":"b585ecf8f8541a52","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.050976208}
=== RUN   TestOAuthHandler_Integration/ClientCredentials
{"level":"INFO","timestamp":"2025-06-26T12:40:17.332+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"7c6c8c1df1edde6523c2baf17d8f4a80","trace_id":"7c6c8c1df1edde6523c2baf17d8f4a80","span_id":"d79dc167fa28cfc0","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"7c6c8c1df1edde6523c2baf17d8f4a80","trace_id":"7c6c8c1df1edde6523c2baf17d8f4a80","span_id":"d79dc167fa28cfc0","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.332+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"7c6c8c1df1edde6523c2baf17d8f4a80","trace_id":"7c6c8c1df1edde6523c2baf17d8f4a80","span_id":"d79dc167fa28cfc0","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.332+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"7c6c8c1df1edde6523c2baf17d8f4a80","trace_id":"7c6c8c1df1edde6523c2baf17d8f4a80","span_id":"d79dc167fa28cfc0","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.353+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"7c6c8c1df1edde6523c2baf17d8f4a80","trace_id":"7c6c8c1df1edde6523c2baf17d8f4a80","span_id":"d79dc167fa28cfc0","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"7c6c8c1df1edde6523c2baf17d8f4a80","trace_id":"7c6c8c1df1edde6523c2baf17d8f4a80","span_id":"d79dc167fa28cfc0","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.353+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"7c6c8c1df1edde6523c2baf17d8f4a80","trace_id":"7c6c8c1df1edde6523c2baf17d8f4a80","span_id":"d79dc167fa28cfc0","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"","duration_ms":21}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.353+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"7c6c8c1df1edde6523c2baf17d8f4a80","trace_id":"7c6c8c1df1edde6523c2baf17d8f4a80","span_id":"d79dc167fa28cfc0","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"7c6c8c1df1edde6523c2baf17d8f4a80","trace_id":"7c6c8c1df1edde6523c2baf17d8f4a80","span_id":"d79dc167fa28cfc0","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.021196083}
=== RUN   TestOAuthHandler_Integration/CreateOneTimeToken
{"level":"INFO","timestamp":"2025-06-26T12:40:17.353+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"c0d21d01bb295140c300cf988b3e42ae","trace_id":"c0d21d01bb295140c300cf988b3e42ae","span_id":"4fedf1834e897734","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"c0d21d01bb295140c300cf988b3e42ae","trace_id":"c0d21d01bb295140c300cf988b3e42ae","span_id":"4fedf1834e897734","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.353+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"c0d21d01bb295140c300cf988b3e42ae","trace_id":"c0d21d01bb295140c300cf988b3e42ae","span_id":"4fedf1834e897734","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.353+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"c0d21d01bb295140c300cf988b3e42ae","trace_id":"c0d21d01bb295140c300cf988b3e42ae","span_id":"4fedf1834e897734","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":0,"max_uses":0}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.369+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"c0d21d01bb295140c300cf988b3e42ae","trace_id":"c0d21d01bb295140c300cf988b3e42ae","span_id":"4fedf1834e897734","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","expires_in":0,"max_uses":0,"duration_ms":16}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.369+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"c0d21d01bb295140c300cf988b3e42ae","trace_id":"c0d21d01bb295140c300cf988b3e42ae","span_id":"4fedf1834e897734","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"c0d21d01bb295140c300cf988b3e42ae","trace_id":"c0d21d01bb295140c300cf988b3e42ae","span_id":"4fedf1834e897734","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.016136208}
=== RUN   TestOAuthHandler_Integration/VerifyOneTimeToken
{"level":"INFO","timestamp":"2025-06-26T12:40:17.370+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"6874be45dc8261ad1e453384633bc92c","trace_id":"6874be45dc8261ad1e453384633bc92c","span_id":"5ea758700aa223b4","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"6874be45dc8261ad1e453384633bc92c","trace_id":"6874be45dc8261ad1e453384633bc92c","span_id":"5ea758700aa223b4","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.370+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"6874be45dc8261ad1e453384633bc92c","trace_id":"6874be45dc8261ad1e453384633bc92c","span_id":"5ea758700aa223b4","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.370+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"6874be45dc8261ad1e453384633bc92c","trace_id":"6874be45dc8261ad1e453384633bc92c","span_id":"5ea758700aa223b4","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.381+0530","caller":"rest/oauth_handler.go:542","message":"Business event","request_id":"6874be45dc8261ad1e453384633bc92c","trace_id":"6874be45dc8261ad1e453384633bc92c","span_id":"5ea758700aa223b4","event_type":"one_time_token_verified","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","is_valid":true,"duration_ms":11}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.381+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"6874be45dc8261ad1e453384633bc92c","trace_id":"6874be45dc8261ad1e453384633bc92c","span_id":"5ea758700aa223b4","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"6874be45dc8261ad1e453384633bc92c","trace_id":"6874be45dc8261ad1e453384633bc92c","span_id":"5ea758700aa223b4","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.011092084}
=== RUN   TestOAuthHandler_Integration/RefreshSession
{"level":"INFO","timestamp":"2025-06-26T12:40:17.381+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"5cb9bf1a86a79ebb97a6002e3b597e36","trace_id":"5cb9bf1a86a79ebb97a6002e3b597e36","span_id":"7b84a4f859e615a4","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"5cb9bf1a86a79ebb97a6002e3b597e36","trace_id":"5cb9bf1a86a79ebb97a6002e3b597e36","span_id":"7b84a4f859e615a4","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.381+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"5cb9bf1a86a79ebb97a6002e3b597e36","trace_id":"5cb9bf1a86a79ebb97a6002e3b597e36","span_id":"7b84a4f859e615a4","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.381+0530","caller":"rest/oauth_handler.go:598","message":"Session refresh validation passed","request_id":"5cb9bf1a86a79ebb97a6002e3b597e36","trace_id":"5cb9bf1a86a79ebb97a6002e3b597e36","span_id":"7b84a4f859e615a4","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.390+0530","caller":"rest/oauth_handler.go:637","message":"Business event","request_id":"5cb9bf1a86a79ebb97a6002e3b597e36","trace_id":"5cb9bf1a86a79ebb97a6002e3b597e36","span_id":"7b84a4f859e615a4","event_type":"session_refreshed","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","duration_ms":9}
{"level":"INFO","timestamp":"2025-06-26T12:40:17.390+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"5cb9bf1a86a79ebb97a6002e3b597e36","trace_id":"5cb9bf1a86a79ebb97a6002e3b597e36","span_id":"7b84a4f859e615a4","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"5cb9bf1a86a79ebb97a6002e3b597e36","trace_id":"5cb9bf1a86a79ebb97a6002e3b597e36","span_id":"7b84a4f859e615a4","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.009086292}
--- PASS: TestOAuthHandler_Integration (0.11s)
    --- PASS: TestOAuthHandler_Integration/GoogleLogin (0.00s)
    --- PASS: TestOAuthHandler_Integration/GoogleCallback (0.05s)
    --- PASS: TestOAuthHandler_Integration/ClientCredentials (0.02s)
    --- PASS: TestOAuthHandler_Integration/CreateOneTimeToken (0.02s)
    --- PASS: TestOAuthHandler_Integration/VerifyOneTimeToken (0.01s)
    --- PASS: TestOAuthHandler_Integration/RefreshSession (0.01s)
PASS
ok  	auth-service/internal/handler/rest	(cached)
