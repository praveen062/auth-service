=== RUN   TestAuthHandler_Login_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.790+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"6251d5e80a20199768ed43782f3147aa","trace_id":"6251d5e80a20199768ed43782f3147aa","span_id":"5d4b05746b5e1bb6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"6251d5e80a20199768ed43782f3147aa","trace_id":"6251d5e80a20199768ed43782f3147aa","span_id":"5d4b05746b5e1bb6","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.790+0530","caller":"rest/auth_handler.go:93","message":"Login attempt started","request_id":"6251d5e80a20199768ed43782f3147aa","trace_id":"6251d5e80a20199768ed43782f3147aa","span_id":"5d4b05746b5e1bb6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.790+0530","caller":"rest/auth_handler.go:110","message":"Login validation passed","request_id":"6251d5e80a20199768ed43782f3147aa","trace_id":"6251d5e80a20199768ed43782f3147aa","span_id":"5d4b05746b5e1bb6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","email":"test@example.com","tenant_id":"tenant-123"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.807+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"6251d5e80a20199768ed43782f3147aa","trace_id":"6251d5e80a20199768ed43782f3147aa","span_id":"5d4b05746b5e1bb6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"6251d5e80a20199768ed43782f3147aa","trace_id":"6251d5e80a20199768ed43782f3147aa","span_id":"5d4b05746b5e1bb6","user_id":"user-123","tenant_id":"tenant-123","auth_method":"password","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.807+0530","caller":"rest/auth_handler.go:147","message":"Business event","request_id":"6251d5e80a20199768ed43782f3147aa","trace_id":"6251d5e80a20199768ed43782f3147aa","span_id":"5d4b05746b5e1bb6","event_type":"user_login","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","login_method":"password","roles":["user"],"duration_ms":16}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.807+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"6251d5e80a20199768ed43782f3147aa","trace_id":"6251d5e80a20199768ed43782f3147aa","span_id":"5d4b05746b5e1bb6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"6251d5e80a20199768ed43782f3147aa","trace_id":"6251d5e80a20199768ed43782f3147aa","span_id":"5d4b05746b5e1bb6","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.017146042}
--- PASS: TestAuthHandler_Login_Success (0.02s)
=== RUN   TestAuthHandler_Login_InvalidEmail
{"level":"INFO","timestamp":"2025-06-25T23:43:53.807+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"d738e0e291ef29eee4eac479d75c6cb9","trace_id":"d738e0e291ef29eee4eac479d75c6cb9","span_id":"5296f339900f26a0","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"d738e0e291ef29eee4eac479d75c6cb9","trace_id":"d738e0e291ef29eee4eac479d75c6cb9","span_id":"5296f339900f26a0","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.807+0530","caller":"rest/auth_handler.go:93","message":"Login attempt started","request_id":"d738e0e291ef29eee4eac479d75c6cb9","trace_id":"d738e0e291ef29eee4eac479d75c6cb9","span_id":"5296f339900f26a0","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.807+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"d738e0e291ef29eee4eac479d75c6cb9","trace_id":"d738e0e291ef29eee4eac479d75c6cb9","span_id":"5296f339900f26a0","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"d738e0e291ef29eee4eac479d75c6cb9","trace_id":"d738e0e291ef29eee4eac479d75c6cb9","span_id":"5296f339900f26a0","user_id":"","tenant_id":"tenant-123","auth_method":"password","reason":"validation_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:100\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:134\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.807+0530","caller":"rest/auth_handler.go:101","message":"Login validation failed","request_id":"d738e0e291ef29eee4eac479d75c6cb9","trace_id":"d738e0e291ef29eee4eac479d75c6cb9","span_id":"5296f339900f26a0","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","error":"Key: 'LoginRequest.Email' Error:Field validation for 'Email' failed on the 'email' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:101\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:134\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.807+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"d738e0e291ef29eee4eac479d75c6cb9","trace_id":"d738e0e291ef29eee4eac479d75c6cb9","span_id":"5296f339900f26a0","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"d738e0e291ef29eee4eac479d75c6cb9","trace_id":"d738e0e291ef29eee4eac479d75c6cb9","span_id":"5296f339900f26a0","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000256541}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.807+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"d738e0e291ef29eee4eac479d75c6cb9","trace_id":"d738e0e291ef29eee4eac479d75c6cb9","span_id":"5296f339900f26a0","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":75,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:134\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Login_InvalidEmail (0.00s)
=== RUN   TestAuthHandler_Login_MissingFields
{"level":"INFO","timestamp":"2025-06-25T23:43:53.807+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"fa04d3986416ac5148b43a912f2ffaaf","trace_id":"fa04d3986416ac5148b43a912f2ffaaf","span_id":"fc603a24e1a7f0b6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"fa04d3986416ac5148b43a912f2ffaaf","trace_id":"fa04d3986416ac5148b43a912f2ffaaf","span_id":"fc603a24e1a7f0b6","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.808+0530","caller":"rest/auth_handler.go:93","message":"Login attempt started","request_id":"fa04d3986416ac5148b43a912f2ffaaf","trace_id":"fa04d3986416ac5148b43a912f2ffaaf","span_id":"fc603a24e1a7f0b6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.808+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"fa04d3986416ac5148b43a912f2ffaaf","trace_id":"fa04d3986416ac5148b43a912f2ffaaf","span_id":"fc603a24e1a7f0b6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"fa04d3986416ac5148b43a912f2ffaaf","trace_id":"fa04d3986416ac5148b43a912f2ffaaf","span_id":"fc603a24e1a7f0b6","user_id":"","tenant_id":"","auth_method":"password","reason":"validation_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:100\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.808+0530","caller":"rest/auth_handler.go:101","message":"Login validation failed","request_id":"fa04d3986416ac5148b43a912f2ffaaf","trace_id":"fa04d3986416ac5148b43a912f2ffaaf","span_id":"fc603a24e1a7f0b6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","error":"Key: 'LoginRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag\nKey: 'LoginRequest.TenantID' Error:Field validation for 'TenantID' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:101\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.808+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"fa04d3986416ac5148b43a912f2ffaaf","trace_id":"fa04d3986416ac5148b43a912f2ffaaf","span_id":"fc603a24e1a7f0b6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"fa04d3986416ac5148b43a912f2ffaaf","trace_id":"fa04d3986416ac5148b43a912f2ffaaf","span_id":"fc603a24e1a7f0b6","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000111209}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.808+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"fa04d3986416ac5148b43a912f2ffaaf","trace_id":"fa04d3986416ac5148b43a912f2ffaaf","span_id":"fc603a24e1a7f0b6","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":28,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Login_MissingFields (0.00s)
=== RUN   TestAuthHandler_Register_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.808+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"04716b7ce637bcaef217b96103644e1a","trace_id":"04716b7ce637bcaef217b96103644e1a","span_id":"bf5cf20ccec6ccb9","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"04716b7ce637bcaef217b96103644e1a","trace_id":"04716b7ce637bcaef217b96103644e1a","span_id":"bf5cf20ccec6ccb9","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.808+0530","caller":"rest/auth_handler.go:193","message":"Registration attempt started","request_id":"04716b7ce637bcaef217b96103644e1a","trace_id":"04716b7ce637bcaef217b96103644e1a","span_id":"bf5cf20ccec6ccb9","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.808+0530","caller":"rest/auth_handler.go:209","message":"Registration validation passed","request_id":"04716b7ce637bcaef217b96103644e1a","trace_id":"04716b7ce637bcaef217b96103644e1a","span_id":"bf5cf20ccec6ccb9","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","email":"newuser@example.com","tenant_id":"tenant-123","first_name":"John","last_name":"Doe"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.845+0530","caller":"rest/auth_handler.go:238","message":"Business event","request_id":"04716b7ce637bcaef217b96103644e1a","trace_id":"04716b7ce637bcaef217b96103644e1a","span_id":"bf5cf20ccec6ccb9","event_type":"user_registration","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","last_name":"Doe","duration_ms":37,"email":"newuser@example.com","first_name":"John"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.845+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"04716b7ce637bcaef217b96103644e1a","trace_id":"04716b7ce637bcaef217b96103644e1a","span_id":"bf5cf20ccec6ccb9","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"04716b7ce637bcaef217b96103644e1a","trace_id":"04716b7ce637bcaef217b96103644e1a","span_id":"bf5cf20ccec6ccb9","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.037714208}
--- PASS: TestAuthHandler_Register_Success (0.04s)
=== RUN   TestAuthHandler_Register_InvalidEmail
{"level":"INFO","timestamp":"2025-06-25T23:43:53.846+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"021b89536733b43415d2131538073436","trace_id":"021b89536733b43415d2131538073436","span_id":"61de043a672a2dd7","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"021b89536733b43415d2131538073436","trace_id":"021b89536733b43415d2131538073436","span_id":"61de043a672a2dd7","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.846+0530","caller":"rest/auth_handler.go:193","message":"Registration attempt started","request_id":"021b89536733b43415d2131538073436","trace_id":"021b89536733b43415d2131538073436","span_id":"61de043a672a2dd7","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.846+0530","caller":"rest/auth_handler.go:200","message":"Registration validation failed","request_id":"021b89536733b43415d2131538073436","trace_id":"021b89536733b43415d2131538073436","span_id":"61de043a672a2dd7","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","error":"Key: 'RegisterRequest.Email' Error:Field validation for 'Email' failed on the 'email' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Register\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:200\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:252\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.846+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"021b89536733b43415d2131538073436","trace_id":"021b89536733b43415d2131538073436","span_id":"61de043a672a2dd7","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"021b89536733b43415d2131538073436","trace_id":"021b89536733b43415d2131538073436","span_id":"61de043a672a2dd7","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000124667}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.846+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"021b89536733b43415d2131538073436","trace_id":"021b89536733b43415d2131538073436","span_id":"61de043a672a2dd7","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":113,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:252\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Register_InvalidEmail (0.00s)
=== RUN   TestAuthHandler_Register_MissingFields
{"level":"INFO","timestamp":"2025-06-25T23:43:53.846+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"1bca18b0614893cf99d604c4340289de","trace_id":"1bca18b0614893cf99d604c4340289de","span_id":"45348bcc60b7f6a0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"1bca18b0614893cf99d604c4340289de","trace_id":"1bca18b0614893cf99d604c4340289de","span_id":"45348bcc60b7f6a0","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.846+0530","caller":"rest/auth_handler.go:193","message":"Registration attempt started","request_id":"1bca18b0614893cf99d604c4340289de","trace_id":"1bca18b0614893cf99d604c4340289de","span_id":"45348bcc60b7f6a0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.846+0530","caller":"rest/auth_handler.go:200","message":"Registration validation failed","request_id":"1bca18b0614893cf99d604c4340289de","trace_id":"1bca18b0614893cf99d604c4340289de","span_id":"45348bcc60b7f6a0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","error":"Key: 'RegisterRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag\nKey: 'RegisterRequest.TenantID' Error:Field validation for 'TenantID' failed on the 'required' tag\nKey: 'RegisterRequest.FirstName' Error:Field validation for 'FirstName' failed on the 'required' tag\nKey: 'RegisterRequest.LastName' Error:Field validation for 'LastName' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Register\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:200\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:289\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.846+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"1bca18b0614893cf99d604c4340289de","trace_id":"1bca18b0614893cf99d604c4340289de","span_id":"45348bcc60b7f6a0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"1bca18b0614893cf99d604c4340289de","trace_id":"1bca18b0614893cf99d604c4340289de","span_id":"45348bcc60b7f6a0","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000049666}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.846+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"1bca18b0614893cf99d604c4340289de","trace_id":"1bca18b0614893cf99d604c4340289de","span_id":"45348bcc60b7f6a0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":28,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:289\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Register_MissingFields (0.00s)
=== RUN   TestAuthHandler_RefreshToken_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.846+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"f59f302a921a356fd418150c3c055255","trace_id":"f59f302a921a356fd418150c3c055255","span_id":"a06b4c378dca5653","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"f59f302a921a356fd418150c3c055255","trace_id":"f59f302a921a356fd418150c3c055255","span_id":"a06b4c378dca5653","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.846+0530","caller":"rest/auth_handler.go:281","message":"Token refresh attempt started","request_id":"f59f302a921a356fd418150c3c055255","trace_id":"f59f302a921a356fd418150c3c055255","span_id":"a06b4c378dca5653","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/auth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.846+0530","caller":"rest/auth_handler.go:297","message":"Token refresh validation passed","request_id":"f59f302a921a356fd418150c3c055255","trace_id":"f59f302a921a356fd418150c3c055255","span_id":"a06b4c378dca5653","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","refresh_token_prefix":"valid-refr..."}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.855+0530","caller":"rest/auth_handler.go:324","message":"Business event","request_id":"f59f302a921a356fd418150c3c055255","trace_id":"f59f302a921a356fd418150c3c055255","span_id":"a06b4c378dca5653","event_type":"token_refresh","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","duration_ms":9}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.855+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"f59f302a921a356fd418150c3c055255","trace_id":"f59f302a921a356fd418150c3c055255","span_id":"a06b4c378dca5653","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"f59f302a921a356fd418150c3c055255","trace_id":"f59f302a921a356fd418150c3c055255","span_id":"a06b4c378dca5653","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.009445042}
--- PASS: TestAuthHandler_RefreshToken_Success (0.01s)
=== RUN   TestAuthHandler_RefreshToken_MissingToken
{"level":"INFO","timestamp":"2025-06-25T23:43:53.856+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","trace_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","span_id":"02767c4b1ec03286","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","trace_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","span_id":"02767c4b1ec03286","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.856+0530","caller":"rest/auth_handler.go:281","message":"Token refresh attempt started","request_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","trace_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","span_id":"02767c4b1ec03286","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/auth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.856+0530","caller":"rest/auth_handler.go:288","message":"Token refresh validation failed","request_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","trace_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","span_id":"02767c4b1ec03286","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","error":"Key: 'RefreshTokenRequest.RefreshToken' Error:Field validation for 'RefreshToken' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).RefreshToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:288\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:362\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.856+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","trace_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","span_id":"02767c4b1ec03286","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","trace_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","span_id":"02767c4b1ec03286","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000232209}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.856+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","trace_id":"6fc4f8bb10a6eb1a6a2fb0ffe48fd5f0","span_id":"02767c4b1ec03286","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":2,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:362\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_RefreshToken_MissingToken (0.00s)
=== RUN   TestAuthHandler_Logout_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.856+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"cdca91847ae5b8693501d34052b52021","trace_id":"cdca91847ae5b8693501d34052b52021","span_id":"49d048825a5d5bb1","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","request_id":"cdca91847ae5b8693501d34052b52021","trace_id":"cdca91847ae5b8693501d34052b52021","span_id":"49d048825a5d5bb1","parent_span_id":"","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.856+0530","caller":"rest/auth_handler.go:358","message":"Logout attempt started","request_id":"cdca91847ae5b8693501d34052b52021","trace_id":"cdca91847ae5b8693501d34052b52021","span_id":"49d048825a5d5bb1","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","endpoint":"/auth/logout","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.867+0530","caller":"rest/auth_handler.go:371","message":"Business event","request_id":"cdca91847ae5b8693501d34052b52021","trace_id":"cdca91847ae5b8693501d34052b52021","span_id":"49d048825a5d5bb1","event_type":"user_logout","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","duration_ms":11}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.867+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"cdca91847ae5b8693501d34052b52021","trace_id":"cdca91847ae5b8693501d34052b52021","span_id":"49d048825a5d5bb1","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","request_id":"cdca91847ae5b8693501d34052b52021","trace_id":"cdca91847ae5b8693501d34052b52021","span_id":"49d048825a5d5bb1","parent_span_id":"","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.01149525}
--- PASS: TestAuthHandler_Logout_Success (0.01s)
=== RUN   TestAuthHandler_Login_InvalidJSON
{"level":"INFO","timestamp":"2025-06-25T23:43:53.868+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"40e2afd019c2690834d7e56c83c1d853","trace_id":"40e2afd019c2690834d7e56c83c1d853","span_id":"85dd740d9b577d2c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"40e2afd019c2690834d7e56c83c1d853","trace_id":"40e2afd019c2690834d7e56c83c1d853","span_id":"85dd740d9b577d2c","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.868+0530","caller":"rest/auth_handler.go:93","message":"Login attempt started","request_id":"40e2afd019c2690834d7e56c83c1d853","trace_id":"40e2afd019c2690834d7e56c83c1d853","span_id":"85dd740d9b577d2c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.868+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"40e2afd019c2690834d7e56c83c1d853","trace_id":"40e2afd019c2690834d7e56c83c1d853","span_id":"85dd740d9b577d2c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"40e2afd019c2690834d7e56c83c1d853","trace_id":"40e2afd019c2690834d7e56c83c1d853","span_id":"85dd740d9b577d2c","user_id":"","tenant_id":"","auth_method":"password","reason":"validation_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:100\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:421\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.868+0530","caller":"rest/auth_handler.go:101","message":"Login validation failed","request_id":"40e2afd019c2690834d7e56c83c1d853","trace_id":"40e2afd019c2690834d7e56c83c1d853","span_id":"85dd740d9b577d2c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","error":"unexpected EOF","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:101\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:421\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.868+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"40e2afd019c2690834d7e56c83c1d853","trace_id":"40e2afd019c2690834d7e56c83c1d853","span_id":"85dd740d9b577d2c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"40e2afd019c2690834d7e56c83c1d853","trace_id":"40e2afd019c2690834d7e56c83c1d853","span_id":"85dd740d9b577d2c","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000178167}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.868+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"40e2afd019c2690834d7e56c83c1d853","trace_id":"40e2afd019c2690834d7e56c83c1d853","span_id":"85dd740d9b577d2c","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":82,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:421\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Login_InvalidJSON (0.00s)
=== RUN   TestAuthHandler_Register_EmptyPassword
{"level":"INFO","timestamp":"2025-06-25T23:43:53.868+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"186acc7edf8aaabb7b6229aeb0ae88ee","trace_id":"186acc7edf8aaabb7b6229aeb0ae88ee","span_id":"9efa3d3ffb82bb70","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"186acc7edf8aaabb7b6229aeb0ae88ee","trace_id":"186acc7edf8aaabb7b6229aeb0ae88ee","span_id":"9efa3d3ffb82bb70","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.868+0530","caller":"rest/auth_handler.go:193","message":"Registration attempt started","request_id":"186acc7edf8aaabb7b6229aeb0ae88ee","trace_id":"186acc7edf8aaabb7b6229aeb0ae88ee","span_id":"9efa3d3ffb82bb70","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/auth_handler.go:200","message":"Registration validation failed","request_id":"186acc7edf8aaabb7b6229aeb0ae88ee","trace_id":"186acc7edf8aaabb7b6229aeb0ae88ee","span_id":"9efa3d3ffb82bb70","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","error":"Key: 'RegisterRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Register\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:200\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:460\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"186acc7edf8aaabb7b6229aeb0ae88ee","trace_id":"186acc7edf8aaabb7b6229aeb0ae88ee","span_id":"9efa3d3ffb82bb70","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"186acc7edf8aaabb7b6229aeb0ae88ee","trace_id":"186acc7edf8aaabb7b6229aeb0ae88ee","span_id":"9efa3d3ffb82bb70","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000905208}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.869+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"186acc7edf8aaabb7b6229aeb0ae88ee","trace_id":"186acc7edf8aaabb7b6229aeb0ae88ee","span_id":"9efa3d3ffb82bb70","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":105,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:460\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Register_EmptyPassword (0.00s)
=== RUN   TestAuthHandler_NewAuthHandler
--- PASS: TestAuthHandler_NewAuthHandler (0.00s)
=== RUN   TestOAuthHandler_GoogleLogin_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"c9015b632145f631abadbfc77ace8f74","trace_id":"c9015b632145f631abadbfc77ace8f74","span_id":"5674c41f342bcbf4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"c9015b632145f631abadbfc77ace8f74","trace_id":"c9015b632145f631abadbfc77ace8f74","span_id":"5674c41f342bcbf4","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"c9015b632145f631abadbfc77ace8f74","trace_id":"c9015b632145f631abadbfc77ace8f74","span_id":"5674c41f342bcbf4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"c9015b632145f631abadbfc77ace8f74","trace_id":"c9015b632145f631abadbfc77ace8f74","span_id":"5674c41f342bcbf4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"c9015b632145f631abadbfc77ace8f74","trace_id":"c9015b632145f631abadbfc77ace8f74","span_id":"5674c41f342bcbf4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"c9015b632145f631abadbfc77ace8f74","trace_id":"c9015b632145f631abadbfc77ace8f74","span_id":"5674c41f342bcbf4","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"c9015b632145f631abadbfc77ace8f74","trace_id":"c9015b632145f631abadbfc77ace8f74","span_id":"5674c41f342bcbf4","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"http://localhost:8080/api/v1/oauth/google/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"c9015b632145f631abadbfc77ace8f74","trace_id":"c9015b632145f631abadbfc77ace8f74","span_id":"5674c41f342bcbf4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"c9015b632145f631abadbfc77ace8f74","trace_id":"c9015b632145f631abadbfc77ace8f74","span_id":"5674c41f342bcbf4","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000045917}
--- PASS: TestOAuthHandler_GoogleLogin_Success (0.00s)
=== RUN   TestOAuthHandler_GoogleLogin_WithCustomRedirectURI
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"11e776591844ecc52785852f541bea0f","trace_id":"11e776591844ecc52785852f541bea0f","span_id":"9d8a23603b6d1a5e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"11e776591844ecc52785852f541bea0f","trace_id":"11e776591844ecc52785852f541bea0f","span_id":"9d8a23603b6d1a5e","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"11e776591844ecc52785852f541bea0f","trace_id":"11e776591844ecc52785852f541bea0f","span_id":"9d8a23603b6d1a5e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"11e776591844ecc52785852f541bea0f","trace_id":"11e776591844ecc52785852f541bea0f","span_id":"9d8a23603b6d1a5e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":"https://custom.example.com/callback"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"11e776591844ecc52785852f541bea0f","trace_id":"11e776591844ecc52785852f541bea0f","span_id":"9d8a23603b6d1a5e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"11e776591844ecc52785852f541bea0f","trace_id":"11e776591844ecc52785852f541bea0f","span_id":"9d8a23603b6d1a5e","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"11e776591844ecc52785852f541bea0f","trace_id":"11e776591844ecc52785852f541bea0f","span_id":"9d8a23603b6d1a5e","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"https://custom.example.com/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"11e776591844ecc52785852f541bea0f","trace_id":"11e776591844ecc52785852f541bea0f","span_id":"9d8a23603b6d1a5e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"11e776591844ecc52785852f541bea0f","trace_id":"11e776591844ecc52785852f541bea0f","span_id":"9d8a23603b6d1a5e","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.0000285}
--- PASS: TestOAuthHandler_GoogleLogin_WithCustomRedirectURI (0.00s)
=== RUN   TestOAuthHandler_GoogleLogin_MissingTenantID
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"cecb6f005ddd09719005e081f83586f2","trace_id":"cecb6f005ddd09719005e081f83586f2","span_id":"841dc6223af5ef7e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"cecb6f005ddd09719005e081f83586f2","trace_id":"cecb6f005ddd09719005e081f83586f2","span_id":"841dc6223af5ef7e","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"cecb6f005ddd09719005e081f83586f2","trace_id":"cecb6f005ddd09719005e081f83586f2","span_id":"841dc6223af5ef7e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"cecb6f005ddd09719005e081f83586f2","trace_id":"cecb6f005ddd09719005e081f83586f2","span_id":"841dc6223af5ef7e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"cecb6f005ddd09719005e081f83586f2","trace_id":"cecb6f005ddd09719005e081f83586f2","span_id":"841dc6223af5ef7e","user_id":"","tenant_id":"","auth_method":"google_oauth","reason":"missing_tenant_id","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleLogin\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:74\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:115\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/oauth_handler.go:75","message":"Google OAuth login failed - missing tenant ID","request_id":"cecb6f005ddd09719005e081f83586f2","trace_id":"cecb6f005ddd09719005e081f83586f2","span_id":"841dc6223af5ef7e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).GoogleLogin\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:75\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:115\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"cecb6f005ddd09719005e081f83586f2","trace_id":"cecb6f005ddd09719005e081f83586f2","span_id":"841dc6223af5ef7e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"cecb6f005ddd09719005e081f83586f2","trace_id":"cecb6f005ddd09719005e081f83586f2","span_id":"841dc6223af5ef7e","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000033}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.869+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"cecb6f005ddd09719005e081f83586f2","trace_id":"cecb6f005ddd09719005e081f83586f2","span_id":"841dc6223af5ef7e","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:115\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleLogin_MissingTenantID (0.00s)
=== RUN   TestOAuthHandler_GoogleCallback_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.869+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.870+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","code_prefix":"test-auth-..."}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","user_id":"google-user-123","tenant_id":"tenant-123","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","provider":"google","step":"callback_success","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":51}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"999253ef8beeffb1b4f10fd45fe0625b","trace_id":"999253ef8beeffb1b4f10fd45fe0625b","span_id":"6f7f26f653c8355f","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.051876584}
--- PASS: TestOAuthHandler_GoogleCallback_Success (0.05s)
=== RUN   TestOAuthHandler_GoogleCallback_MissingCode
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"6c6ded12663c4d09469d60e712c4e2c0","trace_id":"6c6ded12663c4d09469d60e712c4e2c0","span_id":"0a0ab1cdfda5f1d6","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"6c6ded12663c4d09469d60e712c4e2c0","trace_id":"6c6ded12663c4d09469d60e712c4e2c0","span_id":"0a0ab1cdfda5f1d6","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"6c6ded12663c4d09469d60e712c4e2c0","trace_id":"6c6ded12663c4d09469d60e712c4e2c0","span_id":"0a0ab1cdfda5f1d6","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"6c6ded12663c4d09469d60e712c4e2c0","trace_id":"6c6ded12663c4d09469d60e712c4e2c0","span_id":"0a0ab1cdfda5f1d6","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"6c6ded12663c4d09469d60e712c4e2c0","trace_id":"6c6ded12663c4d09469d60e712c4e2c0","span_id":"0a0ab1cdfda5f1d6","user_id":"","tenant_id":"tenant-123","auth_method":"google_oauth","reason":"missing_code","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:164\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.921+0530","caller":"rest/oauth_handler.go:165","message":"Google OAuth callback failed - missing authorization code","request_id":"6c6ded12663c4d09469d60e712c4e2c0","trace_id":"6c6ded12663c4d09469d60e712c4e2c0","span_id":"0a0ab1cdfda5f1d6","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:165\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"6c6ded12663c4d09469d60e712c4e2c0","trace_id":"6c6ded12663c4d09469d60e712c4e2c0","span_id":"0a0ab1cdfda5f1d6","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"6c6ded12663c4d09469d60e712c4e2c0","trace_id":"6c6ded12663c4d09469d60e712c4e2c0","span_id":"0a0ab1cdfda5f1d6","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000060292}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.921+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"6c6ded12663c4d09469d60e712c4e2c0","trace_id":"6c6ded12663c4d09469d60e712c4e2c0","span_id":"0a0ab1cdfda5f1d6","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleCallback_MissingCode (0.00s)
=== RUN   TestOAuthHandler_GoogleCallback_OAuthError
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","user_id":"","tenant_id":"tenant-123","auth_method":"google_oauth","reason":"oauth_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:153\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:197\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:225","message":"OAuth flow failed","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","provider":"google","step":"callback_error","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","error":"oauth error: access_denied","stacktrace":"auth-service/internal/logger.(*RequestLogger).OAuthFlow\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:225\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:154\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:197\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000039917}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.921+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"5c90dcdaf44b67cf268c5db3fe875140","trace_id":"5c90dcdaf44b67cf268c5db3fe875140","span_id":"f79c3daf49bcdb07","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:197\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleCallback_OAuthError (0.00s)
=== RUN   TestOAuthHandler_ClientCredentials_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"489581deb2d211c2de5390f34ab127e9","trace_id":"489581deb2d211c2de5390f34ab127e9","span_id":"eee1a37be2b66530","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"489581deb2d211c2de5390f34ab127e9","trace_id":"489581deb2d211c2de5390f34ab127e9","span_id":"eee1a37be2b66530","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"489581deb2d211c2de5390f34ab127e9","trace_id":"489581deb2d211c2de5390f34ab127e9","span_id":"eee1a37be2b66530","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.921+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"489581deb2d211c2de5390f34ab127e9","trace_id":"489581deb2d211c2de5390f34ab127e9","span_id":"eee1a37be2b66530","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"service-client-123","grant_type":"client_credentials","scope":"read:users write:users"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.941+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"489581deb2d211c2de5390f34ab127e9","trace_id":"489581deb2d211c2de5390f34ab127e9","span_id":"eee1a37be2b66530","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"489581deb2d211c2de5390f34ab127e9","trace_id":"489581deb2d211c2de5390f34ab127e9","span_id":"eee1a37be2b66530","user_id":"service-client-123","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.942+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"489581deb2d211c2de5390f34ab127e9","trace_id":"489581deb2d211c2de5390f34ab127e9","span_id":"eee1a37be2b66530","event_type":"client_credentials_success","user_id":"service-client-123","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"read:users write:users","duration_ms":20}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.942+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"489581deb2d211c2de5390f34ab127e9","trace_id":"489581deb2d211c2de5390f34ab127e9","span_id":"eee1a37be2b66530","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"489581deb2d211c2de5390f34ab127e9","trace_id":"489581deb2d211c2de5390f34ab127e9","span_id":"eee1a37be2b66530","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.020460541}
--- PASS: TestOAuthHandler_ClientCredentials_Success (0.02s)
=== RUN   TestOAuthHandler_ClientCredentials_UnsupportedGrantType
{"level":"INFO","timestamp":"2025-06-25T23:43:53.942+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.942+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.942+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"service-client-123","grant_type":"authorization_code","scope":"read:users write:users"}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.942+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","user_id":"service-client-123","tenant_id":"","auth_method":"client_credentials","reason":"unsupported_grant_type","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).ClientCredentials\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:284\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:273\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.942+0530","caller":"rest/oauth_handler.go:285","message":"Unsupported grant type","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","grant_type":"authorization_code","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).ClientCredentials\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:285\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:273\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.942+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000203875}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.942+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"ed54fc5e12d20203a366972a4846fc6b","trace_id":"ed54fc5e12d20203a366972a4846fc6b","span_id":"ba7c69594aae1e09","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":138,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:273\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_ClientCredentials_UnsupportedGrantType (0.00s)
=== RUN   TestOAuthHandler_ClientCredentials_InvalidJSON
{"level":"INFO","timestamp":"2025-06-25T23:43:53.942+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","trace_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","span_id":"f8121f15f42b6438","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","trace_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","span_id":"f8121f15f42b6438","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.942+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","trace_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","span_id":"f8121f15f42b6438","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.942+0530","caller":"rest/oauth_handler.go:268","message":"Client credentials validation failed","request_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","trace_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","span_id":"f8121f15f42b6438","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","error":"unexpected EOF","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).ClientCredentials\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:268\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:303\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.942+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","trace_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","span_id":"f8121f15f42b6438","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","trace_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","span_id":"f8121f15f42b6438","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000172792}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.942+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","trace_id":"1cdc05cd9a7e1b2e9a3d730a2af5fd2e","span_id":"f8121f15f42b6438","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":70,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:303\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_ClientCredentials_InvalidJSON (0.00s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.943+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","trace_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","span_id":"72da395b7f1c2bcb","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","trace_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","span_id":"72da395b7f1c2bcb","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.943+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","trace_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","span_id":"72da395b7f1c2bcb","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.943+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","trace_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","span_id":"72da395b7f1c2bcb","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":3600,"max_uses":1}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.958+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","trace_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","span_id":"72da395b7f1c2bcb","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","expires_in":3600,"max_uses":1,"duration_ms":15}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.958+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","trace_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","span_id":"72da395b7f1c2bcb","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","trace_id":"9194a9e6d8dd1ca5caeaac20a959ccb5","span_id":"72da395b7f1c2bcb","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.015142709}
--- PASS: TestOAuthHandler_CreateOneTimeToken_Success (0.02s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_MissingURL
{"level":"INFO","timestamp":"2025-06-25T23:43:53.958+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"23b6554d7d3de1f741add93183cbb5f9","trace_id":"23b6554d7d3de1f741add93183cbb5f9","span_id":"1ccea863b22c0bd8","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"23b6554d7d3de1f741add93183cbb5f9","trace_id":"23b6554d7d3de1f741add93183cbb5f9","span_id":"1ccea863b22c0bd8","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.958+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"23b6554d7d3de1f741add93183cbb5f9","trace_id":"23b6554d7d3de1f741add93183cbb5f9","span_id":"1ccea863b22c0bd8","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.958+0530","caller":"rest/oauth_handler.go:371","message":"One-time token validation failed","request_id":"23b6554d7d3de1f741add93183cbb5f9","trace_id":"23b6554d7d3de1f741add93183cbb5f9","span_id":"1ccea863b22c0bd8","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","error":"Key: 'OneTimeTokenRequest.URL' Error:Field validation for 'URL' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).CreateOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:371\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:385\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.958+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"23b6554d7d3de1f741add93183cbb5f9","trace_id":"23b6554d7d3de1f741add93183cbb5f9","span_id":"1ccea863b22c0bd8","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"23b6554d7d3de1f741add93183cbb5f9","trace_id":"23b6554d7d3de1f741add93183cbb5f9","span_id":"1ccea863b22c0bd8","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000055417}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.958+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"23b6554d7d3de1f741add93183cbb5f9","trace_id":"23b6554d7d3de1f741add93183cbb5f9","span_id":"1ccea863b22c0bd8","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":87,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:385\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_CreateOneTimeToken_MissingURL (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.958+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"695098ccc3a377f21c9c06d744ccff65","trace_id":"695098ccc3a377f21c9c06d744ccff65","span_id":"57bca56ff568f4f2","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"695098ccc3a377f21c9c06d744ccff65","trace_id":"695098ccc3a377f21c9c06d744ccff65","span_id":"57bca56ff568f4f2","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.958+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"695098ccc3a377f21c9c06d744ccff65","trace_id":"695098ccc3a377f21c9c06d744ccff65","span_id":"57bca56ff568f4f2","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.958+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"695098ccc3a377f21c9c06d744ccff65","trace_id":"695098ccc3a377f21c9c06d744ccff65","span_id":"57bca56ff568f4f2","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.970+0530","caller":"rest/oauth_handler.go:542","message":"Business event","request_id":"695098ccc3a377f21c9c06d744ccff65","trace_id":"695098ccc3a377f21c9c06d744ccff65","span_id":"57bca56ff568f4f2","event_type":"one_time_token_verified","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","is_valid":true,"duration_ms":12}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.970+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"695098ccc3a377f21c9c06d744ccff65","trace_id":"695098ccc3a377f21c9c06d744ccff65","span_id":"57bca56ff568f4f2","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"695098ccc3a377f21c9c06d744ccff65","trace_id":"695098ccc3a377f21c9c06d744ccff65","span_id":"57bca56ff568f4f2","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.012531084}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_Success (0.01s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_MissingToken
{"level":"INFO","timestamp":"2025-06-25T23:43:53.971+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"4b16431d2fb172277ec6f31ea88dd22d","trace_id":"4b16431d2fb172277ec6f31ea88dd22d","span_id":"cafd2adce76946ef","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"4b16431d2fb172277ec6f31ea88dd22d","trace_id":"4b16431d2fb172277ec6f31ea88dd22d","span_id":"cafd2adce76946ef","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.971+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"4b16431d2fb172277ec6f31ea88dd22d","trace_id":"4b16431d2fb172277ec6f31ea88dd22d","span_id":"cafd2adce76946ef","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.971+0530","caller":"rest/oauth_handler.go:469","message":"One-time token verification failed - missing token","request_id":"4b16431d2fb172277ec6f31ea88dd22d","trace_id":"4b16431d2fb172277ec6f31ea88dd22d","span_id":"cafd2adce76946ef","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:469\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:440\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.971+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"4b16431d2fb172277ec6f31ea88dd22d","trace_id":"4b16431d2fb172277ec6f31ea88dd22d","span_id":"cafd2adce76946ef","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"4b16431d2fb172277ec6f31ea88dd22d","trace_id":"4b16431d2fb172277ec6f31ea88dd22d","span_id":"cafd2adce76946ef","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000050291}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.971+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"4b16431d2fb172277ec6f31ea88dd22d","trace_id":"4b16431d2fb172277ec6f31ea88dd22d","span_id":"cafd2adce76946ef","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:440\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_MissingToken (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_InvalidToken
{"level":"INFO","timestamp":"2025-06-25T23:43:53.971+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.971+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.971+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"invalid-to...","session_id":"session-123"}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.981+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","user_id":"","tenant_id":"","auth_method":"one_time_token","reason":"invalid_token","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:513\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:466\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.982+0530","caller":"rest/oauth_handler.go:514","message":"One-time token verification failed - invalid token or session","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:514\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:466\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.982+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":401,"duration":0.010922042}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.982+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"2145d1dd4957864c0e7e6fd5ef00725e","trace_id":"2145d1dd4957864c0e7e6fd5ef00725e","span_id":"5f5fe33837c3cf46","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:466\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_InvalidToken (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_Success
{"level":"INFO","timestamp":"2025-06-25T23:43:53.982+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8d2731ce39cbbbfcddec45d3b061a23e","trace_id":"8d2731ce39cbbbfcddec45d3b061a23e","span_id":"385b5fde3832716f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"8d2731ce39cbbbfcddec45d3b061a23e","trace_id":"8d2731ce39cbbbfcddec45d3b061a23e","span_id":"385b5fde3832716f","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.982+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"8d2731ce39cbbbfcddec45d3b061a23e","trace_id":"8d2731ce39cbbbfcddec45d3b061a23e","span_id":"385b5fde3832716f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.982+0530","caller":"rest/oauth_handler.go:598","message":"Session refresh validation passed","request_id":"8d2731ce39cbbbfcddec45d3b061a23e","trace_id":"8d2731ce39cbbbfcddec45d3b061a23e","span_id":"385b5fde3832716f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.991+0530","caller":"rest/oauth_handler.go:637","message":"Business event","request_id":"8d2731ce39cbbbfcddec45d3b061a23e","trace_id":"8d2731ce39cbbbfcddec45d3b061a23e","span_id":"385b5fde3832716f","event_type":"session_refreshed","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","duration_ms":9}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.991+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8d2731ce39cbbbfcddec45d3b061a23e","trace_id":"8d2731ce39cbbbfcddec45d3b061a23e","span_id":"385b5fde3832716f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"8d2731ce39cbbbfcddec45d3b061a23e","trace_id":"8d2731ce39cbbbfcddec45d3b061a23e","span_id":"385b5fde3832716f","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.009164083}
--- PASS: TestOAuthHandler_RefreshSession_Success (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_MissingSessionID
{"level":"INFO","timestamp":"2025-06-25T23:43:53.991+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"4127adde6d1cdfa012e763ae57eea9ac","trace_id":"4127adde6d1cdfa012e763ae57eea9ac","span_id":"bb17304aafc1770d","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"4127adde6d1cdfa012e763ae57eea9ac","trace_id":"4127adde6d1cdfa012e763ae57eea9ac","span_id":"bb17304aafc1770d","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.991+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"4127adde6d1cdfa012e763ae57eea9ac","trace_id":"4127adde6d1cdfa012e763ae57eea9ac","span_id":"bb17304aafc1770d","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:53.991+0530","caller":"rest/oauth_handler.go:589","message":"Session refresh failed - missing parameters","request_id":"4127adde6d1cdfa012e763ae57eea9ac","trace_id":"4127adde6d1cdfa012e763ae57eea9ac","span_id":"bb17304aafc1770d","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).RefreshSession\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:589\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:522\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.991+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"4127adde6d1cdfa012e763ae57eea9ac","trace_id":"4127adde6d1cdfa012e763ae57eea9ac","span_id":"bb17304aafc1770d","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"4127adde6d1cdfa012e763ae57eea9ac","trace_id":"4127adde6d1cdfa012e763ae57eea9ac","span_id":"bb17304aafc1770d","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000057375}
{"level":"WARN","timestamp":"2025-06-25T23:43:53.991+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"4127adde6d1cdfa012e763ae57eea9ac","trace_id":"4127adde6d1cdfa012e763ae57eea9ac","span_id":"bb17304aafc1770d","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:522\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_RefreshSession_MissingSessionID (0.00s)
=== RUN   TestOAuthHandler_NewOAuthHandler
--- PASS: TestOAuthHandler_NewOAuthHandler (0.00s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithAllFields
{"level":"INFO","timestamp":"2025-06-25T23:43:53.992+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"2348aa4af881738a4111c1add01265f4","trace_id":"2348aa4af881738a4111c1add01265f4","span_id":"9dfcdfdbc70562fe","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"2348aa4af881738a4111c1add01265f4","trace_id":"2348aa4af881738a4111c1add01265f4","span_id":"9dfcdfdbc70562fe","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.992+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"2348aa4af881738a4111c1add01265f4","trace_id":"2348aa4af881738a4111c1add01265f4","span_id":"9dfcdfdbc70562fe","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:53.992+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"2348aa4af881738a4111c1add01265f4","trace_id":"2348aa4af881738a4111c1add01265f4","span_id":"9dfcdfdbc70562fe","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":7200,"max_uses":5}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.007+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"2348aa4af881738a4111c1add01265f4","trace_id":"2348aa4af881738a4111c1add01265f4","span_id":"9dfcdfdbc70562fe","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","duration_ms":15,"session_id":"survey-session-456","expires_in":7200,"max_uses":5}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.007+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"2348aa4af881738a4111c1add01265f4","trace_id":"2348aa4af881738a4111c1add01265f4","span_id":"9dfcdfdbc70562fe","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"2348aa4af881738a4111c1add01265f4","trace_id":"2348aa4af881738a4111c1add01265f4","span_id":"9dfcdfdbc70562fe","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.015494917}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithAllFields (0.02s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithDefaultValues
{"level":"INFO","timestamp":"2025-06-25T23:43:54.007+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"a27066c5c95c93ca5b5e242c7d5684a3","trace_id":"a27066c5c95c93ca5b5e242c7d5684a3","span_id":"52207ecedc3190fe","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"a27066c5c95c93ca5b5e242c7d5684a3","trace_id":"a27066c5c95c93ca5b5e242c7d5684a3","span_id":"52207ecedc3190fe","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.007+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"a27066c5c95c93ca5b5e242c7d5684a3","trace_id":"a27066c5c95c93ca5b5e242c7d5684a3","span_id":"52207ecedc3190fe","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.007+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"a27066c5c95c93ca5b5e242c7d5684a3","trace_id":"a27066c5c95c93ca5b5e242c7d5684a3","span_id":"52207ecedc3190fe","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":0,"max_uses":0}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.023+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"a27066c5c95c93ca5b5e242c7d5684a3","trace_id":"a27066c5c95c93ca5b5e242c7d5684a3","span_id":"52207ecedc3190fe","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","expires_in":0,"max_uses":0,"duration_ms":15}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.023+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"a27066c5c95c93ca5b5e242c7d5684a3","trace_id":"a27066c5c95c93ca5b5e242c7d5684a3","span_id":"52207ecedc3190fe","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"a27066c5c95c93ca5b5e242c7d5684a3","trace_id":"a27066c5c95c93ca5b5e242c7d5684a3","span_id":"52207ecedc3190fe","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.016158834}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithDefaultValues (0.02s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON
{"level":"INFO","timestamp":"2025-06-25T23:43:54.024+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"d9291af7a2c877e0e2415fdf126c52bc","trace_id":"d9291af7a2c877e0e2415fdf126c52bc","span_id":"82971aaacd64bbf0","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"d9291af7a2c877e0e2415fdf126c52bc","trace_id":"d9291af7a2c877e0e2415fdf126c52bc","span_id":"82971aaacd64bbf0","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.024+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"d9291af7a2c877e0e2415fdf126c52bc","trace_id":"d9291af7a2c877e0e2415fdf126c52bc","span_id":"82971aaacd64bbf0","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:54.024+0530","caller":"rest/oauth_handler.go:371","message":"One-time token validation failed","request_id":"d9291af7a2c877e0e2415fdf126c52bc","trace_id":"d9291af7a2c877e0e2415fdf126c52bc","span_id":"82971aaacd64bbf0","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","error":"unexpected EOF","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).CreateOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:371\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:638\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.024+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"d9291af7a2c877e0e2415fdf126c52bc","trace_id":"d9291af7a2c877e0e2415fdf126c52bc","span_id":"82971aaacd64bbf0","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"d9291af7a2c877e0e2415fdf126c52bc","trace_id":"d9291af7a2c877e0e2415fdf126c52bc","span_id":"82971aaacd64bbf0","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000068}
{"level":"WARN","timestamp":"2025-06-25T23:43:54.024+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"d9291af7a2c877e0e2415fdf126c52bc","trace_id":"d9291af7a2c877e0e2415fdf126c52bc","span_id":"82971aaacd64bbf0","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":44,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:638\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON (0.00s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithEmptyBody
{"level":"INFO","timestamp":"2025-06-25T23:43:54.024+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"680798d6c65fda52b265933713a65fb8","trace_id":"680798d6c65fda52b265933713a65fb8","span_id":"24b4abf6b6ce339e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"680798d6c65fda52b265933713a65fb8","trace_id":"680798d6c65fda52b265933713a65fb8","span_id":"24b4abf6b6ce339e","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.024+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"680798d6c65fda52b265933713a65fb8","trace_id":"680798d6c65fda52b265933713a65fb8","span_id":"24b4abf6b6ce339e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:54.024+0530","caller":"rest/oauth_handler.go:371","message":"One-time token validation failed","request_id":"680798d6c65fda52b265933713a65fb8","trace_id":"680798d6c65fda52b265933713a65fb8","span_id":"24b4abf6b6ce339e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","error":"EOF","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).CreateOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:371\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:665\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.024+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"680798d6c65fda52b265933713a65fb8","trace_id":"680798d6c65fda52b265933713a65fb8","span_id":"24b4abf6b6ce339e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"680798d6c65fda52b265933713a65fb8","trace_id":"680798d6c65fda52b265933713a65fb8","span_id":"24b4abf6b6ce339e","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.00005425}
{"level":"WARN","timestamp":"2025-06-25T23:43:54.024+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"680798d6c65fda52b265933713a65fb8","trace_id":"680798d6c65fda52b265933713a65fb8","span_id":"24b4abf6b6ce339e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:665\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithEmptyBody (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_WithAllFields
{"level":"INFO","timestamp":"2025-06-25T23:43:54.024+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"7420ece23629cb3788170283b5e43078","trace_id":"7420ece23629cb3788170283b5e43078","span_id":"b26f58def0b50f99","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"7420ece23629cb3788170283b5e43078","trace_id":"7420ece23629cb3788170283b5e43078","span_id":"b26f58def0b50f99","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.024+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"7420ece23629cb3788170283b5e43078","trace_id":"7420ece23629cb3788170283b5e43078","span_id":"b26f58def0b50f99","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.024+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"7420ece23629cb3788170283b5e43078","trace_id":"7420ece23629cb3788170283b5e43078","span_id":"b26f58def0b50f99","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.035+0530","caller":"rest/oauth_handler.go:542","message":"Business event","request_id":"7420ece23629cb3788170283b5e43078","trace_id":"7420ece23629cb3788170283b5e43078","span_id":"b26f58def0b50f99","event_type":"one_time_token_verified","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","is_valid":true,"duration_ms":11}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.035+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"7420ece23629cb3788170283b5e43078","trace_id":"7420ece23629cb3788170283b5e43078","span_id":"b26f58def0b50f99","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"7420ece23629cb3788170283b5e43078","trace_id":"7420ece23629cb3788170283b5e43078","span_id":"b26f58def0b50f99","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.01110975}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_WithAllFields (0.01s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID
{"level":"INFO","timestamp":"2025-06-25T23:43:54.035+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"0b79edf375700bbcd40315c1d0547193","trace_id":"0b79edf375700bbcd40315c1d0547193","span_id":"030a8385e4831673","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"0b79edf375700bbcd40315c1d0547193","trace_id":"0b79edf375700bbcd40315c1d0547193","span_id":"030a8385e4831673","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.035+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"0b79edf375700bbcd40315c1d0547193","trace_id":"0b79edf375700bbcd40315c1d0547193","span_id":"030a8385e4831673","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:54.035+0530","caller":"rest/oauth_handler.go:479","message":"One-time token verification failed - missing session ID","request_id":"0b79edf375700bbcd40315c1d0547193","trace_id":"0b79edf375700bbcd40315c1d0547193","span_id":"030a8385e4831673","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:479\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:723\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.035+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"0b79edf375700bbcd40315c1d0547193","trace_id":"0b79edf375700bbcd40315c1d0547193","span_id":"030a8385e4831673","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"0b79edf375700bbcd40315c1d0547193","trace_id":"0b79edf375700bbcd40315c1d0547193","span_id":"030a8385e4831673","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000057416}
{"level":"WARN","timestamp":"2025-06-25T23:43:54.035+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"0b79edf375700bbcd40315c1d0547193","trace_id":"0b79edf375700bbcd40315c1d0547193","span_id":"030a8385e4831673","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:723\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken
{"level":"INFO","timestamp":"2025-06-25T23:43:54.035+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.035+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.035+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"invalid-to...","session_id":"invalid-session"}
{"level":"WARN","timestamp":"2025-06-25T23:43:54.046+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","user_id":"","tenant_id":"","auth_method":"one_time_token","reason":"invalid_token","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:513\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:750\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:54.046+0530","caller":"rest/oauth_handler.go:514","message":"One-time token verification failed - invalid token or session","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:514\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:750\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.046+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":401,"duration":0.010533334}
{"level":"WARN","timestamp":"2025-06-25T23:43:54.046+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"0a5584098408fd37bbf301abc089d10a","trace_id":"0a5584098408fd37bbf301abc089d10a","span_id":"e86d41e96deec23f","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:750\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_WithAllFields
{"level":"INFO","timestamp":"2025-06-25T23:43:54.046+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"b289a53eb3ebd715e24e3222fa7b1401","trace_id":"b289a53eb3ebd715e24e3222fa7b1401","span_id":"3a3e8664d00e5d9d","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"b289a53eb3ebd715e24e3222fa7b1401","trace_id":"b289a53eb3ebd715e24e3222fa7b1401","span_id":"3a3e8664d00e5d9d","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.046+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"b289a53eb3ebd715e24e3222fa7b1401","trace_id":"b289a53eb3ebd715e24e3222fa7b1401","span_id":"3a3e8664d00e5d9d","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.046+0530","caller":"rest/oauth_handler.go:598","message":"Session refresh validation passed","request_id":"b289a53eb3ebd715e24e3222fa7b1401","trace_id":"b289a53eb3ebd715e24e3222fa7b1401","span_id":"3a3e8664d00e5d9d","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"rest/oauth_handler.go:637","message":"Business event","request_id":"b289a53eb3ebd715e24e3222fa7b1401","trace_id":"b289a53eb3ebd715e24e3222fa7b1401","span_id":"3a3e8664d00e5d9d","event_type":"session_refreshed","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","duration_ms":9}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"b289a53eb3ebd715e24e3222fa7b1401","trace_id":"b289a53eb3ebd715e24e3222fa7b1401","span_id":"3a3e8664d00e5d9d","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"b289a53eb3ebd715e24e3222fa7b1401","trace_id":"b289a53eb3ebd715e24e3222fa7b1401","span_id":"3a3e8664d00e5d9d","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.009132334}
--- PASS: TestOAuthHandler_RefreshSession_WithAllFields (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_WithInvalidJSON
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"4b9c6b945aff4c508d11bef0a62d7e16","trace_id":"4b9c6b945aff4c508d11bef0a62d7e16","span_id":"fb725e57b698ea50","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"4b9c6b945aff4c508d11bef0a62d7e16","trace_id":"4b9c6b945aff4c508d11bef0a62d7e16","span_id":"fb725e57b698ea50","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"4b9c6b945aff4c508d11bef0a62d7e16","trace_id":"4b9c6b945aff4c508d11bef0a62d7e16","span_id":"fb725e57b698ea50","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:54.055+0530","caller":"rest/oauth_handler.go:589","message":"Session refresh failed - missing parameters","request_id":"4b9c6b945aff4c508d11bef0a62d7e16","trace_id":"4b9c6b945aff4c508d11bef0a62d7e16","span_id":"fb725e57b698ea50","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).RefreshSession\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:589\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:810\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"4b9c6b945aff4c508d11bef0a62d7e16","trace_id":"4b9c6b945aff4c508d11bef0a62d7e16","span_id":"fb725e57b698ea50","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"4b9c6b945aff4c508d11bef0a62d7e16","trace_id":"4b9c6b945aff4c508d11bef0a62d7e16","span_id":"fb725e57b698ea50","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000058916}
{"level":"WARN","timestamp":"2025-06-25T23:43:54.055+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"4b9c6b945aff4c508d11bef0a62d7e16","trace_id":"4b9c6b945aff4c508d11bef0a62d7e16","span_id":"fb725e57b698ea50","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":33,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:810\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_RefreshSession_WithInvalidJSON (0.00s)
=== RUN   TestOAuthHandler_RefreshSession_WithEmptyBody
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","trace_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","span_id":"63bcbd61b73052b0","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","trace_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","span_id":"63bcbd61b73052b0","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","trace_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","span_id":"63bcbd61b73052b0","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:54.055+0530","caller":"rest/oauth_handler.go:589","message":"Session refresh failed - missing parameters","request_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","trace_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","span_id":"63bcbd61b73052b0","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).RefreshSession\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:589\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:837\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","trace_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","span_id":"63bcbd61b73052b0","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","trace_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","span_id":"63bcbd61b73052b0","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000032459}
{"level":"WARN","timestamp":"2025-06-25T23:43:54.055+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","trace_id":"dec712969f9a02ba9a59a2dfd7d3ce6b","span_id":"63bcbd61b73052b0","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:837\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_RefreshSession_WithEmptyBody (0.00s)
=== RUN   TestOAuthHandler_ClientCredentials_WithScope
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"85a050f7cb98fe233893c6e67c2a1a35","trace_id":"85a050f7cb98fe233893c6e67c2a1a35","span_id":"1abc1057f32c4b4d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"85a050f7cb98fe233893c6e67c2a1a35","trace_id":"85a050f7cb98fe233893c6e67c2a1a35","span_id":"1abc1057f32c4b4d","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"85a050f7cb98fe233893c6e67c2a1a35","trace_id":"85a050f7cb98fe233893c6e67c2a1a35","span_id":"1abc1057f32c4b4d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.055+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"85a050f7cb98fe233893c6e67c2a1a35","trace_id":"85a050f7cb98fe233893c6e67c2a1a35","span_id":"1abc1057f32c4b4d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":"read:users write:users"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.076+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"85a050f7cb98fe233893c6e67c2a1a35","trace_id":"85a050f7cb98fe233893c6e67c2a1a35","span_id":"1abc1057f32c4b4d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"85a050f7cb98fe233893c6e67c2a1a35","trace_id":"85a050f7cb98fe233893c6e67c2a1a35","span_id":"1abc1057f32c4b4d","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.076+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"85a050f7cb98fe233893c6e67c2a1a35","trace_id":"85a050f7cb98fe233893c6e67c2a1a35","span_id":"1abc1057f32c4b4d","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"read:users write:users","duration_ms":21}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.076+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"85a050f7cb98fe233893c6e67c2a1a35","trace_id":"85a050f7cb98fe233893c6e67c2a1a35","span_id":"1abc1057f32c4b4d","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"85a050f7cb98fe233893c6e67c2a1a35","trace_id":"85a050f7cb98fe233893c6e67c2a1a35","span_id":"1abc1057f32c4b4d","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.021122292}
--- PASS: TestOAuthHandler_ClientCredentials_WithScope (0.02s)
=== RUN   TestOAuthHandler_ClientCredentials_WithoutScope
{"level":"INFO","timestamp":"2025-06-25T23:43:54.076+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"babaabcdbcb893cd08a7741e0e8499e7","trace_id":"babaabcdbcb893cd08a7741e0e8499e7","span_id":"5f04da54a36e0ef7","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"babaabcdbcb893cd08a7741e0e8499e7","trace_id":"babaabcdbcb893cd08a7741e0e8499e7","span_id":"5f04da54a36e0ef7","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.076+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"babaabcdbcb893cd08a7741e0e8499e7","trace_id":"babaabcdbcb893cd08a7741e0e8499e7","span_id":"5f04da54a36e0ef7","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.076+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"babaabcdbcb893cd08a7741e0e8499e7","trace_id":"babaabcdbcb893cd08a7741e0e8499e7","span_id":"5f04da54a36e0ef7","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.098+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"babaabcdbcb893cd08a7741e0e8499e7","trace_id":"babaabcdbcb893cd08a7741e0e8499e7","span_id":"5f04da54a36e0ef7","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"babaabcdbcb893cd08a7741e0e8499e7","trace_id":"babaabcdbcb893cd08a7741e0e8499e7","span_id":"5f04da54a36e0ef7","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.098+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"babaabcdbcb893cd08a7741e0e8499e7","trace_id":"babaabcdbcb893cd08a7741e0e8499e7","span_id":"5f04da54a36e0ef7","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","duration_ms":21,"scope":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.098+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"babaabcdbcb893cd08a7741e0e8499e7","trace_id":"babaabcdbcb893cd08a7741e0e8499e7","span_id":"5f04da54a36e0ef7","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"babaabcdbcb893cd08a7741e0e8499e7","trace_id":"babaabcdbcb893cd08a7741e0e8499e7","span_id":"5f04da54a36e0ef7","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.021206334}
--- PASS: TestOAuthHandler_ClientCredentials_WithoutScope (0.02s)
=== RUN   TestOAuthHandler_ClientCredentials_WithEmptyScope
{"level":"INFO","timestamp":"2025-06-25T23:43:54.098+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8b08efaf369908728c3227f6df405c03","trace_id":"8b08efaf369908728c3227f6df405c03","span_id":"9168b472ccded2a9","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"8b08efaf369908728c3227f6df405c03","trace_id":"8b08efaf369908728c3227f6df405c03","span_id":"9168b472ccded2a9","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.098+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"8b08efaf369908728c3227f6df405c03","trace_id":"8b08efaf369908728c3227f6df405c03","span_id":"9168b472ccded2a9","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.098+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"8b08efaf369908728c3227f6df405c03","trace_id":"8b08efaf369908728c3227f6df405c03","span_id":"9168b472ccded2a9","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"8b08efaf369908728c3227f6df405c03","trace_id":"8b08efaf369908728c3227f6df405c03","span_id":"9168b472ccded2a9","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"8b08efaf369908728c3227f6df405c03","trace_id":"8b08efaf369908728c3227f6df405c03","span_id":"9168b472ccded2a9","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"8b08efaf369908728c3227f6df405c03","trace_id":"8b08efaf369908728c3227f6df405c03","span_id":"9168b472ccded2a9","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"","duration_ms":20}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8b08efaf369908728c3227f6df405c03","trace_id":"8b08efaf369908728c3227f6df405c03","span_id":"9168b472ccded2a9","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"8b08efaf369908728c3227f6df405c03","trace_id":"8b08efaf369908728c3227f6df405c03","span_id":"9168b472ccded2a9","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.020418417}
--- PASS: TestOAuthHandler_ClientCredentials_WithEmptyScope (0.02s)
=== RUN   TestOAuthHandler_GoogleLogin_WithEmptyRedirectURI
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"eb4af877691bc077f2048780297d539e","trace_id":"eb4af877691bc077f2048780297d539e","span_id":"ddfd41a86387c8f7","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"eb4af877691bc077f2048780297d539e","trace_id":"eb4af877691bc077f2048780297d539e","span_id":"ddfd41a86387c8f7","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"eb4af877691bc077f2048780297d539e","trace_id":"eb4af877691bc077f2048780297d539e","span_id":"ddfd41a86387c8f7","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"eb4af877691bc077f2048780297d539e","trace_id":"eb4af877691bc077f2048780297d539e","span_id":"ddfd41a86387c8f7","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"eb4af877691bc077f2048780297d539e","trace_id":"eb4af877691bc077f2048780297d539e","span_id":"ddfd41a86387c8f7","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"eb4af877691bc077f2048780297d539e","trace_id":"eb4af877691bc077f2048780297d539e","span_id":"ddfd41a86387c8f7","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"eb4af877691bc077f2048780297d539e","trace_id":"eb4af877691bc077f2048780297d539e","span_id":"ddfd41a86387c8f7","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"http://localhost:8080/api/v1/oauth/google/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"eb4af877691bc077f2048780297d539e","trace_id":"eb4af877691bc077f2048780297d539e","span_id":"ddfd41a86387c8f7","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"eb4af877691bc077f2048780297d539e","trace_id":"eb4af877691bc077f2048780297d539e","span_id":"ddfd41a86387c8f7","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000061625}
--- PASS: TestOAuthHandler_GoogleLogin_WithEmptyRedirectURI (0.00s)
=== RUN   TestOAuthHandler_GoogleCallback_WithEmptyState
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.118+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"","code_prefix":"test-auth-..."}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.170+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","user_id":"google-user-123","tenant_id":"","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.170+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","provider":"google","step":"callback_success","tenant_id":"","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.170+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":51}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.170+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"53b14d1488118318fcd2329193500c43","trace_id":"53b14d1488118318fcd2329193500c43","span_id":"e96a4528886c23f9","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.051136708}
--- PASS: TestOAuthHandler_GoogleCallback_WithEmptyState (0.05s)
=== RUN   TestOAuthHandler_GoogleCallback_WithOnlyCode
{"level":"INFO","timestamp":"2025-06-25T23:43:54.170+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.170+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.170+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"","code_prefix":"test-auth-..."}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","user_id":"google-user-123","tenant_id":"","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","provider":"google","step":"callback_success","tenant_id":"","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":51}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"8ca8c0071b26f32d1d97328e4f00fab3","trace_id":"8ca8c0071b26f32d1d97328e4f00fab3","span_id":"fd341e287abd21c4","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.051225417}
--- PASS: TestOAuthHandler_GoogleCallback_WithOnlyCode (0.05s)
=== RUN   TestOAuthHandler_GoogleCallback_WithOnlyError
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"WARN","timestamp":"2025-06-25T23:43:54.221+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","user_id":"","tenant_id":"","auth_method":"google_oauth","reason":"oauth_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:153\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:1063\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-25T23:43:54.221+0530","caller":"logger/logger.go:225","message":"OAuth flow failed","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","provider":"google","step":"callback_error","tenant_id":"","client_ip":"192.0.2.1:1234","error":"oauth error: access_denied","stacktrace":"auth-service/internal/logger.(*RequestLogger).OAuthFlow\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:225\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:154\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:1063\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.00010975}
{"level":"WARN","timestamp":"2025-06-25T23:43:54.221+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"ec2a6757901f6240e236eb4ad0f140da","trace_id":"ec2a6757901f6240e236eb4ad0f140da","span_id":"d7f5ebcc7cb3e638","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:1063\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleCallback_WithOnlyError (0.00s)
=== RUN   TestOAuthHandler_Integration
=== RUN   TestOAuthHandler_Integration/GoogleLogin
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"927936ba8e3198da12259739b7e727e2","trace_id":"927936ba8e3198da12259739b7e727e2","span_id":"f7719be1761d38df","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"927936ba8e3198da12259739b7e727e2","trace_id":"927936ba8e3198da12259739b7e727e2","span_id":"f7719be1761d38df","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"927936ba8e3198da12259739b7e727e2","trace_id":"927936ba8e3198da12259739b7e727e2","span_id":"f7719be1761d38df","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"927936ba8e3198da12259739b7e727e2","trace_id":"927936ba8e3198da12259739b7e727e2","span_id":"f7719be1761d38df","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"927936ba8e3198da12259739b7e727e2","trace_id":"927936ba8e3198da12259739b7e727e2","span_id":"f7719be1761d38df","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"927936ba8e3198da12259739b7e727e2","trace_id":"927936ba8e3198da12259739b7e727e2","span_id":"f7719be1761d38df","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.221+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"927936ba8e3198da12259739b7e727e2","trace_id":"927936ba8e3198da12259739b7e727e2","span_id":"f7719be1761d38df","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"http://localhost:8080/api/v1/oauth/google/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.222+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"927936ba8e3198da12259739b7e727e2","trace_id":"927936ba8e3198da12259739b7e727e2","span_id":"f7719be1761d38df","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"927936ba8e3198da12259739b7e727e2","trace_id":"927936ba8e3198da12259739b7e727e2","span_id":"f7719be1761d38df","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000354}
=== RUN   TestOAuthHandler_Integration/GoogleCallback
{"level":"INFO","timestamp":"2025-06-25T23:43:54.222+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.222+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.222+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","code_prefix":"test-code..."}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.273+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","user_id":"google-user-123","tenant_id":"tenant-123","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.273+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","provider":"google","step":"callback_success","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.273+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":51}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.273+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"052636b409ce1417feac7ae43e708016","trace_id":"052636b409ce1417feac7ae43e708016","span_id":"bd4f3a0e5b4b76df","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.051160375}
=== RUN   TestOAuthHandler_Integration/ClientCredentials
{"level":"INFO","timestamp":"2025-06-25T23:43:54.273+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"0af249b99b20edafc1ade3f273c8dd74","trace_id":"0af249b99b20edafc1ade3f273c8dd74","span_id":"05551ce0adeb9498","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"0af249b99b20edafc1ade3f273c8dd74","trace_id":"0af249b99b20edafc1ade3f273c8dd74","span_id":"05551ce0adeb9498","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.273+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"0af249b99b20edafc1ade3f273c8dd74","trace_id":"0af249b99b20edafc1ade3f273c8dd74","span_id":"05551ce0adeb9498","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.273+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"0af249b99b20edafc1ade3f273c8dd74","trace_id":"0af249b99b20edafc1ade3f273c8dd74","span_id":"05551ce0adeb9498","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.294+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"0af249b99b20edafc1ade3f273c8dd74","trace_id":"0af249b99b20edafc1ade3f273c8dd74","span_id":"05551ce0adeb9498","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"0af249b99b20edafc1ade3f273c8dd74","trace_id":"0af249b99b20edafc1ade3f273c8dd74","span_id":"05551ce0adeb9498","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.294+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"0af249b99b20edafc1ade3f273c8dd74","trace_id":"0af249b99b20edafc1ade3f273c8dd74","span_id":"05551ce0adeb9498","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"","duration_ms":21}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.294+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"0af249b99b20edafc1ade3f273c8dd74","trace_id":"0af249b99b20edafc1ade3f273c8dd74","span_id":"05551ce0adeb9498","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"0af249b99b20edafc1ade3f273c8dd74","trace_id":"0af249b99b20edafc1ade3f273c8dd74","span_id":"05551ce0adeb9498","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.021145709}
=== RUN   TestOAuthHandler_Integration/CreateOneTimeToken
{"level":"INFO","timestamp":"2025-06-25T23:43:54.294+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"d8d3ed89dd5f21a134903cff4826764f","trace_id":"d8d3ed89dd5f21a134903cff4826764f","span_id":"bb1daa1a055e03d8","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"d8d3ed89dd5f21a134903cff4826764f","trace_id":"d8d3ed89dd5f21a134903cff4826764f","span_id":"bb1daa1a055e03d8","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.294+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"d8d3ed89dd5f21a134903cff4826764f","trace_id":"d8d3ed89dd5f21a134903cff4826764f","span_id":"bb1daa1a055e03d8","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.294+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"d8d3ed89dd5f21a134903cff4826764f","trace_id":"d8d3ed89dd5f21a134903cff4826764f","span_id":"bb1daa1a055e03d8","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":0,"max_uses":0}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.310+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"d8d3ed89dd5f21a134903cff4826764f","trace_id":"d8d3ed89dd5f21a134903cff4826764f","span_id":"bb1daa1a055e03d8","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","expires_in":0,"max_uses":0,"duration_ms":15}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.310+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"d8d3ed89dd5f21a134903cff4826764f","trace_id":"d8d3ed89dd5f21a134903cff4826764f","span_id":"bb1daa1a055e03d8","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"d8d3ed89dd5f21a134903cff4826764f","trace_id":"d8d3ed89dd5f21a134903cff4826764f","span_id":"bb1daa1a055e03d8","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.015613667}
=== RUN   TestOAuthHandler_Integration/VerifyOneTimeToken
{"level":"INFO","timestamp":"2025-06-25T23:43:54.310+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"bc0b810bf82eb8b2b8534969ed89a86d","trace_id":"bc0b810bf82eb8b2b8534969ed89a86d","span_id":"b55132cb82e4203b","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"bc0b810bf82eb8b2b8534969ed89a86d","trace_id":"bc0b810bf82eb8b2b8534969ed89a86d","span_id":"b55132cb82e4203b","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.310+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"bc0b810bf82eb8b2b8534969ed89a86d","trace_id":"bc0b810bf82eb8b2b8534969ed89a86d","span_id":"b55132cb82e4203b","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.310+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"bc0b810bf82eb8b2b8534969ed89a86d","trace_id":"bc0b810bf82eb8b2b8534969ed89a86d","span_id":"b55132cb82e4203b","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.321+0530","caller":"rest/oauth_handler.go:542","message":"Business event","request_id":"bc0b810bf82eb8b2b8534969ed89a86d","trace_id":"bc0b810bf82eb8b2b8534969ed89a86d","span_id":"b55132cb82e4203b","event_type":"one_time_token_verified","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","is_valid":true,"duration_ms":11}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.321+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"bc0b810bf82eb8b2b8534969ed89a86d","trace_id":"bc0b810bf82eb8b2b8534969ed89a86d","span_id":"b55132cb82e4203b","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"bc0b810bf82eb8b2b8534969ed89a86d","trace_id":"bc0b810bf82eb8b2b8534969ed89a86d","span_id":"b55132cb82e4203b","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.011146792}
=== RUN   TestOAuthHandler_Integration/RefreshSession
{"level":"INFO","timestamp":"2025-06-25T23:43:54.321+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"9c0fd589755971ebd43641c83f64d66a","trace_id":"9c0fd589755971ebd43641c83f64d66a","span_id":"d78184a312612cbb","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"9c0fd589755971ebd43641c83f64d66a","trace_id":"9c0fd589755971ebd43641c83f64d66a","span_id":"d78184a312612cbb","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.321+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"9c0fd589755971ebd43641c83f64d66a","trace_id":"9c0fd589755971ebd43641c83f64d66a","span_id":"d78184a312612cbb","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.321+0530","caller":"rest/oauth_handler.go:598","message":"Session refresh validation passed","request_id":"9c0fd589755971ebd43641c83f64d66a","trace_id":"9c0fd589755971ebd43641c83f64d66a","span_id":"d78184a312612cbb","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.330+0530","caller":"rest/oauth_handler.go:637","message":"Business event","request_id":"9c0fd589755971ebd43641c83f64d66a","trace_id":"9c0fd589755971ebd43641c83f64d66a","span_id":"d78184a312612cbb","event_type":"session_refreshed","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","duration_ms":9}
{"level":"INFO","timestamp":"2025-06-25T23:43:54.330+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"9c0fd589755971ebd43641c83f64d66a","trace_id":"9c0fd589755971ebd43641c83f64d66a","span_id":"d78184a312612cbb","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"9c0fd589755971ebd43641c83f64d66a","trace_id":"9c0fd589755971ebd43641c83f64d66a","span_id":"d78184a312612cbb","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.009123291}
--- PASS: TestOAuthHandler_Integration (0.11s)
    --- PASS: TestOAuthHandler_Integration/GoogleLogin (0.00s)
    --- PASS: TestOAuthHandler_Integration/GoogleCallback (0.05s)
    --- PASS: TestOAuthHandler_Integration/ClientCredentials (0.02s)
    --- PASS: TestOAuthHandler_Integration/CreateOneTimeToken (0.02s)
    --- PASS: TestOAuthHandler_Integration/VerifyOneTimeToken (0.01s)
    --- PASS: TestOAuthHandler_Integration/RefreshSession (0.01s)
PASS
ok  	auth-service/internal/handler/rest	(cached)
