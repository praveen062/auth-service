	auth-service/docs		coverage: 0.0% of statements
=== RUN   TestMain_LoadConfig_Success
--- PASS: TestMain_LoadConfig_Success (0.00s)
=== RUN   TestMain_LoadConfig_FileNotFound
--- PASS: TestMain_LoadConfig_FileNotFound (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_AllowedIP
--- PASS: TestMain_IPAllowlistMiddleware_AllowedIP (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_BlockedIP
--- PASS: TestMain_IPAllowlistMiddleware_BlockedIP (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_IPv6Allowed
--- PASS: TestMain_IPAllowlistMiddleware_IPv6Allowed (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_EmptyAllowedIPs
--- PASS: TestMain_IPAllowlistMiddleware_EmptyAllowedIPs (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_ProxyHeaders
--- PASS: TestMain_IPAllowlistMiddleware_ProxyHeaders (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_RealIPHeader
--- PASS: TestMain_IPAllowlistMiddleware_RealIPHeader (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_MultipleForwardedIPs
--- PASS: TestMain_IPAllowlistMiddleware_MultipleForwardedIPs (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_InvalidIP
--- PASS: TestMain_IPAllowlistMiddleware_InvalidIP (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_SubnetMatching
--- PASS: TestMain_IPAllowlistMiddleware_SubnetMatching (0.00s)
=== RUN   TestMain_IPAllowlistMiddleware_SubnetBlocked
--- PASS: TestMain_IPAllowlistMiddleware_SubnetBlocked (0.00s)
=== RUN   TestMain_ConfigurationValidation
--- PASS: TestMain_ConfigurationValidation (0.00s)
=== RUN   TestMain_DatabaseDSN_Generation
--- PASS: TestMain_DatabaseDSN_Generation (0.00s)
=== RUN   TestMain_RedisAddr_Generation
--- PASS: TestMain_RedisAddr_Generation (0.00s)
=== RUN   TestMain_EnvironmentVariableOverride
--- PASS: TestMain_EnvironmentVariableOverride (0.00s)
=== RUN   TestIPAllowlistMiddleware_AllowedIP
--- PASS: TestIPAllowlistMiddleware_AllowedIP (0.00s)
=== RUN   TestIPAllowlistMiddleware_AllowedIPWithPort
--- PASS: TestIPAllowlistMiddleware_AllowedIPWithPort (0.00s)
=== RUN   TestIPAllowlistMiddleware_AllowedIPSubnet
--- PASS: TestIPAllowlistMiddleware_AllowedIPSubnet (0.00s)
=== RUN   TestIPAllowlistMiddleware_DisallowedIP
--- PASS: TestIPAllowlistMiddleware_DisallowedIP (0.00s)
=== RUN   TestIPAllowlistMiddleware_EmptyAllowedIPs
--- PASS: TestIPAllowlistMiddleware_EmptyAllowedIPs (0.00s)
=== RUN   TestIPAllowlistMiddleware_NoRemoteAddr
--- PASS: TestIPAllowlistMiddleware_NoRemoteAddr (0.00s)
=== RUN   TestIPAllowlistMiddleware_IPv6Allowed
--- PASS: TestIPAllowlistMiddleware_IPv6Allowed (0.00s)
=== RUN   TestIPAllowlistMiddleware_IPv6Disallowed
--- PASS: TestIPAllowlistMiddleware_IPv6Disallowed (0.00s)
=== RUN   TestIPAllowlistMiddleware_MultipleAllowedIPs
--- PASS: TestIPAllowlistMiddleware_MultipleAllowedIPs (0.00s)
=== RUN   TestIPAllowlistMiddleware_InvalidIPFormat
--- PASS: TestIPAllowlistMiddleware_InvalidIPFormat (0.00s)
=== RUN   TestIPAllowlistMiddleware_EmptyRemoteAddr
--- PASS: TestIPAllowlistMiddleware_EmptyRemoteAddr (0.00s)
=== RUN   TestIPAllowlistMiddleware_Integration
=== RUN   TestIPAllowlistMiddleware_Integration/Allowed_IPv4
=== RUN   TestIPAllowlistMiddleware_Integration/Allowed_IPv4_Subnet
=== RUN   TestIPAllowlistMiddleware_Integration/Allowed_IPv6
=== RUN   TestIPAllowlistMiddleware_Integration/Disallowed_IPv4
=== RUN   TestIPAllowlistMiddleware_Integration/Disallowed_IPv6
=== RUN   TestIPAllowlistMiddleware_Integration/Empty_Remote_Addr
=== RUN   TestIPAllowlistMiddleware_Integration/Invalid_Format
--- PASS: TestIPAllowlistMiddleware_Integration (0.00s)
    --- PASS: TestIPAllowlistMiddleware_Integration/Allowed_IPv4 (0.00s)
    --- PASS: TestIPAllowlistMiddleware_Integration/Allowed_IPv4_Subnet (0.00s)
    --- PASS: TestIPAllowlistMiddleware_Integration/Allowed_IPv6 (0.00s)
    --- PASS: TestIPAllowlistMiddleware_Integration/Disallowed_IPv4 (0.00s)
    --- PASS: TestIPAllowlistMiddleware_Integration/Disallowed_IPv6 (0.00s)
    --- PASS: TestIPAllowlistMiddleware_Integration/Empty_Remote_Addr (0.00s)
    --- PASS: TestIPAllowlistMiddleware_Integration/Invalid_Format (0.00s)
=== RUN   TestMain_ServerSetup
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"server/main_test.go:945","message":"Health check registered","name":"memory"}
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"server/main_test.go:946","message":"Health check registered","name":"goroutines"}
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"server/main_test.go:947","message":"Health check registered","name":"disk"}
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"server/main_test.go:955","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestMain_ServerSetup (0.00s)
=== RUN   TestMain_ActuatorSetup
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"server/main_test.go:1018","message":"Health check registered","name":"memory"}
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"server/main_test.go:1019","message":"Health check registered","name":"goroutines"}
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"server/main_test.go:1020","message":"Health check registered","name":"disk"}
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"server/main_test.go:1028","message":"Actuator routes registered","base_path":"/actuator"}
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"actuator/actuator.go:194","message":"Application info request received","request_id":"d03dc89bc9a80e828eb405398047af03","trace_id":"d03dc89bc9a80e828eb405398047af03","span_id":"a440bfd4b0150e13","method":"GET","path":"/actuator/info","client_ip":""}
--- PASS: TestMain_ActuatorSetup (0.00s)
=== RUN   TestMain_HandlerSetup
{"level":"INFO","timestamp":"2025-06-26T01:18:49.674+0530","caller":"rest/auth_handler.go:95","message":"Login attempt started","request_id":"4369292058e4ef616b1cb7ca78c01824","trace_id":"4369292058e4ef616b1cb7ca78c01824","span_id":"7b4dc11562522118","method":"POST","path":"/api/v1/auth/login","client_ip":"","endpoint":"/auth/login","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:49.674+0530","caller":"rest/auth_handler.go:115","message":"Tenant context missing","request_id":"4369292058e4ef616b1cb7ca78c01824","trace_id":"4369292058e4ef616b1cb7ca78c01824","span_id":"7b4dc11562522118","method":"POST","path":"/api/v1/auth/login","client_ip":"","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:115\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/cmd/server.TestMain_HandlerSetup.func1\n\t/Users/Licious/Desktop/repository/auth-service/cmd/server/main_test.go:1076\nauth-service/cmd/server.isolateEnvVars\n\t/Users/Licious/Desktop/repository/auth-service/cmd/server/main_test.go:175\nauth-service/cmd/server.TestMain_HandlerSetup\n\t/Users/Licious/Desktop/repository/auth-service/cmd/server/main_test.go:1043\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
    main_test.go:1079: 
        	Error Trace:	/Users/Licious/Desktop/repository/auth-service/cmd/server/main_test.go:1079
        	            				/Users/Licious/Desktop/repository/auth-service/cmd/server/main_test.go:175
        	            				/Users/Licious/Desktop/repository/auth-service/cmd/server/main_test.go:1043
        	Error:      	Not equal: 
        	            	expected: 200
        	            	actual  : 500
        	Test:       	TestMain_HandlerSetup
--- FAIL: TestMain_HandlerSetup (0.00s)
=== RUN   TestMain_SwaggerSetup
--- PASS: TestMain_SwaggerSetup (0.00s)
=== RUN   TestMain_ErrorHandling
--- PASS: TestMain_ErrorHandling (0.00s)
=== RUN   TestMain_AddressGeneration
--- PASS: TestMain_AddressGeneration (0.00s)
=== RUN   TestMain_PrintfStatements
--- PASS: TestMain_PrintfStatements (0.00s)
FAIL
coverage: 12.7% of statements
FAIL	auth-service/cmd/server	0.616s
=== RUN   TestNewActuator
--- PASS: TestNewActuator (0.00s)
=== RUN   TestActuator_Info
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator_test.go:47","message":"Actuator routes registered","base_path":"/actuator"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:194","message":"Application info request received","request_id":"063e1e11052dc26d2435f5a8d7458038","trace_id":"063e1e11052dc26d2435f5a8d7458038","span_id":"4f6936c140a66053","method":"GET","path":"/actuator/info","client_ip":""}
--- PASS: TestActuator_Info (0.00s)
=== RUN   TestActuator_Health
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator_test.go:70","message":"Actuator routes registered","base_path":"/actuator"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:157","message":"Health check request received","request_id":"0690c3336e6c5e4661b79ca32613ffab","trace_id":"0690c3336e6c5e4661b79ca32613ffab","span_id":"d9aa432cb0c46cb8","method":"GET","path":"/actuator/health","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:162","message":"Business event","request_id":"0690c3336e6c5e4661b79ca32613ffab","trace_id":"0690c3336e6c5e4661b79ca32613ffab","span_id":"d9aa432cb0c46cb8","event_type":"health_check","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/health"}
--- PASS: TestActuator_Health (0.00s)
=== RUN   TestActuator_Liveness
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator_test.go:84","message":"Actuator routes registered","base_path":"/actuator"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:170","message":"Liveness check request received","request_id":"1d298ace85562084c1e721da7358ee48","trace_id":"1d298ace85562084c1e721da7358ee48","span_id":"d0d0da0493d4d55f","method":"GET","path":"/actuator/health/live","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:174","message":"Business event","request_id":"1d298ace85562084c1e721da7358ee48","trace_id":"1d298ace85562084c1e721da7358ee48","span_id":"d0d0da0493d4d55f","event_type":"liveness_check","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/health/live"}
--- PASS: TestActuator_Liveness (0.00s)
=== RUN   TestActuator_Readiness
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator_test.go:98","message":"Actuator routes registered","base_path":"/actuator"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:182","message":"Readiness check request received","request_id":"c1efd25d2210fcbf9408639effc5335e","trace_id":"c1efd25d2210fcbf9408639effc5335e","span_id":"fcb655bff0495c63","method":"GET","path":"/actuator/health/ready","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:186","message":"Business event","request_id":"c1efd25d2210fcbf9408639effc5335e","trace_id":"c1efd25d2210fcbf9408639effc5335e","span_id":"fcb655bff0495c63","event_type":"readiness_check","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/health/ready"}
--- PASS: TestActuator_Readiness (0.00s)
=== RUN   TestActuator_Environment
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator_test.go:112","message":"Actuator routes registered","base_path":"/actuator"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:202","message":"Environment info request received","request_id":"3432896739a35c3ac3c875ada45c921c","trace_id":"3432896739a35c3ac3c875ada45c921c","span_id":"51fec392530baec3","method":"GET","path":"/actuator/env","client_ip":""}
--- PASS: TestActuator_Environment (0.00s)
=== RUN   TestActuator_Metrics
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator_test.go:136","message":"Actuator routes registered","base_path":"/actuator"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:220","message":"Metrics request received","request_id":"e749fe6c31392f7948e88ced1e18111c","trace_id":"e749fe6c31392f7948e88ced1e18111c","span_id":"77144dc5ec46d9d8","method":"GET","path":"/actuator/metrics","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:230","message":"Business event","request_id":"e749fe6c31392f7948e88ced1e18111c","trace_id":"e749fe6c31392f7948e88ced1e18111c","span_id":"77144dc5ec46d9d8","event_type":"metrics_request","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/metrics"}
--- PASS: TestActuator_Metrics (0.00s)
=== RUN   TestActuator_PrometheusMetrics
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator_test.go:160","message":"Actuator routes registered","base_path":"/actuator"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:240","message":"Prometheus metrics request received","request_id":"5f4ef7ca4f6d25005b3903be075982d3","trace_id":"5f4ef7ca4f6d25005b3903be075982d3","span_id":"66e877d530258d0e","method":"GET","path":"/actuator/prometheus","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.077+0530","caller":"actuator/actuator.go:245","message":"Business event","request_id":"5f4ef7ca4f6d25005b3903be075982d3","trace_id":"5f4ef7ca4f6d25005b3903be075982d3","span_id":"66e877d530258d0e","event_type":"prometheus_metrics_request","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/prometheus"}
--- PASS: TestActuator_PrometheusMetrics (0.00s)
=== RUN   TestActuator_Status
{"level":"INFO","timestamp":"2025-06-26T01:18:51.078+0530","caller":"actuator/actuator_test.go:175","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_Status (0.00s)
=== RUN   TestActuator_Uptime
{"level":"INFO","timestamp":"2025-06-26T01:18:51.078+0530","caller":"actuator/actuator_test.go:201","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_Uptime (0.00s)
=== RUN   TestActuator_ThreadDump
{"level":"INFO","timestamp":"2025-06-26T01:18:51.078+0530","caller":"actuator/actuator_test.go:224","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_ThreadDump (0.00s)
=== RUN   TestActuator_HeapDump
{"level":"INFO","timestamp":"2025-06-26T01:18:51.078+0530","caller":"actuator/actuator_test.go:246","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_HeapDump (0.00s)
=== RUN   TestActuator_Mappings
{"level":"INFO","timestamp":"2025-06-26T01:18:51.078+0530","caller":"actuator/actuator_test.go:275","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_Mappings (0.00s)
=== RUN   TestActuator_Loggers
{"level":"INFO","timestamp":"2025-06-26T01:18:51.078+0530","caller":"actuator/actuator_test.go:308","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_Loggers (0.00s)
=== RUN   TestActuator_SetLoggerLevel
{"level":"INFO","timestamp":"2025-06-26T01:18:51.078+0530","caller":"actuator/actuator_test.go:329","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_SetLoggerLevel (0.00s)
=== RUN   TestActuator_RecordRequest
--- PASS: TestActuator_RecordRequest (0.00s)
=== RUN   TestActuator_StartEndRequest
--- PASS: TestActuator_StartEndRequest (0.00s)
=== RUN   TestActuator_GetMemoryStats
--- PASS: TestActuator_GetMemoryStats (0.00s)
=== RUN   TestActuator_GetRuntimeStats
--- PASS: TestActuator_GetRuntimeStats (0.00s)
=== RUN   TestActuator_GetRequestStats
--- PASS: TestActuator_GetRequestStats (0.00s)
=== RUN   TestActuator_RegisterHealthCheck
{"level":"INFO","timestamp":"2025-06-26T01:18:51.078+0530","caller":"actuator/actuator_test.go:416","message":"Health check registered","name":"test-check"}
--- PASS: TestActuator_RegisterHealthCheck (0.00s)
=== RUN   TestActuator_RegisterReadinessCheck
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator_test.go:429","message":"Readiness check registered","name":"test-readiness"}
--- PASS: TestActuator_RegisterReadinessCheck (0.00s)
=== RUN   TestActuator_ConfigProps
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator_test.go:452","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_ConfigProps (0.00s)
=== RUN   TestActuator_SetLoggerLevel_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator_test.go:478","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_SetLoggerLevel_Success (0.00s)
=== RUN   TestActuator_SetLoggerLevel_InvalidJSON
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator_test.go:502","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_SetLoggerLevel_InvalidJSON (0.00s)
=== RUN   TestActuator_SetLoggerLevel_EmptyBody
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator_test.go:524","message":"Actuator routes registered","base_path":"/actuator"}
--- PASS: TestActuator_SetLoggerLevel_EmptyBody (0.00s)
=== RUN   TestActuator_RegisterRoutes_AllEndpoints
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator_test.go:546","message":"Actuator routes registered","base_path":"/actuator"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:157","message":"Health check request received","request_id":"cc9d6f11d1fcb4aae1f9944d093db287","trace_id":"cc9d6f11d1fcb4aae1f9944d093db287","span_id":"f5e2f984cdc15733","method":"GET","path":"/actuator/health","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:162","message":"Business event","request_id":"cc9d6f11d1fcb4aae1f9944d093db287","trace_id":"cc9d6f11d1fcb4aae1f9944d093db287","span_id":"f5e2f984cdc15733","event_type":"health_check","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/health"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:170","message":"Liveness check request received","request_id":"93fc27dfa8e58fe0969b9f19ae5b508f","trace_id":"93fc27dfa8e58fe0969b9f19ae5b508f","span_id":"f22baaf28f165436","method":"GET","path":"/actuator/health/live","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:174","message":"Business event","request_id":"93fc27dfa8e58fe0969b9f19ae5b508f","trace_id":"93fc27dfa8e58fe0969b9f19ae5b508f","span_id":"f22baaf28f165436","event_type":"liveness_check","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/health/live"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:182","message":"Readiness check request received","request_id":"39e45d79b8725b28e5c3d8c74a794a09","trace_id":"39e45d79b8725b28e5c3d8c74a794a09","span_id":"4b2563003ee8de8b","method":"GET","path":"/actuator/health/ready","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:186","message":"Business event","request_id":"39e45d79b8725b28e5c3d8c74a794a09","trace_id":"39e45d79b8725b28e5c3d8c74a794a09","span_id":"4b2563003ee8de8b","event_type":"readiness_check","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/health/ready"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:194","message":"Application info request received","request_id":"6ead7dc321c7934779551493cdf0935a","trace_id":"6ead7dc321c7934779551493cdf0935a","span_id":"6a094370bfcc41d9","method":"GET","path":"/actuator/info","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:202","message":"Environment info request received","request_id":"78b101792e681cdc855a292d240386c2","trace_id":"78b101792e681cdc855a292d240386c2","span_id":"568720dec02ae47b","method":"GET","path":"/actuator/env","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:220","message":"Metrics request received","request_id":"81715dd9c9074ce1a9867f82e1655232","trace_id":"81715dd9c9074ce1a9867f82e1655232","span_id":"e24cb43d347580c7","method":"GET","path":"/actuator/metrics","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:230","message":"Business event","request_id":"81715dd9c9074ce1a9867f82e1655232","trace_id":"81715dd9c9074ce1a9867f82e1655232","span_id":"e24cb43d347580c7","event_type":"metrics_request","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/metrics"}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:240","message":"Prometheus metrics request received","request_id":"916f594baa4e76ca245d880983615fc6","trace_id":"916f594baa4e76ca245d880983615fc6","span_id":"fc21d7f5c9eacf99","method":"GET","path":"/actuator/prometheus","client_ip":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:51.079+0530","caller":"actuator/actuator.go:245","message":"Business event","request_id":"916f594baa4e76ca245d880983615fc6","trace_id":"916f594baa4e76ca245d880983615fc6","span_id":"fc21d7f5c9eacf99","event_type":"prometheus_metrics_request","user_id":"","tenant_id":"","client_ip":"","endpoint":"/actuator/prometheus"}
--- PASS: TestActuator_RegisterRoutes_AllEndpoints (0.00s)
=== RUN   TestActuator_RecordRequest_WithMetrics
--- PASS: TestActuator_RecordRequest_WithMetrics (0.00s)
=== RUN   TestActuator_AppInfo_WithProperties
--- PASS: TestActuator_AppInfo_WithProperties (0.00s)
=== RUN   TestActuator_NewActuator_WithNilAppInfo
--- PASS: TestActuator_NewActuator_WithNilAppInfo (0.00s)
=== RUN   TestActuator_GetMemoryStats_Detailed
--- PASS: TestActuator_GetMemoryStats_Detailed (0.00s)
=== RUN   TestActuator_GetRuntimeStats_Detailed
--- PASS: TestActuator_GetRuntimeStats_Detailed (0.00s)
=== RUN   TestActuator_GetRequestStats_Detailed
--- PASS: TestActuator_GetRequestStats_Detailed (0.00s)
=== RUN   TestDatabaseHealthCheck_Success
--- PASS: TestDatabaseHealthCheck_Success (0.00s)
=== RUN   TestDatabaseHealthCheck_WithTimeout
--- PASS: TestDatabaseHealthCheck_WithTimeout (0.00s)
=== RUN   TestRedisHealthCheck_Success
--- PASS: TestRedisHealthCheck_Success (0.00s)
=== RUN   TestRedisHealthCheck_WithNilClient
--- PASS: TestRedisHealthCheck_WithNilClient (0.00s)
=== RUN   TestDiskSpaceHealthCheck_Success
--- PASS: TestDiskSpaceHealthCheck_Success (0.00s)
=== RUN   TestDiskSpaceHealthCheck_WithZeroSpace
--- PASS: TestDiskSpaceHealthCheck_WithZeroSpace (0.00s)
=== RUN   TestDiskSpaceHealthCheck_WithNegativeSpace
--- PASS: TestDiskSpaceHealthCheck_WithNegativeSpace (0.00s)
=== RUN   TestMemoryHealthCheck_Success
--- PASS: TestMemoryHealthCheck_Success (0.00s)
=== RUN   TestMemoryHealthCheck_WithLowThreshold
--- PASS: TestMemoryHealthCheck_WithLowThreshold (0.00s)
=== RUN   TestMemoryHealthCheck_WithZeroThreshold
--- PASS: TestMemoryHealthCheck_WithZeroThreshold (0.00s)
=== RUN   TestMemoryHealthCheck_WithNegativeThreshold
--- PASS: TestMemoryHealthCheck_WithNegativeThreshold (0.00s)
=== RUN   TestGoroutineHealthCheck_Success
--- PASS: TestGoroutineHealthCheck_Success (0.00s)
=== RUN   TestGoroutineHealthCheck_WithLowThreshold
--- PASS: TestGoroutineHealthCheck_WithLowThreshold (0.00s)
=== RUN   TestGoroutineHealthCheck_WithZeroThreshold
--- PASS: TestGoroutineHealthCheck_WithZeroThreshold (0.00s)
=== RUN   TestGoroutineHealthCheck_WithNegativeThreshold
--- PASS: TestGoroutineHealthCheck_WithNegativeThreshold (0.00s)
=== RUN   TestCustomHealthCheck_Success
--- PASS: TestCustomHealthCheck_Success (0.00s)
=== RUN   TestCustomHealthCheck_WithError
--- PASS: TestCustomHealthCheck_WithError (0.00s)
=== RUN   TestCustomHealthCheck_WithNilFunction
--- PASS: TestCustomHealthCheck_WithNilFunction (0.00s)
=== RUN   TestTimeoutHealthCheck_Success
--- PASS: TestTimeoutHealthCheck_Success (0.01s)
=== RUN   TestTimeoutHealthCheck_WithError
--- PASS: TestTimeoutHealthCheck_WithError (0.01s)
=== RUN   TestTimeoutHealthCheck_WithTimeout
--- PASS: TestTimeoutHealthCheck_WithTimeout (0.05s)
=== RUN   TestTimeoutHealthCheck_WithZeroTimeout
--- PASS: TestTimeoutHealthCheck_WithZeroTimeout (0.00s)
=== RUN   TestTimeoutHealthCheck_WithNegativeTimeout
--- PASS: TestTimeoutHealthCheck_WithNegativeTimeout (0.00s)
=== RUN   TestTimeoutHealthCheck_WithNilCheck
--- PASS: TestTimeoutHealthCheck_WithNilCheck (0.00s)
=== RUN   TestMemoryHealthCheck_Calculation
--- PASS: TestMemoryHealthCheck_Calculation (0.00s)
=== RUN   TestHealthCheck_Integration
=== RUN   TestHealthCheck_Integration/memory
=== RUN   TestHealthCheck_Integration/goroutines
=== RUN   TestHealthCheck_Integration/disk
=== RUN   TestHealthCheck_Integration/redis
=== RUN   TestHealthCheck_Integration/custom
--- PASS: TestHealthCheck_Integration (0.00s)
    --- PASS: TestHealthCheck_Integration/memory (0.00s)
    --- PASS: TestHealthCheck_Integration/goroutines (0.00s)
    --- PASS: TestHealthCheck_Integration/disk (0.00s)
    --- PASS: TestHealthCheck_Integration/redis (0.00s)
    --- PASS: TestHealthCheck_Integration/custom (0.00s)
PASS
coverage: 96.7% of statements
ok  	auth-service/internal/actuator	2.095s	coverage: 96.7% of statements
=== RUN   TestLoadConfig_Success
--- PASS: TestLoadConfig_Success (0.00s)
=== RUN   TestLoadConfig_FileNotFound
--- PASS: TestLoadConfig_FileNotFound (0.00s)
=== RUN   TestLoadConfig_InvalidYAML
--- PASS: TestLoadConfig_InvalidYAML (0.00s)
=== RUN   TestLoadConfig_WithEnvironmentVariables
--- PASS: TestLoadConfig_WithEnvironmentVariables (0.00s)
=== RUN   TestLoadConfig_DefaultValues
--- PASS: TestLoadConfig_DefaultValues (0.00s)
=== RUN   TestDatabaseConfig_GetDSN
--- PASS: TestDatabaseConfig_GetDSN (0.00s)
=== RUN   TestDatabaseConfig_GetDSN_WithSSL
--- PASS: TestDatabaseConfig_GetDSN_WithSSL (0.00s)
=== RUN   TestRedisConfig_GetRedisAddr
--- PASS: TestRedisConfig_GetRedisAddr (0.00s)
=== RUN   TestRedisConfig_GetRedisAddr_CustomHost
--- PASS: TestRedisConfig_GetRedisAddr_CustomHost (0.00s)
=== RUN   TestConfig_Validation
--- PASS: TestConfig_Validation (0.00s)
=== RUN   TestConfig_CompleteConfiguration
--- PASS: TestConfig_CompleteConfiguration (0.00s)
=== RUN   TestLoadConfig_WithAllEnvironmentVariables
--- PASS: TestLoadConfig_WithAllEnvironmentVariables (0.00s)
=== RUN   TestLoadConfig_WithInvalidEnvironmentVariables
--- PASS: TestLoadConfig_WithInvalidEnvironmentVariables (0.00s)
=== RUN   TestLoadConfig_WithZeroEnvironmentVariables
--- PASS: TestLoadConfig_WithZeroEnvironmentVariables (0.00s)
=== RUN   TestDatabaseConfig_GetDSN_WithAllFields
--- PASS: TestDatabaseConfig_GetDSN_WithAllFields (0.00s)
=== RUN   TestRedisConfig_GetRedisAddr_WithPassword
--- PASS: TestRedisConfig_GetRedisAddr_WithPassword (0.00s)
=== RUN   TestRedisConfig_GetRedisAddr_WithCustomPort
--- PASS: TestRedisConfig_GetRedisAddr_WithCustomPort (0.00s)
=== RUN   TestConfig_DefaultValues_Comprehensive
--- PASS: TestConfig_DefaultValues_Comprehensive (0.00s)
PASS
coverage: 85.5% of statements
ok  	auth-service/internal/config	0.301s	coverage: 85.5% of statements
=== RUN   TestAuthHandler_Login_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.296+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8354e20177856e5e0c8e626c9c077d9f","trace_id":"8354e20177856e5e0c8e626c9c077d9f","span_id":"41f5d19a8957e517","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"8354e20177856e5e0c8e626c9c077d9f","trace_id":"8354e20177856e5e0c8e626c9c077d9f","span_id":"41f5d19a8957e517","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.296+0530","caller":"rest/auth_handler.go:95","message":"Login attempt started","request_id":"8354e20177856e5e0c8e626c9c077d9f","trace_id":"8354e20177856e5e0c8e626c9c077d9f","span_id":"41f5d19a8957e517","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.297+0530","caller":"rest/auth_handler.go:115","message":"Tenant context missing","request_id":"8354e20177856e5e0c8e626c9c077d9f","trace_id":"8354e20177856e5e0c8e626c9c077d9f","span_id":"41f5d19a8957e517","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:115\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_Success.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_Success\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:91\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8354e20177856e5e0c8e626c9c077d9f","trace_id":"8354e20177856e5e0c8e626c9c077d9f","span_id":"41f5d19a8957e517","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"8354e20177856e5e0c8e626c9c077d9f","trace_id":"8354e20177856e5e0c8e626c9c077d9f","span_id":"41f5d19a8957e517","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":500,"duration":0.000629583}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.297+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"8354e20177856e5e0c8e626c9c077d9f","trace_id":"8354e20177856e5e0c8e626c9c077d9f","span_id":"41f5d19a8957e517","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":78,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_Success.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_Success\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:91\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
    auth_handler_test.go:94: 
        	Error Trace:	/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:94
        	Error:      	Not equal: 
        	            	expected: 200
        	            	actual  : 500
        	Test:       	TestAuthHandler_Login_Success
    auth_handler_test.go:100: 
        	Error Trace:	/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:100
        	Error:      	Should NOT be empty, but was 
        	Test:       	TestAuthHandler_Login_Success
    auth_handler_test.go:101: 
        	Error Trace:	/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:101
        	Error:      	Should NOT be empty, but was 
        	Test:       	TestAuthHandler_Login_Success
    auth_handler_test.go:102: 
        	Error Trace:	/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:102
        	Error:      	Not equal: 
        	            	expected: "Bearer"
        	            	actual  : ""
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -1 +1 @@
        	            	-Bearer
        	            	+
        	Test:       	TestAuthHandler_Login_Success
    auth_handler_test.go:103: 
        	Error Trace:	/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:103
        	Error:      	Not equal: 
        	            	expected: 3600
        	            	actual  : 0
        	Test:       	TestAuthHandler_Login_Success
    auth_handler_test.go:104: 
        	Error Trace:	/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:104
        	Error:      	Not equal: 
        	            	expected: "test@example.com"
        	            	actual  : ""
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -1 +1 @@
        	            	-test@example.com
        	            	+
        	Test:       	TestAuthHandler_Login_Success
    auth_handler_test.go:105: 
        	Error Trace:	/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:105
        	Error:      	Not equal: 
        	            	expected: "tenant-123"
        	            	actual  : ""
        	            	
        	            	Diff:
        	            	--- Expected
        	            	+++ Actual
        	            	@@ -1 +1 @@
        	            	-tenant-123
        	            	+
        	Test:       	TestAuthHandler_Login_Success
    auth_handler_test.go:106: 
        	Error Trace:	/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:106
        	Error:      	"[]" should have 1 item(s), but has 0
        	Test:       	TestAuthHandler_Login_Success
--- FAIL: TestAuthHandler_Login_Success (0.00s)
=== RUN   TestAuthHandler_Login_InvalidEmail
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"de717a74263317433d9ad547f226e6a1","trace_id":"de717a74263317433d9ad547f226e6a1","span_id":"593e3f47c237b728","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"de717a74263317433d9ad547f226e6a1","trace_id":"de717a74263317433d9ad547f226e6a1","span_id":"593e3f47c237b728","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"rest/auth_handler.go:95","message":"Login attempt started","request_id":"de717a74263317433d9ad547f226e6a1","trace_id":"de717a74263317433d9ad547f226e6a1","span_id":"593e3f47c237b728","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.297+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"de717a74263317433d9ad547f226e6a1","trace_id":"de717a74263317433d9ad547f226e6a1","span_id":"593e3f47c237b728","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"de717a74263317433d9ad547f226e6a1","trace_id":"de717a74263317433d9ad547f226e6a1","span_id":"593e3f47c237b728","user_id":"","tenant_id":"","auth_method":"password","reason":"validation_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:102\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:134\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.297+0530","caller":"rest/auth_handler.go:103","message":"Login validation failed","request_id":"de717a74263317433d9ad547f226e6a1","trace_id":"de717a74263317433d9ad547f226e6a1","span_id":"593e3f47c237b728","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","error":"Key: 'LoginRequest.Email' Error:Field validation for 'Email' failed on the 'email' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:103\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:134\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"de717a74263317433d9ad547f226e6a1","trace_id":"de717a74263317433d9ad547f226e6a1","span_id":"593e3f47c237b728","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"de717a74263317433d9ad547f226e6a1","trace_id":"de717a74263317433d9ad547f226e6a1","span_id":"593e3f47c237b728","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.00005525}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.297+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"de717a74263317433d9ad547f226e6a1","trace_id":"de717a74263317433d9ad547f226e6a1","span_id":"593e3f47c237b728","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":75,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:134\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Login_InvalidEmail (0.00s)
=== RUN   TestAuthHandler_Login_MissingFields
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8392c268df9c35e69f652550d386dbcd","trace_id":"8392c268df9c35e69f652550d386dbcd","span_id":"a6dcb7603c5f843a","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"8392c268df9c35e69f652550d386dbcd","trace_id":"8392c268df9c35e69f652550d386dbcd","span_id":"a6dcb7603c5f843a","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"rest/auth_handler.go:95","message":"Login attempt started","request_id":"8392c268df9c35e69f652550d386dbcd","trace_id":"8392c268df9c35e69f652550d386dbcd","span_id":"a6dcb7603c5f843a","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.297+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"8392c268df9c35e69f652550d386dbcd","trace_id":"8392c268df9c35e69f652550d386dbcd","span_id":"a6dcb7603c5f843a","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"8392c268df9c35e69f652550d386dbcd","trace_id":"8392c268df9c35e69f652550d386dbcd","span_id":"a6dcb7603c5f843a","user_id":"","tenant_id":"","auth_method":"password","reason":"validation_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:102\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.297+0530","caller":"rest/auth_handler.go:103","message":"Login validation failed","request_id":"8392c268df9c35e69f652550d386dbcd","trace_id":"8392c268df9c35e69f652550d386dbcd","span_id":"a6dcb7603c5f843a","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","error":"Key: 'LoginRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:103\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8392c268df9c35e69f652550d386dbcd","trace_id":"8392c268df9c35e69f652550d386dbcd","span_id":"a6dcb7603c5f843a","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"8392c268df9c35e69f652550d386dbcd","trace_id":"8392c268df9c35e69f652550d386dbcd","span_id":"a6dcb7603c5f843a","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.00005525}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.297+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"8392c268df9c35e69f652550d386dbcd","trace_id":"8392c268df9c35e69f652550d386dbcd","span_id":"a6dcb7603c5f843a","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":28,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Login_MissingFields (0.00s)
=== RUN   TestAuthHandler_Register_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"6b97fe6dbe150fac105ad16eb8ff4215","trace_id":"6b97fe6dbe150fac105ad16eb8ff4215","span_id":"29cb87432bbd9f18","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"6b97fe6dbe150fac105ad16eb8ff4215","trace_id":"6b97fe6dbe150fac105ad16eb8ff4215","span_id":"29cb87432bbd9f18","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"rest/auth_handler.go:235","message":"Registration attempt started","request_id":"6b97fe6dbe150fac105ad16eb8ff4215","trace_id":"6b97fe6dbe150fac105ad16eb8ff4215","span_id":"29cb87432bbd9f18","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.297+0530","caller":"rest/auth_handler.go:251","message":"Registration validation passed","request_id":"6b97fe6dbe150fac105ad16eb8ff4215","trace_id":"6b97fe6dbe150fac105ad16eb8ff4215","span_id":"29cb87432bbd9f18","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","email":"newuser@example.com","tenant_id":"tenant-123","first_name":"John","last_name":"Doe"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.334+0530","caller":"rest/auth_handler.go:280","message":"Business event","request_id":"6b97fe6dbe150fac105ad16eb8ff4215","trace_id":"6b97fe6dbe150fac105ad16eb8ff4215","span_id":"29cb87432bbd9f18","event_type":"user_registration","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","email":"newuser@example.com","first_name":"John","last_name":"Doe","duration_ms":37}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.334+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"6b97fe6dbe150fac105ad16eb8ff4215","trace_id":"6b97fe6dbe150fac105ad16eb8ff4215","span_id":"29cb87432bbd9f18","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"6b97fe6dbe150fac105ad16eb8ff4215","trace_id":"6b97fe6dbe150fac105ad16eb8ff4215","span_id":"29cb87432bbd9f18","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.037184042}
--- PASS: TestAuthHandler_Register_Success (0.04s)
=== RUN   TestAuthHandler_Register_InvalidEmail
{"level":"INFO","timestamp":"2025-06-26T01:18:50.335+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"6035c2671653d3d8a6cfbba4254df83a","trace_id":"6035c2671653d3d8a6cfbba4254df83a","span_id":"7cd04e867099efb9","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"6035c2671653d3d8a6cfbba4254df83a","trace_id":"6035c2671653d3d8a6cfbba4254df83a","span_id":"7cd04e867099efb9","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.335+0530","caller":"rest/auth_handler.go:235","message":"Registration attempt started","request_id":"6035c2671653d3d8a6cfbba4254df83a","trace_id":"6035c2671653d3d8a6cfbba4254df83a","span_id":"7cd04e867099efb9","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.335+0530","caller":"rest/auth_handler.go:242","message":"Registration validation failed","request_id":"6035c2671653d3d8a6cfbba4254df83a","trace_id":"6035c2671653d3d8a6cfbba4254df83a","span_id":"7cd04e867099efb9","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","error":"Key: 'RegisterRequest.Email' Error:Field validation for 'Email' failed on the 'email' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Register\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:242\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:252\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.335+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"6035c2671653d3d8a6cfbba4254df83a","trace_id":"6035c2671653d3d8a6cfbba4254df83a","span_id":"7cd04e867099efb9","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"6035c2671653d3d8a6cfbba4254df83a","trace_id":"6035c2671653d3d8a6cfbba4254df83a","span_id":"7cd04e867099efb9","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000067417}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.335+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"6035c2671653d3d8a6cfbba4254df83a","trace_id":"6035c2671653d3d8a6cfbba4254df83a","span_id":"7cd04e867099efb9","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":113,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_InvalidEmail\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:252\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Register_InvalidEmail (0.00s)
=== RUN   TestAuthHandler_Register_MissingFields
{"level":"INFO","timestamp":"2025-06-26T01:18:50.335+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"80178c4d9bb661e46f8f758452251e0d","trace_id":"80178c4d9bb661e46f8f758452251e0d","span_id":"7850c80e5a8b97f0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"80178c4d9bb661e46f8f758452251e0d","trace_id":"80178c4d9bb661e46f8f758452251e0d","span_id":"7850c80e5a8b97f0","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.335+0530","caller":"rest/auth_handler.go:235","message":"Registration attempt started","request_id":"80178c4d9bb661e46f8f758452251e0d","trace_id":"80178c4d9bb661e46f8f758452251e0d","span_id":"7850c80e5a8b97f0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.335+0530","caller":"rest/auth_handler.go:242","message":"Registration validation failed","request_id":"80178c4d9bb661e46f8f758452251e0d","trace_id":"80178c4d9bb661e46f8f758452251e0d","span_id":"7850c80e5a8b97f0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","error":"Key: 'RegisterRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag\nKey: 'RegisterRequest.TenantID' Error:Field validation for 'TenantID' failed on the 'required' tag\nKey: 'RegisterRequest.FirstName' Error:Field validation for 'FirstName' failed on the 'required' tag\nKey: 'RegisterRequest.LastName' Error:Field validation for 'LastName' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Register\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:242\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:289\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.335+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"80178c4d9bb661e46f8f758452251e0d","trace_id":"80178c4d9bb661e46f8f758452251e0d","span_id":"7850c80e5a8b97f0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"80178c4d9bb661e46f8f758452251e0d","trace_id":"80178c4d9bb661e46f8f758452251e0d","span_id":"7850c80e5a8b97f0","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000038834}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.335+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"80178c4d9bb661e46f8f758452251e0d","trace_id":"80178c4d9bb661e46f8f758452251e0d","span_id":"7850c80e5a8b97f0","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":28,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_MissingFields\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:289\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Register_MissingFields (0.00s)
=== RUN   TestAuthHandler_RefreshToken_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.335+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"a66009f8476137d2fddb92401e67419f","trace_id":"a66009f8476137d2fddb92401e67419f","span_id":"43363d377653fbcb","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"a66009f8476137d2fddb92401e67419f","trace_id":"a66009f8476137d2fddb92401e67419f","span_id":"43363d377653fbcb","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.335+0530","caller":"rest/auth_handler.go:323","message":"Token refresh attempt started","request_id":"a66009f8476137d2fddb92401e67419f","trace_id":"a66009f8476137d2fddb92401e67419f","span_id":"43363d377653fbcb","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/auth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.335+0530","caller":"rest/auth_handler.go:339","message":"Token refresh validation passed","request_id":"a66009f8476137d2fddb92401e67419f","trace_id":"a66009f8476137d2fddb92401e67419f","span_id":"43363d377653fbcb","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","refresh_token_prefix":"valid-refr..."}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.340+0530","caller":"rest/auth_handler.go:366","message":"Business event","request_id":"a66009f8476137d2fddb92401e67419f","trace_id":"a66009f8476137d2fddb92401e67419f","span_id":"43363d377653fbcb","event_type":"token_refresh","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","duration_ms":5}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.340+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"a66009f8476137d2fddb92401e67419f","trace_id":"a66009f8476137d2fddb92401e67419f","span_id":"43363d377653fbcb","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"a66009f8476137d2fddb92401e67419f","trace_id":"a66009f8476137d2fddb92401e67419f","span_id":"43363d377653fbcb","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.005723458}
--- PASS: TestAuthHandler_RefreshToken_Success (0.01s)
=== RUN   TestAuthHandler_RefreshToken_MissingToken
{"level":"INFO","timestamp":"2025-06-26T01:18:50.341+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"2e0a7729c9892368e2b51bd160cfe26e","trace_id":"2e0a7729c9892368e2b51bd160cfe26e","span_id":"8a51deb18053668f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"2e0a7729c9892368e2b51bd160cfe26e","trace_id":"2e0a7729c9892368e2b51bd160cfe26e","span_id":"8a51deb18053668f","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.341+0530","caller":"rest/auth_handler.go:323","message":"Token refresh attempt started","request_id":"2e0a7729c9892368e2b51bd160cfe26e","trace_id":"2e0a7729c9892368e2b51bd160cfe26e","span_id":"8a51deb18053668f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/auth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.341+0530","caller":"rest/auth_handler.go:330","message":"Token refresh validation failed","request_id":"2e0a7729c9892368e2b51bd160cfe26e","trace_id":"2e0a7729c9892368e2b51bd160cfe26e","span_id":"8a51deb18053668f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","error":"Key: 'RefreshTokenRequest.RefreshToken' Error:Field validation for 'RefreshToken' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).RefreshToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:330\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:362\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.341+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"2e0a7729c9892368e2b51bd160cfe26e","trace_id":"2e0a7729c9892368e2b51bd160cfe26e","span_id":"8a51deb18053668f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"2e0a7729c9892368e2b51bd160cfe26e","trace_id":"2e0a7729c9892368e2b51bd160cfe26e","span_id":"8a51deb18053668f","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000044375}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.341+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"2e0a7729c9892368e2b51bd160cfe26e","trace_id":"2e0a7729c9892368e2b51bd160cfe26e","span_id":"8a51deb18053668f","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":2,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_RefreshToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:362\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_RefreshToken_MissingToken (0.00s)
=== RUN   TestAuthHandler_Logout_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.341+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"af35fdb3726b44c673b8c3acaf0e2404","trace_id":"af35fdb3726b44c673b8c3acaf0e2404","span_id":"233d68b147c08b8b","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","request_id":"af35fdb3726b44c673b8c3acaf0e2404","trace_id":"af35fdb3726b44c673b8c3acaf0e2404","span_id":"233d68b147c08b8b","parent_span_id":"","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.341+0530","caller":"rest/auth_handler.go:400","message":"Logout attempt started","request_id":"af35fdb3726b44c673b8c3acaf0e2404","trace_id":"af35fdb3726b44c673b8c3acaf0e2404","span_id":"233d68b147c08b8b","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","endpoint":"/auth/logout","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/auth_handler.go:413","message":"Business event","request_id":"af35fdb3726b44c673b8c3acaf0e2404","trace_id":"af35fdb3726b44c673b8c3acaf0e2404","span_id":"233d68b147c08b8b","event_type":"user_logout","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","duration_ms":11}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"af35fdb3726b44c673b8c3acaf0e2404","trace_id":"af35fdb3726b44c673b8c3acaf0e2404","span_id":"233d68b147c08b8b","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","request_id":"af35fdb3726b44c673b8c3acaf0e2404","trace_id":"af35fdb3726b44c673b8c3acaf0e2404","span_id":"233d68b147c08b8b","parent_span_id":"","method":"POST","path":"/logout","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.011108958}
--- PASS: TestAuthHandler_Logout_Success (0.01s)
=== RUN   TestAuthHandler_Login_InvalidJSON
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"cf735623dd259104dab91c4887cf91c2","trace_id":"cf735623dd259104dab91c4887cf91c2","span_id":"f95df28f274a1720","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"cf735623dd259104dab91c4887cf91c2","trace_id":"cf735623dd259104dab91c4887cf91c2","span_id":"f95df28f274a1720","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/auth_handler.go:95","message":"Login attempt started","request_id":"cf735623dd259104dab91c4887cf91c2","trace_id":"cf735623dd259104dab91c4887cf91c2","span_id":"f95df28f274a1720","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","endpoint":"/auth/login","method":"POST"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"cf735623dd259104dab91c4887cf91c2","trace_id":"cf735623dd259104dab91c4887cf91c2","span_id":"f95df28f274a1720","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"cf735623dd259104dab91c4887cf91c2","trace_id":"cf735623dd259104dab91c4887cf91c2","span_id":"f95df28f274a1720","user_id":"","tenant_id":"","auth_method":"password","reason":"validation_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:102\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:421\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/auth_handler.go:103","message":"Login validation failed","request_id":"cf735623dd259104dab91c4887cf91c2","trace_id":"cf735623dd259104dab91c4887cf91c2","span_id":"f95df28f274a1720","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","error":"unexpected EOF","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Login\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:103\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:421\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"cf735623dd259104dab91c4887cf91c2","trace_id":"cf735623dd259104dab91c4887cf91c2","span_id":"f95df28f274a1720","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","request_id":"cf735623dd259104dab91c4887cf91c2","trace_id":"cf735623dd259104dab91c4887cf91c2","span_id":"f95df28f274a1720","parent_span_id":"","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.00006875}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.352+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"cf735623dd259104dab91c4887cf91c2","trace_id":"cf735623dd259104dab91c4887cf91c2","span_id":"f95df28f274a1720","method":"POST","path":"/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":82,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Login_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:421\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Login_InvalidJSON (0.00s)
=== RUN   TestAuthHandler_Register_EmptyPassword
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"7700423b153f6239bf4dfaf1f9ce5004","trace_id":"7700423b153f6239bf4dfaf1f9ce5004","span_id":"7d44e3064a45231a","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"7700423b153f6239bf4dfaf1f9ce5004","trace_id":"7700423b153f6239bf4dfaf1f9ce5004","span_id":"7d44e3064a45231a","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/auth_handler.go:235","message":"Registration attempt started","request_id":"7700423b153f6239bf4dfaf1f9ce5004","trace_id":"7700423b153f6239bf4dfaf1f9ce5004","span_id":"7d44e3064a45231a","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","endpoint":"/auth/register","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/auth_handler.go:242","message":"Registration validation failed","request_id":"7700423b153f6239bf4dfaf1f9ce5004","trace_id":"7700423b153f6239bf4dfaf1f9ce5004","span_id":"7d44e3064a45231a","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","error":"Key: 'RegisterRequest.Password' Error:Field validation for 'Password' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*AuthHandler).Register\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler.go:242\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:460\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"7700423b153f6239bf4dfaf1f9ce5004","trace_id":"7700423b153f6239bf4dfaf1f9ce5004","span_id":"7d44e3064a45231a","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","request_id":"7700423b153f6239bf4dfaf1f9ce5004","trace_id":"7700423b153f6239bf4dfaf1f9ce5004","span_id":"7d44e3064a45231a","parent_span_id":"","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000048042}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.352+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"7700423b153f6239bf4dfaf1f9ce5004","trace_id":"7700423b153f6239bf4dfaf1f9ce5004","span_id":"7d44e3064a45231a","method":"POST","path":"/register","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":105,"stacktrace":"auth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestAuthHandler_Register_EmptyPassword\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/auth_handler_test.go:460\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestAuthHandler_Register_EmptyPassword (0.00s)
=== RUN   TestAuthHandler_NewAuthHandler
--- PASS: TestAuthHandler_NewAuthHandler (0.00s)
=== RUN   TestOAuthHandler_GoogleLogin_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"38063d0e898afaa13554f537f2b98a19","trace_id":"38063d0e898afaa13554f537f2b98a19","span_id":"1aec1af7870482a4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"38063d0e898afaa13554f537f2b98a19","trace_id":"38063d0e898afaa13554f537f2b98a19","span_id":"1aec1af7870482a4","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"38063d0e898afaa13554f537f2b98a19","trace_id":"38063d0e898afaa13554f537f2b98a19","span_id":"1aec1af7870482a4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"38063d0e898afaa13554f537f2b98a19","trace_id":"38063d0e898afaa13554f537f2b98a19","span_id":"1aec1af7870482a4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"38063d0e898afaa13554f537f2b98a19","trace_id":"38063d0e898afaa13554f537f2b98a19","span_id":"1aec1af7870482a4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"38063d0e898afaa13554f537f2b98a19","trace_id":"38063d0e898afaa13554f537f2b98a19","span_id":"1aec1af7870482a4","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"38063d0e898afaa13554f537f2b98a19","trace_id":"38063d0e898afaa13554f537f2b98a19","span_id":"1aec1af7870482a4","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","duration_ms":0,"provider":"google","redirect_uri":"http://localhost:8080/api/v1/oauth/google/callback"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"38063d0e898afaa13554f537f2b98a19","trace_id":"38063d0e898afaa13554f537f2b98a19","span_id":"1aec1af7870482a4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"38063d0e898afaa13554f537f2b98a19","trace_id":"38063d0e898afaa13554f537f2b98a19","span_id":"1aec1af7870482a4","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000039292}
--- PASS: TestOAuthHandler_GoogleLogin_Success (0.00s)
=== RUN   TestOAuthHandler_GoogleLogin_WithCustomRedirectURI
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"f3db1ac1f5306008a289e901dcccade0","trace_id":"f3db1ac1f5306008a289e901dcccade0","span_id":"13080493eb7624c4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"f3db1ac1f5306008a289e901dcccade0","trace_id":"f3db1ac1f5306008a289e901dcccade0","span_id":"13080493eb7624c4","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"f3db1ac1f5306008a289e901dcccade0","trace_id":"f3db1ac1f5306008a289e901dcccade0","span_id":"13080493eb7624c4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"f3db1ac1f5306008a289e901dcccade0","trace_id":"f3db1ac1f5306008a289e901dcccade0","span_id":"13080493eb7624c4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":"https://custom.example.com/callback"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"f3db1ac1f5306008a289e901dcccade0","trace_id":"f3db1ac1f5306008a289e901dcccade0","span_id":"13080493eb7624c4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"f3db1ac1f5306008a289e901dcccade0","trace_id":"f3db1ac1f5306008a289e901dcccade0","span_id":"13080493eb7624c4","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"f3db1ac1f5306008a289e901dcccade0","trace_id":"f3db1ac1f5306008a289e901dcccade0","span_id":"13080493eb7624c4","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"https://custom.example.com/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"f3db1ac1f5306008a289e901dcccade0","trace_id":"f3db1ac1f5306008a289e901dcccade0","span_id":"13080493eb7624c4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"f3db1ac1f5306008a289e901dcccade0","trace_id":"f3db1ac1f5306008a289e901dcccade0","span_id":"13080493eb7624c4","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000040792}
--- PASS: TestOAuthHandler_GoogleLogin_WithCustomRedirectURI (0.00s)
=== RUN   TestOAuthHandler_GoogleLogin_MissingTenantID
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"4aae4e87619a68e4bfb4e01352dfeb0b","trace_id":"4aae4e87619a68e4bfb4e01352dfeb0b","span_id":"5e28a34b3d16c0b4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"4aae4e87619a68e4bfb4e01352dfeb0b","trace_id":"4aae4e87619a68e4bfb4e01352dfeb0b","span_id":"5e28a34b3d16c0b4","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"4aae4e87619a68e4bfb4e01352dfeb0b","trace_id":"4aae4e87619a68e4bfb4e01352dfeb0b","span_id":"5e28a34b3d16c0b4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"4aae4e87619a68e4bfb4e01352dfeb0b","trace_id":"4aae4e87619a68e4bfb4e01352dfeb0b","span_id":"5e28a34b3d16c0b4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"4aae4e87619a68e4bfb4e01352dfeb0b","trace_id":"4aae4e87619a68e4bfb4e01352dfeb0b","span_id":"5e28a34b3d16c0b4","user_id":"","tenant_id":"","auth_method":"google_oauth","reason":"missing_tenant_id","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleLogin\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:74\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:115\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:75","message":"Google OAuth login failed - missing tenant ID","request_id":"4aae4e87619a68e4bfb4e01352dfeb0b","trace_id":"4aae4e87619a68e4bfb4e01352dfeb0b","span_id":"5e28a34b3d16c0b4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).GoogleLogin\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:75\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:115\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"4aae4e87619a68e4bfb4e01352dfeb0b","trace_id":"4aae4e87619a68e4bfb4e01352dfeb0b","span_id":"5e28a34b3d16c0b4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"4aae4e87619a68e4bfb4e01352dfeb0b","trace_id":"4aae4e87619a68e4bfb4e01352dfeb0b","span_id":"5e28a34b3d16c0b4","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000039708}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.352+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"4aae4e87619a68e4bfb4e01352dfeb0b","trace_id":"4aae4e87619a68e4bfb4e01352dfeb0b","span_id":"5e28a34b3d16c0b4","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleLogin_MissingTenantID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:115\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleLogin_MissingTenantID (0.00s)
=== RUN   TestOAuthHandler_GoogleCallback_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.352+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","code_prefix":"test-auth-..."}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.403+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","user_id":"google-user-123","tenant_id":"tenant-123","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.403+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","provider":"google","step":"callback_success","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.403+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":51}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.403+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"c327559848147a4fdf2de8102687be61","trace_id":"c327559848147a4fdf2de8102687be61","span_id":"c09788a8f14a4747","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.051097792}
--- PASS: TestOAuthHandler_GoogleCallback_Success (0.05s)
=== RUN   TestOAuthHandler_GoogleCallback_MissingCode
{"level":"INFO","timestamp":"2025-06-26T01:18:50.404+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"5d784f40a5835f0d7f8845e5843255b4","trace_id":"5d784f40a5835f0d7f8845e5843255b4","span_id":"0100ac2df268005b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"5d784f40a5835f0d7f8845e5843255b4","trace_id":"5d784f40a5835f0d7f8845e5843255b4","span_id":"0100ac2df268005b","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.404+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"5d784f40a5835f0d7f8845e5843255b4","trace_id":"5d784f40a5835f0d7f8845e5843255b4","span_id":"0100ac2df268005b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.404+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"5d784f40a5835f0d7f8845e5843255b4","trace_id":"5d784f40a5835f0d7f8845e5843255b4","span_id":"0100ac2df268005b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"5d784f40a5835f0d7f8845e5843255b4","trace_id":"5d784f40a5835f0d7f8845e5843255b4","span_id":"0100ac2df268005b","user_id":"","tenant_id":"tenant-123","auth_method":"google_oauth","reason":"missing_code","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:164\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.404+0530","caller":"rest/oauth_handler.go:165","message":"Google OAuth callback failed - missing authorization code","request_id":"5d784f40a5835f0d7f8845e5843255b4","trace_id":"5d784f40a5835f0d7f8845e5843255b4","span_id":"0100ac2df268005b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:165\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.404+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"5d784f40a5835f0d7f8845e5843255b4","trace_id":"5d784f40a5835f0d7f8845e5843255b4","span_id":"0100ac2df268005b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"5d784f40a5835f0d7f8845e5843255b4","trace_id":"5d784f40a5835f0d7f8845e5843255b4","span_id":"0100ac2df268005b","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000106209}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.404+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"5d784f40a5835f0d7f8845e5843255b4","trace_id":"5d784f40a5835f0d7f8845e5843255b4","span_id":"0100ac2df268005b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_MissingCode\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:171\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleCallback_MissingCode (0.00s)
=== RUN   TestOAuthHandler_GoogleCallback_OAuthError
{"level":"INFO","timestamp":"2025-06-26T01:18:50.404+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.404+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.404+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","user_id":"","tenant_id":"tenant-123","auth_method":"google_oauth","reason":"oauth_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:153\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:197\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.404+0530","caller":"logger/logger.go:225","message":"OAuth flow failed","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","provider":"google","step":"callback_error","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","error":"oauth error: access_denied","stacktrace":"auth-service/internal/logger.(*RequestLogger).OAuthFlow\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:225\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:154\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:197\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.404+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000058625}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.404+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"b1b64d51583eee44eb1189bb7586b44d","trace_id":"b1b64d51583eee44eb1189bb7586b44d","span_id":"eaf709617556970b","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_OAuthError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:197\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleCallback_OAuthError (0.00s)
=== RUN   TestOAuthHandler_ClientCredentials_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.404+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"0f7835519dda245d00ed51045b14fbe4","trace_id":"0f7835519dda245d00ed51045b14fbe4","span_id":"0f4baf978354724c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"0f7835519dda245d00ed51045b14fbe4","trace_id":"0f7835519dda245d00ed51045b14fbe4","span_id":"0f4baf978354724c","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.404+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"0f7835519dda245d00ed51045b14fbe4","trace_id":"0f7835519dda245d00ed51045b14fbe4","span_id":"0f4baf978354724c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.404+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"0f7835519dda245d00ed51045b14fbe4","trace_id":"0f7835519dda245d00ed51045b14fbe4","span_id":"0f4baf978354724c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"service-client-123","grant_type":"client_credentials","scope":"read:users write:users"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"0f7835519dda245d00ed51045b14fbe4","trace_id":"0f7835519dda245d00ed51045b14fbe4","span_id":"0f4baf978354724c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"0f7835519dda245d00ed51045b14fbe4","trace_id":"0f7835519dda245d00ed51045b14fbe4","span_id":"0f4baf978354724c","user_id":"service-client-123","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"0f7835519dda245d00ed51045b14fbe4","trace_id":"0f7835519dda245d00ed51045b14fbe4","span_id":"0f4baf978354724c","event_type":"client_credentials_success","user_id":"service-client-123","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"read:users write:users","duration_ms":21}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"0f7835519dda245d00ed51045b14fbe4","trace_id":"0f7835519dda245d00ed51045b14fbe4","span_id":"0f4baf978354724c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"0f7835519dda245d00ed51045b14fbe4","trace_id":"0f7835519dda245d00ed51045b14fbe4","span_id":"0f4baf978354724c","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.021139875}
--- PASS: TestOAuthHandler_ClientCredentials_Success (0.02s)
=== RUN   TestOAuthHandler_ClientCredentials_UnsupportedGrantType
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"service-client-123","grant_type":"authorization_code","scope":"read:users write:users"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.425+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","user_id":"service-client-123","tenant_id":"","auth_method":"client_credentials","reason":"unsupported_grant_type","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).ClientCredentials\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:284\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:273\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.425+0530","caller":"rest/oauth_handler.go:285","message":"Unsupported grant type","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","grant_type":"authorization_code","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).ClientCredentials\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:285\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:273\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000083209}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.425+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"f8ed2b460e6165140a8bb4adeac66ce4","trace_id":"f8ed2b460e6165140a8bb4adeac66ce4","span_id":"bc76992c4995c02c","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":138,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_UnsupportedGrantType\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:273\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_ClientCredentials_UnsupportedGrantType (0.00s)
=== RUN   TestOAuthHandler_ClientCredentials_InvalidJSON
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"de66422e1f044668c5c9d20d06f63fcf","trace_id":"de66422e1f044668c5c9d20d06f63fcf","span_id":"969ba5258a277a91","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"de66422e1f044668c5c9d20d06f63fcf","trace_id":"de66422e1f044668c5c9d20d06f63fcf","span_id":"969ba5258a277a91","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"de66422e1f044668c5c9d20d06f63fcf","trace_id":"de66422e1f044668c5c9d20d06f63fcf","span_id":"969ba5258a277a91","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.425+0530","caller":"rest/oauth_handler.go:268","message":"Client credentials validation failed","request_id":"de66422e1f044668c5c9d20d06f63fcf","trace_id":"de66422e1f044668c5c9d20d06f63fcf","span_id":"969ba5258a277a91","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","error":"unexpected EOF","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).ClientCredentials\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:268\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:303\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"de66422e1f044668c5c9d20d06f63fcf","trace_id":"de66422e1f044668c5c9d20d06f63fcf","span_id":"969ba5258a277a91","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"de66422e1f044668c5c9d20d06f63fcf","trace_id":"de66422e1f044668c5c9d20d06f63fcf","span_id":"969ba5258a277a91","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000028875}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.425+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"de66422e1f044668c5c9d20d06f63fcf","trace_id":"de66422e1f044668c5c9d20d06f63fcf","span_id":"969ba5258a277a91","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":70,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_ClientCredentials_InvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:303\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_ClientCredentials_InvalidJSON (0.00s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"86a60e94ca85d34e6a4e27d9bf10c622","trace_id":"86a60e94ca85d34e6a4e27d9bf10c622","span_id":"ca1c4c5a5224cb7a","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"86a60e94ca85d34e6a4e27d9bf10c622","trace_id":"86a60e94ca85d34e6a4e27d9bf10c622","span_id":"ca1c4c5a5224cb7a","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"86a60e94ca85d34e6a4e27d9bf10c622","trace_id":"86a60e94ca85d34e6a4e27d9bf10c622","span_id":"ca1c4c5a5224cb7a","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.425+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"86a60e94ca85d34e6a4e27d9bf10c622","trace_id":"86a60e94ca85d34e6a4e27d9bf10c622","span_id":"ca1c4c5a5224cb7a","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":3600,"max_uses":1}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.441+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"86a60e94ca85d34e6a4e27d9bf10c622","trace_id":"86a60e94ca85d34e6a4e27d9bf10c622","span_id":"ca1c4c5a5224cb7a","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","max_uses":1,"duration_ms":16,"session_id":"survey-session-456","expires_in":3600}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.442+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"86a60e94ca85d34e6a4e27d9bf10c622","trace_id":"86a60e94ca85d34e6a4e27d9bf10c622","span_id":"ca1c4c5a5224cb7a","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"86a60e94ca85d34e6a4e27d9bf10c622","trace_id":"86a60e94ca85d34e6a4e27d9bf10c622","span_id":"ca1c4c5a5224cb7a","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.016225958}
--- PASS: TestOAuthHandler_CreateOneTimeToken_Success (0.02s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_MissingURL
{"level":"INFO","timestamp":"2025-06-26T01:18:50.444+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8e6492eb93af43ee8e104f16bdcfdd5e","trace_id":"8e6492eb93af43ee8e104f16bdcfdd5e","span_id":"2e36f1110221ee6e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"8e6492eb93af43ee8e104f16bdcfdd5e","trace_id":"8e6492eb93af43ee8e104f16bdcfdd5e","span_id":"2e36f1110221ee6e","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.444+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"8e6492eb93af43ee8e104f16bdcfdd5e","trace_id":"8e6492eb93af43ee8e104f16bdcfdd5e","span_id":"2e36f1110221ee6e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.444+0530","caller":"rest/oauth_handler.go:371","message":"One-time token validation failed","request_id":"8e6492eb93af43ee8e104f16bdcfdd5e","trace_id":"8e6492eb93af43ee8e104f16bdcfdd5e","span_id":"2e36f1110221ee6e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","error":"Key: 'OneTimeTokenRequest.URL' Error:Field validation for 'URL' failed on the 'required' tag","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).CreateOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:371\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:385\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.444+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8e6492eb93af43ee8e104f16bdcfdd5e","trace_id":"8e6492eb93af43ee8e104f16bdcfdd5e","span_id":"2e36f1110221ee6e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"8e6492eb93af43ee8e104f16bdcfdd5e","trace_id":"8e6492eb93af43ee8e104f16bdcfdd5e","span_id":"2e36f1110221ee6e","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000067959}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.444+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"8e6492eb93af43ee8e104f16bdcfdd5e","trace_id":"8e6492eb93af43ee8e104f16bdcfdd5e","span_id":"2e36f1110221ee6e","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":87,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_MissingURL\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:385\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_CreateOneTimeToken_MissingURL (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.444+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"2801861ca4c4d3f15e4ace6c49b45d9b","trace_id":"2801861ca4c4d3f15e4ace6c49b45d9b","span_id":"c52467346fa484d4","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"2801861ca4c4d3f15e4ace6c49b45d9b","trace_id":"2801861ca4c4d3f15e4ace6c49b45d9b","span_id":"c52467346fa484d4","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.444+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"2801861ca4c4d3f15e4ace6c49b45d9b","trace_id":"2801861ca4c4d3f15e4ace6c49b45d9b","span_id":"c52467346fa484d4","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.444+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"2801861ca4c4d3f15e4ace6c49b45d9b","trace_id":"2801861ca4c4d3f15e4ace6c49b45d9b","span_id":"c52467346fa484d4","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.455+0530","caller":"rest/oauth_handler.go:542","message":"Business event","request_id":"2801861ca4c4d3f15e4ace6c49b45d9b","trace_id":"2801861ca4c4d3f15e4ace6c49b45d9b","span_id":"c52467346fa484d4","event_type":"one_time_token_verified","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","is_valid":true,"duration_ms":11}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.455+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"2801861ca4c4d3f15e4ace6c49b45d9b","trace_id":"2801861ca4c4d3f15e4ace6c49b45d9b","span_id":"c52467346fa484d4","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"2801861ca4c4d3f15e4ace6c49b45d9b","trace_id":"2801861ca4c4d3f15e4ace6c49b45d9b","span_id":"c52467346fa484d4","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.011194875}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_Success (0.01s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_MissingToken
{"level":"INFO","timestamp":"2025-06-26T01:18:50.455+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"bde4493c63d904d5792d2ba7aab3c057","trace_id":"bde4493c63d904d5792d2ba7aab3c057","span_id":"9db544964ed111c8","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"bde4493c63d904d5792d2ba7aab3c057","trace_id":"bde4493c63d904d5792d2ba7aab3c057","span_id":"9db544964ed111c8","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.455+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"bde4493c63d904d5792d2ba7aab3c057","trace_id":"bde4493c63d904d5792d2ba7aab3c057","span_id":"9db544964ed111c8","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.455+0530","caller":"rest/oauth_handler.go:469","message":"One-time token verification failed - missing token","request_id":"bde4493c63d904d5792d2ba7aab3c057","trace_id":"bde4493c63d904d5792d2ba7aab3c057","span_id":"9db544964ed111c8","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:469\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:440\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.455+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"bde4493c63d904d5792d2ba7aab3c057","trace_id":"bde4493c63d904d5792d2ba7aab3c057","span_id":"9db544964ed111c8","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"bde4493c63d904d5792d2ba7aab3c057","trace_id":"bde4493c63d904d5792d2ba7aab3c057","span_id":"9db544964ed111c8","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000088958}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.455+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"bde4493c63d904d5792d2ba7aab3c057","trace_id":"bde4493c63d904d5792d2ba7aab3c057","span_id":"9db544964ed111c8","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_MissingToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:440\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_MissingToken (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_InvalidToken
{"level":"INFO","timestamp":"2025-06-26T01:18:50.455+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.455+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.455+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"invalid-to...","session_id":"session-123"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.466+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","user_id":"","tenant_id":"","auth_method":"one_time_token","reason":"invalid_token","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:513\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:466\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.466+0530","caller":"rest/oauth_handler.go:514","message":"One-time token verification failed - invalid token or session","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:514\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:466\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.467+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":401,"duration":0.011282833}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.467+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"d241e1a12bf596108f8093da8ae19c06","trace_id":"d241e1a12bf596108f8093da8ae19c06","span_id":"f83f69d6de9411ce","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_InvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:466\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_InvalidToken (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_Success
{"level":"INFO","timestamp":"2025-06-26T01:18:50.467+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"83c60fa524c8dd880e0b78d006a386fc","trace_id":"83c60fa524c8dd880e0b78d006a386fc","span_id":"a3a52cf5fd6cf737","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"83c60fa524c8dd880e0b78d006a386fc","trace_id":"83c60fa524c8dd880e0b78d006a386fc","span_id":"a3a52cf5fd6cf737","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.467+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"83c60fa524c8dd880e0b78d006a386fc","trace_id":"83c60fa524c8dd880e0b78d006a386fc","span_id":"a3a52cf5fd6cf737","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.467+0530","caller":"rest/oauth_handler.go:598","message":"Session refresh validation passed","request_id":"83c60fa524c8dd880e0b78d006a386fc","trace_id":"83c60fa524c8dd880e0b78d006a386fc","span_id":"a3a52cf5fd6cf737","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.476+0530","caller":"rest/oauth_handler.go:637","message":"Business event","request_id":"83c60fa524c8dd880e0b78d006a386fc","trace_id":"83c60fa524c8dd880e0b78d006a386fc","span_id":"a3a52cf5fd6cf737","event_type":"session_refreshed","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","duration_ms":8}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.476+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"83c60fa524c8dd880e0b78d006a386fc","trace_id":"83c60fa524c8dd880e0b78d006a386fc","span_id":"a3a52cf5fd6cf737","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"83c60fa524c8dd880e0b78d006a386fc","trace_id":"83c60fa524c8dd880e0b78d006a386fc","span_id":"a3a52cf5fd6cf737","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.009046458}
--- PASS: TestOAuthHandler_RefreshSession_Success (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_MissingSessionID
{"level":"INFO","timestamp":"2025-06-26T01:18:50.476+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"e054b8c58deaba1967774fc008e68e6e","trace_id":"e054b8c58deaba1967774fc008e68e6e","span_id":"b7829bf0a171dfa2","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"e054b8c58deaba1967774fc008e68e6e","trace_id":"e054b8c58deaba1967774fc008e68e6e","span_id":"b7829bf0a171dfa2","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.476+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"e054b8c58deaba1967774fc008e68e6e","trace_id":"e054b8c58deaba1967774fc008e68e6e","span_id":"b7829bf0a171dfa2","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.476+0530","caller":"rest/oauth_handler.go:589","message":"Session refresh failed - missing parameters","request_id":"e054b8c58deaba1967774fc008e68e6e","trace_id":"e054b8c58deaba1967774fc008e68e6e","span_id":"b7829bf0a171dfa2","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).RefreshSession\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:589\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:522\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.476+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"e054b8c58deaba1967774fc008e68e6e","trace_id":"e054b8c58deaba1967774fc008e68e6e","span_id":"b7829bf0a171dfa2","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"e054b8c58deaba1967774fc008e68e6e","trace_id":"e054b8c58deaba1967774fc008e68e6e","span_id":"b7829bf0a171dfa2","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000083083}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.476+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"e054b8c58deaba1967774fc008e68e6e","trace_id":"e054b8c58deaba1967774fc008e68e6e","span_id":"b7829bf0a171dfa2","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_MissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:522\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_RefreshSession_MissingSessionID (0.00s)
=== RUN   TestOAuthHandler_NewOAuthHandler
--- PASS: TestOAuthHandler_NewOAuthHandler (0.00s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithAllFields
{"level":"INFO","timestamp":"2025-06-26T01:18:50.476+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"ac66323f8c882722b11d53762e015dda","trace_id":"ac66323f8c882722b11d53762e015dda","span_id":"25828c25786e3378","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"ac66323f8c882722b11d53762e015dda","trace_id":"ac66323f8c882722b11d53762e015dda","span_id":"25828c25786e3378","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.476+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"ac66323f8c882722b11d53762e015dda","trace_id":"ac66323f8c882722b11d53762e015dda","span_id":"25828c25786e3378","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.476+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"ac66323f8c882722b11d53762e015dda","trace_id":"ac66323f8c882722b11d53762e015dda","span_id":"25828c25786e3378","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":7200,"max_uses":5}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.492+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"ac66323f8c882722b11d53762e015dda","trace_id":"ac66323f8c882722b11d53762e015dda","span_id":"25828c25786e3378","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","duration_ms":16,"session_id":"survey-session-456","expires_in":7200,"max_uses":5}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.492+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"ac66323f8c882722b11d53762e015dda","trace_id":"ac66323f8c882722b11d53762e015dda","span_id":"25828c25786e3378","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"ac66323f8c882722b11d53762e015dda","trace_id":"ac66323f8c882722b11d53762e015dda","span_id":"25828c25786e3378","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.016207834}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithAllFields (0.02s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithDefaultValues
{"level":"INFO","timestamp":"2025-06-26T01:18:50.493+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"1b3a209e839e421f6bf1f5211ac3393e","trace_id":"1b3a209e839e421f6bf1f5211ac3393e","span_id":"0c7f821c88ca54ba","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"1b3a209e839e421f6bf1f5211ac3393e","trace_id":"1b3a209e839e421f6bf1f5211ac3393e","span_id":"0c7f821c88ca54ba","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.493+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"1b3a209e839e421f6bf1f5211ac3393e","trace_id":"1b3a209e839e421f6bf1f5211ac3393e","span_id":"0c7f821c88ca54ba","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.493+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"1b3a209e839e421f6bf1f5211ac3393e","trace_id":"1b3a209e839e421f6bf1f5211ac3393e","span_id":"0c7f821c88ca54ba","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":0,"max_uses":0}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"1b3a209e839e421f6bf1f5211ac3393e","trace_id":"1b3a209e839e421f6bf1f5211ac3393e","span_id":"0c7f821c88ca54ba","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","expires_in":0,"max_uses":0,"duration_ms":16,"session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"1b3a209e839e421f6bf1f5211ac3393e","trace_id":"1b3a209e839e421f6bf1f5211ac3393e","span_id":"0c7f821c88ca54ba","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"1b3a209e839e421f6bf1f5211ac3393e","trace_id":"1b3a209e839e421f6bf1f5211ac3393e","span_id":"0c7f821c88ca54ba","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.0162215}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithDefaultValues (0.02s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"917d0e10c4fd4531adc85ce19b8cd87e","trace_id":"917d0e10c4fd4531adc85ce19b8cd87e","span_id":"48649ad8fba6e04f","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"917d0e10c4fd4531adc85ce19b8cd87e","trace_id":"917d0e10c4fd4531adc85ce19b8cd87e","span_id":"48649ad8fba6e04f","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"917d0e10c4fd4531adc85ce19b8cd87e","trace_id":"917d0e10c4fd4531adc85ce19b8cd87e","span_id":"48649ad8fba6e04f","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.509+0530","caller":"rest/oauth_handler.go:371","message":"One-time token validation failed","request_id":"917d0e10c4fd4531adc85ce19b8cd87e","trace_id":"917d0e10c4fd4531adc85ce19b8cd87e","span_id":"48649ad8fba6e04f","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","error":"unexpected EOF","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).CreateOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:371\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:638\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"917d0e10c4fd4531adc85ce19b8cd87e","trace_id":"917d0e10c4fd4531adc85ce19b8cd87e","span_id":"48649ad8fba6e04f","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"917d0e10c4fd4531adc85ce19b8cd87e","trace_id":"917d0e10c4fd4531adc85ce19b8cd87e","span_id":"48649ad8fba6e04f","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000082333}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.509+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"917d0e10c4fd4531adc85ce19b8cd87e","trace_id":"917d0e10c4fd4531adc85ce19b8cd87e","span_id":"48649ad8fba6e04f","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":44,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:638\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithInvalidJSON (0.00s)
=== RUN   TestOAuthHandler_CreateOneTimeToken_WithEmptyBody
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","trace_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","span_id":"21b237449b4aab27","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","trace_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","span_id":"21b237449b4aab27","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","trace_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","span_id":"21b237449b4aab27","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.509+0530","caller":"rest/oauth_handler.go:371","message":"One-time token validation failed","request_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","trace_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","span_id":"21b237449b4aab27","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","error":"EOF","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).CreateOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:371\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:665\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","trace_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","span_id":"21b237449b4aab27","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","trace_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","span_id":"21b237449b4aab27","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000083625}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.509+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","trace_id":"ff6f9ca36c3d8330beb2f4ed5039d3e3","span_id":"21b237449b4aab27","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_CreateOneTimeToken_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:665\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_CreateOneTimeToken_WithEmptyBody (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_WithAllFields
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"332cb6d986782efbf5b203b2c4677293","trace_id":"332cb6d986782efbf5b203b2c4677293","span_id":"2d69ad7097dd3ab3","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"332cb6d986782efbf5b203b2c4677293","trace_id":"332cb6d986782efbf5b203b2c4677293","span_id":"2d69ad7097dd3ab3","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"332cb6d986782efbf5b203b2c4677293","trace_id":"332cb6d986782efbf5b203b2c4677293","span_id":"2d69ad7097dd3ab3","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.509+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"332cb6d986782efbf5b203b2c4677293","trace_id":"332cb6d986782efbf5b203b2c4677293","span_id":"2d69ad7097dd3ab3","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.520+0530","caller":"rest/oauth_handler.go:542","message":"Business event","request_id":"332cb6d986782efbf5b203b2c4677293","trace_id":"332cb6d986782efbf5b203b2c4677293","span_id":"2d69ad7097dd3ab3","event_type":"one_time_token_verified","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","is_valid":true,"duration_ms":11}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.520+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"332cb6d986782efbf5b203b2c4677293","trace_id":"332cb6d986782efbf5b203b2c4677293","span_id":"2d69ad7097dd3ab3","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"332cb6d986782efbf5b203b2c4677293","trace_id":"332cb6d986782efbf5b203b2c4677293","span_id":"2d69ad7097dd3ab3","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.01113925}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_WithAllFields (0.01s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID
{"level":"INFO","timestamp":"2025-06-26T01:18:50.521+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"587c6ac2c033bfa4679259814b0789c6","trace_id":"587c6ac2c033bfa4679259814b0789c6","span_id":"c0df232b4ababc30","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"587c6ac2c033bfa4679259814b0789c6","trace_id":"587c6ac2c033bfa4679259814b0789c6","span_id":"c0df232b4ababc30","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.521+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"587c6ac2c033bfa4679259814b0789c6","trace_id":"587c6ac2c033bfa4679259814b0789c6","span_id":"c0df232b4ababc30","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.521+0530","caller":"rest/oauth_handler.go:479","message":"One-time token verification failed - missing session ID","request_id":"587c6ac2c033bfa4679259814b0789c6","trace_id":"587c6ac2c033bfa4679259814b0789c6","span_id":"c0df232b4ababc30","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:479\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:723\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.521+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"587c6ac2c033bfa4679259814b0789c6","trace_id":"587c6ac2c033bfa4679259814b0789c6","span_id":"c0df232b4ababc30","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"587c6ac2c033bfa4679259814b0789c6","trace_id":"587c6ac2c033bfa4679259814b0789c6","span_id":"c0df232b4ababc30","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000054417}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.521+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"587c6ac2c033bfa4679259814b0789c6","trace_id":"587c6ac2c033bfa4679259814b0789c6","span_id":"c0df232b4ababc30","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:723\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_WithMissingSessionID (0.00s)
=== RUN   TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken
{"level":"INFO","timestamp":"2025-06-26T01:18:50.521+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.521+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.521+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"invalid-to...","session_id":"invalid-session"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.532+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","user_id":"","tenant_id":"","auth_method":"one_time_token","reason":"invalid_token","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:513\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:750\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.532+0530","caller":"rest/oauth_handler.go:514","message":"One-time token verification failed - invalid token or session","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).VerifyOneTimeToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:514\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:750\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.532+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":401,"duration":0.011178375}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.532+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"06a95aaec7c2496814a5093d9a37cb38","trace_id":"06a95aaec7c2496814a5093d9a37cb38","span_id":"0da5943314d3316c","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:750\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_VerifyOneTimeToken_WithInvalidToken (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_WithAllFields
{"level":"INFO","timestamp":"2025-06-26T01:18:50.532+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"fb7c1b8462a7fbe601b134f9bd6183bc","trace_id":"fb7c1b8462a7fbe601b134f9bd6183bc","span_id":"13f63ce5521c0c3a","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"fb7c1b8462a7fbe601b134f9bd6183bc","trace_id":"fb7c1b8462a7fbe601b134f9bd6183bc","span_id":"13f63ce5521c0c3a","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.532+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"fb7c1b8462a7fbe601b134f9bd6183bc","trace_id":"fb7c1b8462a7fbe601b134f9bd6183bc","span_id":"13f63ce5521c0c3a","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.532+0530","caller":"rest/oauth_handler.go:598","message":"Session refresh validation passed","request_id":"fb7c1b8462a7fbe601b134f9bd6183bc","trace_id":"fb7c1b8462a7fbe601b134f9bd6183bc","span_id":"13f63ce5521c0c3a","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"rest/oauth_handler.go:637","message":"Business event","request_id":"fb7c1b8462a7fbe601b134f9bd6183bc","trace_id":"fb7c1b8462a7fbe601b134f9bd6183bc","span_id":"13f63ce5521c0c3a","event_type":"session_refreshed","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","duration_ms":9}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"fb7c1b8462a7fbe601b134f9bd6183bc","trace_id":"fb7c1b8462a7fbe601b134f9bd6183bc","span_id":"13f63ce5521c0c3a","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"fb7c1b8462a7fbe601b134f9bd6183bc","trace_id":"fb7c1b8462a7fbe601b134f9bd6183bc","span_id":"13f63ce5521c0c3a","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.009109958}
--- PASS: TestOAuthHandler_RefreshSession_WithAllFields (0.01s)
=== RUN   TestOAuthHandler_RefreshSession_WithInvalidJSON
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"9812948f911099b208331428aef82ee4","trace_id":"9812948f911099b208331428aef82ee4","span_id":"6da853dabd57d74e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"9812948f911099b208331428aef82ee4","trace_id":"9812948f911099b208331428aef82ee4","span_id":"6da853dabd57d74e","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"9812948f911099b208331428aef82ee4","trace_id":"9812948f911099b208331428aef82ee4","span_id":"6da853dabd57d74e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.541+0530","caller":"rest/oauth_handler.go:589","message":"Session refresh failed - missing parameters","request_id":"9812948f911099b208331428aef82ee4","trace_id":"9812948f911099b208331428aef82ee4","span_id":"6da853dabd57d74e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).RefreshSession\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:589\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:810\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"9812948f911099b208331428aef82ee4","trace_id":"9812948f911099b208331428aef82ee4","span_id":"6da853dabd57d74e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"9812948f911099b208331428aef82ee4","trace_id":"9812948f911099b208331428aef82ee4","span_id":"6da853dabd57d74e","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000042625}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.541+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"9812948f911099b208331428aef82ee4","trace_id":"9812948f911099b208331428aef82ee4","span_id":"6da853dabd57d74e","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":33,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithInvalidJSON\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:810\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_RefreshSession_WithInvalidJSON (0.00s)
=== RUN   TestOAuthHandler_RefreshSession_WithEmptyBody
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"2d7f73865b151d1094946b8b8398b74d","trace_id":"2d7f73865b151d1094946b8b8398b74d","span_id":"6c78b2e7fa1f4512","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"2d7f73865b151d1094946b8b8398b74d","trace_id":"2d7f73865b151d1094946b8b8398b74d","span_id":"6c78b2e7fa1f4512","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"2d7f73865b151d1094946b8b8398b74d","trace_id":"2d7f73865b151d1094946b8b8398b74d","span_id":"6c78b2e7fa1f4512","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.541+0530","caller":"rest/oauth_handler.go:589","message":"Session refresh failed - missing parameters","request_id":"2d7f73865b151d1094946b8b8398b74d","trace_id":"2d7f73865b151d1094946b8b8398b74d","span_id":"6c78b2e7fa1f4512","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/handler/rest.(*OAuthHandler).RefreshSession\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:589\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:837\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"2d7f73865b151d1094946b8b8398b74d","trace_id":"2d7f73865b151d1094946b8b8398b74d","span_id":"6c78b2e7fa1f4512","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"2d7f73865b151d1094946b8b8398b74d","trace_id":"2d7f73865b151d1094946b8b8398b74d","span_id":"6c78b2e7fa1f4512","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.00002975}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.541+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"2d7f73865b151d1094946b8b8398b74d","trace_id":"2d7f73865b151d1094946b8b8398b74d","span_id":"6c78b2e7fa1f4512","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_RefreshSession_WithEmptyBody\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:837\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_RefreshSession_WithEmptyBody (0.00s)
=== RUN   TestOAuthHandler_ClientCredentials_WithScope
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"03d97b15e6339671139a4b92b52a4df7","trace_id":"03d97b15e6339671139a4b92b52a4df7","span_id":"9c849452cd9c9555","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"03d97b15e6339671139a4b92b52a4df7","trace_id":"03d97b15e6339671139a4b92b52a4df7","span_id":"9c849452cd9c9555","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"03d97b15e6339671139a4b92b52a4df7","trace_id":"03d97b15e6339671139a4b92b52a4df7","span_id":"9c849452cd9c9555","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.541+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"03d97b15e6339671139a4b92b52a4df7","trace_id":"03d97b15e6339671139a4b92b52a4df7","span_id":"9c849452cd9c9555","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":"read:users write:users"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.562+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"03d97b15e6339671139a4b92b52a4df7","trace_id":"03d97b15e6339671139a4b92b52a4df7","span_id":"9c849452cd9c9555","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"03d97b15e6339671139a4b92b52a4df7","trace_id":"03d97b15e6339671139a4b92b52a4df7","span_id":"9c849452cd9c9555","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.562+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"03d97b15e6339671139a4b92b52a4df7","trace_id":"03d97b15e6339671139a4b92b52a4df7","span_id":"9c849452cd9c9555","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","duration_ms":20,"scope":"read:users write:users"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.562+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"03d97b15e6339671139a4b92b52a4df7","trace_id":"03d97b15e6339671139a4b92b52a4df7","span_id":"9c849452cd9c9555","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"03d97b15e6339671139a4b92b52a4df7","trace_id":"03d97b15e6339671139a4b92b52a4df7","span_id":"9c849452cd9c9555","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.020952334}
--- PASS: TestOAuthHandler_ClientCredentials_WithScope (0.02s)
=== RUN   TestOAuthHandler_ClientCredentials_WithoutScope
{"level":"INFO","timestamp":"2025-06-26T01:18:50.562+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"149930c8bcfe4530d4f7ba05efa3cca0","trace_id":"149930c8bcfe4530d4f7ba05efa3cca0","span_id":"95f0cfc78fd4c8c2","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"149930c8bcfe4530d4f7ba05efa3cca0","trace_id":"149930c8bcfe4530d4f7ba05efa3cca0","span_id":"95f0cfc78fd4c8c2","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.562+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"149930c8bcfe4530d4f7ba05efa3cca0","trace_id":"149930c8bcfe4530d4f7ba05efa3cca0","span_id":"95f0cfc78fd4c8c2","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.562+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"149930c8bcfe4530d4f7ba05efa3cca0","trace_id":"149930c8bcfe4530d4f7ba05efa3cca0","span_id":"95f0cfc78fd4c8c2","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.583+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"149930c8bcfe4530d4f7ba05efa3cca0","trace_id":"149930c8bcfe4530d4f7ba05efa3cca0","span_id":"95f0cfc78fd4c8c2","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"149930c8bcfe4530d4f7ba05efa3cca0","trace_id":"149930c8bcfe4530d4f7ba05efa3cca0","span_id":"95f0cfc78fd4c8c2","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.583+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"149930c8bcfe4530d4f7ba05efa3cca0","trace_id":"149930c8bcfe4530d4f7ba05efa3cca0","span_id":"95f0cfc78fd4c8c2","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"","duration_ms":20}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.583+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"149930c8bcfe4530d4f7ba05efa3cca0","trace_id":"149930c8bcfe4530d4f7ba05efa3cca0","span_id":"95f0cfc78fd4c8c2","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"149930c8bcfe4530d4f7ba05efa3cca0","trace_id":"149930c8bcfe4530d4f7ba05efa3cca0","span_id":"95f0cfc78fd4c8c2","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.020931916}
--- PASS: TestOAuthHandler_ClientCredentials_WithoutScope (0.02s)
=== RUN   TestOAuthHandler_ClientCredentials_WithEmptyScope
{"level":"INFO","timestamp":"2025-06-26T01:18:50.585+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"957569079e3f0b5f88b48e5ae048e6b6","trace_id":"957569079e3f0b5f88b48e5ae048e6b6","span_id":"3dad2464bcaa247e","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"957569079e3f0b5f88b48e5ae048e6b6","trace_id":"957569079e3f0b5f88b48e5ae048e6b6","span_id":"3dad2464bcaa247e","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.585+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"957569079e3f0b5f88b48e5ae048e6b6","trace_id":"957569079e3f0b5f88b48e5ae048e6b6","span_id":"3dad2464bcaa247e","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.585+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"957569079e3f0b5f88b48e5ae048e6b6","trace_id":"957569079e3f0b5f88b48e5ae048e6b6","span_id":"3dad2464bcaa247e","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"957569079e3f0b5f88b48e5ae048e6b6","trace_id":"957569079e3f0b5f88b48e5ae048e6b6","span_id":"3dad2464bcaa247e","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"957569079e3f0b5f88b48e5ae048e6b6","trace_id":"957569079e3f0b5f88b48e5ae048e6b6","span_id":"3dad2464bcaa247e","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"957569079e3f0b5f88b48e5ae048e6b6","trace_id":"957569079e3f0b5f88b48e5ae048e6b6","span_id":"3dad2464bcaa247e","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"","duration_ms":21}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"957569079e3f0b5f88b48e5ae048e6b6","trace_id":"957569079e3f0b5f88b48e5ae048e6b6","span_id":"3dad2464bcaa247e","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"957569079e3f0b5f88b48e5ae048e6b6","trace_id":"957569079e3f0b5f88b48e5ae048e6b6","span_id":"3dad2464bcaa247e","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.021210667}
--- PASS: TestOAuthHandler_ClientCredentials_WithEmptyScope (0.02s)
=== RUN   TestOAuthHandler_GoogleLogin_WithEmptyRedirectURI
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"3b56174df7e327192a802643a86a1028","trace_id":"3b56174df7e327192a802643a86a1028","span_id":"ba0972eeed665c9c","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"3b56174df7e327192a802643a86a1028","trace_id":"3b56174df7e327192a802643a86a1028","span_id":"ba0972eeed665c9c","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"3b56174df7e327192a802643a86a1028","trace_id":"3b56174df7e327192a802643a86a1028","span_id":"ba0972eeed665c9c","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"3b56174df7e327192a802643a86a1028","trace_id":"3b56174df7e327192a802643a86a1028","span_id":"ba0972eeed665c9c","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"3b56174df7e327192a802643a86a1028","trace_id":"3b56174df7e327192a802643a86a1028","span_id":"ba0972eeed665c9c","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"3b56174df7e327192a802643a86a1028","trace_id":"3b56174df7e327192a802643a86a1028","span_id":"ba0972eeed665c9c","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"3b56174df7e327192a802643a86a1028","trace_id":"3b56174df7e327192a802643a86a1028","span_id":"ba0972eeed665c9c","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"http://localhost:8080/api/v1/oauth/google/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"3b56174df7e327192a802643a86a1028","trace_id":"3b56174df7e327192a802643a86a1028","span_id":"ba0972eeed665c9c","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"3b56174df7e327192a802643a86a1028","trace_id":"3b56174df7e327192a802643a86a1028","span_id":"ba0972eeed665c9c","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.000048167}
--- PASS: TestOAuthHandler_GoogleLogin_WithEmptyRedirectURI (0.00s)
=== RUN   TestOAuthHandler_GoogleCallback_WithEmptyState
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.606+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"","code_prefix":"test-auth-..."}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.657+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","user_id":"google-user-123","tenant_id":"","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.658+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","provider":"google","step":"callback_success","tenant_id":"","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.658+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":51}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.658+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"0f85422087b58764ce44f0b73e05e333","trace_id":"0f85422087b58764ce44f0b73e05e333","span_id":"cb5f019d7090ac36","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.05166025}
--- PASS: TestOAuthHandler_GoogleCallback_WithEmptyState (0.05s)
=== RUN   TestOAuthHandler_GoogleCallback_WithOnlyCode
{"level":"INFO","timestamp":"2025-06-26T01:18:50.658+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.659+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.659+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"","code_prefix":"test-auth-..."}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","user_id":"google-user-123","tenant_id":"","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","provider":"google","step":"callback_success","tenant_id":"","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":51}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"0198e2d9bd0127875461949d680d5210","trace_id":"0198e2d9bd0127875461949d680d5210","span_id":"50c0bb052613f007","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.052804542}
--- PASS: TestOAuthHandler_GoogleCallback_WithOnlyCode (0.05s)
=== RUN   TestOAuthHandler_GoogleCallback_WithOnlyError
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.711+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","user_id":"","tenant_id":"","auth_method":"google_oauth","reason":"oauth_error","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:153\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:1063\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.711+0530","caller":"logger/logger.go:225","message":"OAuth flow failed","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","provider":"google","step":"callback_error","tenant_id":"","client_ip":"192.0.2.1:1234","error":"oauth error: access_denied","stacktrace":"auth-service/internal/logger.(*RequestLogger).OAuthFlow\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:225\nauth-service/internal/handler/rest.(*OAuthHandler).GoogleCallback\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler.go:154\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:27\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:1063\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":400,"duration":0.000063584}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.711+0530","caller":"middleware/logging_middleware.go:54","message":"Request resulted in error status","request_id":"64f583c3b4c5c31ec003259589f9b45f","trace_id":"64f583c3b4c5c31ec003259589f9b45f","span_id":"a2b80e913126ae84","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_agent":"","referer":"","content_length":0,"stacktrace":"auth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError.LoggingMiddleware.func1\n\t/Users/Licious/Desktop/repository/auth-service/internal/middleware/logging_middleware.go:54\ngithub.com/gin-gonic/gin.(*Context).Next\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/context.go:174\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:620\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP\n\t/Users/Licious/go/pkg/mod/github.com/gin-gonic/gin@v1.9.1/gin.go:576\nauth-service/internal/handler/rest.TestOAuthHandler_GoogleCallback_WithOnlyError\n\t/Users/Licious/Desktop/repository/auth-service/internal/handler/rest/oauth_handler_test.go:1063\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestOAuthHandler_GoogleCallback_WithOnlyError (0.00s)
=== RUN   TestOAuthHandler_Integration
=== RUN   TestOAuthHandler_Integration/GoogleLogin
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"9dd676e3505055032a5a99816f2c77bb","trace_id":"9dd676e3505055032a5a99816f2c77bb","span_id":"f5cf3356fcc04b4b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"9dd676e3505055032a5a99816f2c77bb","trace_id":"9dd676e3505055032a5a99816f2c77bb","span_id":"f5cf3356fcc04b4b","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"rest/oauth_handler.go:65","message":"Google OAuth login initiated","request_id":"9dd676e3505055032a5a99816f2c77bb","trace_id":"9dd676e3505055032a5a99816f2c77bb","span_id":"f5cf3356fcc04b4b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/login","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"rest/oauth_handler.go:84","message":"Google OAuth login validation passed","request_id":"9dd676e3505055032a5a99816f2c77bb","trace_id":"9dd676e3505055032a5a99816f2c77bb","span_id":"f5cf3356fcc04b4b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","redirect_uri":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.711+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"9dd676e3505055032a5a99816f2c77bb","trace_id":"9dd676e3505055032a5a99816f2c77bb","span_id":"f5cf3356fcc04b4b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"9dd676e3505055032a5a99816f2c77bb","trace_id":"9dd676e3505055032a5a99816f2c77bb","span_id":"f5cf3356fcc04b4b","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.714+0530","caller":"rest/oauth_handler.go:101","message":"Business event","request_id":"9dd676e3505055032a5a99816f2c77bb","trace_id":"9dd676e3505055032a5a99816f2c77bb","span_id":"f5cf3356fcc04b4b","event_type":"oauth_login_initiated","user_id":"","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","redirect_uri":"http://localhost:8080/api/v1/oauth/google/callback","duration_ms":0}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.714+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"9dd676e3505055032a5a99816f2c77bb","trace_id":"9dd676e3505055032a5a99816f2c77bb","span_id":"f5cf3356fcc04b4b","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","request_id":"9dd676e3505055032a5a99816f2c77bb","trace_id":"9dd676e3505055032a5a99816f2c77bb","span_id":"f5cf3356fcc04b4b","parent_span_id":"","method":"GET","path":"/google/login","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.002758292}
=== RUN   TestOAuthHandler_Integration/GoogleCallback
{"level":"INFO","timestamp":"2025-06-26T01:18:50.715+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.715+0530","caller":"rest/oauth_handler.go:143","message":"Google OAuth callback received","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","endpoint":"/oauth/google/callback","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.715+0530","caller":"rest/oauth_handler.go:174","message":"Google OAuth callback validation passed","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","tenant_id":"tenant-123","code_prefix":"test-code..."}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.765+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","user_id":"google-user-123","tenant_id":"tenant-123","auth_method":"google_oauth","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.765+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","provider":"google","step":"callback_success","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.765+0530","caller":"rest/oauth_handler.go:209","message":"Business event","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","event_type":"oauth_login_completed","user_id":"google-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","provider":"google","duration_ms":50}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.766+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","request_id":"2f25b2ef2ea805fb70408d7e16f9b759","trace_id":"2f25b2ef2ea805fb70408d7e16f9b759","span_id":"bd9df47ebd9dd415","parent_span_id":"","method":"GET","path":"/google/callback","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.050254458}
=== RUN   TestOAuthHandler_Integration/ClientCredentials
{"level":"INFO","timestamp":"2025-06-26T01:18:50.766+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"f636d719e2aaf3b597c22e1cb86c90ed","trace_id":"f636d719e2aaf3b597c22e1cb86c90ed","span_id":"e36777b69f3901b5","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"f636d719e2aaf3b597c22e1cb86c90ed","trace_id":"f636d719e2aaf3b597c22e1cb86c90ed","span_id":"e36777b69f3901b5","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.766+0530","caller":"rest/oauth_handler.go:261","message":"Client credentials flow initiated","request_id":"f636d719e2aaf3b597c22e1cb86c90ed","trace_id":"f636d719e2aaf3b597c22e1cb86c90ed","span_id":"e36777b69f3901b5","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","endpoint":"/oauth/token","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.766+0530","caller":"rest/oauth_handler.go:277","message":"Client credentials validation passed","request_id":"f636d719e2aaf3b597c22e1cb86c90ed","trace_id":"f636d719e2aaf3b597c22e1cb86c90ed","span_id":"e36777b69f3901b5","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","client_id":"test-client-id","grant_type":"client_credentials","scope":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.787+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"f636d719e2aaf3b597c22e1cb86c90ed","trace_id":"f636d719e2aaf3b597c22e1cb86c90ed","span_id":"e36777b69f3901b5","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"f636d719e2aaf3b597c22e1cb86c90ed","trace_id":"f636d719e2aaf3b597c22e1cb86c90ed","span_id":"e36777b69f3901b5","user_id":"test-client-id","tenant_id":"","auth_method":"client_credentials","client_ip":"192.0.2.1:1234"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.787+0530","caller":"rest/oauth_handler.go:310","message":"Business event","request_id":"f636d719e2aaf3b597c22e1cb86c90ed","trace_id":"f636d719e2aaf3b597c22e1cb86c90ed","span_id":"e36777b69f3901b5","event_type":"client_credentials_success","user_id":"test-client-id","tenant_id":"","client_ip":"192.0.2.1:1234","scope":"","duration_ms":21}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.787+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"f636d719e2aaf3b597c22e1cb86c90ed","trace_id":"f636d719e2aaf3b597c22e1cb86c90ed","span_id":"e36777b69f3901b5","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","request_id":"f636d719e2aaf3b597c22e1cb86c90ed","trace_id":"f636d719e2aaf3b597c22e1cb86c90ed","span_id":"e36777b69f3901b5","parent_span_id":"","method":"POST","path":"/token","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.021150709}
=== RUN   TestOAuthHandler_Integration/CreateOneTimeToken
{"level":"INFO","timestamp":"2025-06-26T01:18:50.787+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"51956a3d78c6c1e4c277c5626942576a","trace_id":"51956a3d78c6c1e4c277c5626942576a","span_id":"7f1a8f562355fb91","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"51956a3d78c6c1e4c277c5626942576a","trace_id":"51956a3d78c6c1e4c277c5626942576a","span_id":"7f1a8f562355fb91","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.787+0530","caller":"rest/oauth_handler.go:364","message":"One-time token creation initiated","request_id":"51956a3d78c6c1e4c277c5626942576a","trace_id":"51956a3d78c6c1e4c277c5626942576a","span_id":"7f1a8f562355fb91","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","endpoint":"/oauth/one-time","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.787+0530","caller":"rest/oauth_handler.go:380","message":"One-time token validation passed","request_id":"51956a3d78c6c1e4c277c5626942576a","trace_id":"51956a3d78c6c1e4c277c5626942576a","span_id":"7f1a8f562355fb91","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","url":"https://app.example.com/survey/123","session_id":"survey-session-456","expires_in":0,"max_uses":0}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.803+0530","caller":"rest/oauth_handler.go:421","message":"Business event","request_id":"51956a3d78c6c1e4c277c5626942576a","trace_id":"51956a3d78c6c1e4c277c5626942576a","span_id":"7f1a8f562355fb91","event_type":"one_time_token_created","user_id":"","tenant_id":"","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","expires_in":0,"max_uses":0,"duration_ms":16}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.803+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"51956a3d78c6c1e4c277c5626942576a","trace_id":"51956a3d78c6c1e4c277c5626942576a","span_id":"7f1a8f562355fb91","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","request_id":"51956a3d78c6c1e4c277c5626942576a","trace_id":"51956a3d78c6c1e4c277c5626942576a","span_id":"7f1a8f562355fb91","parent_span_id":"","method":"POST","path":"/one-time","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":201,"duration":0.016165792}
=== RUN   TestOAuthHandler_Integration/VerifyOneTimeToken
{"level":"INFO","timestamp":"2025-06-26T01:18:50.803+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"1e2aab4072196f59a0a9a8f016bf39cd","trace_id":"1e2aab4072196f59a0a9a8f016bf39cd","span_id":"0fe8f1743d914329","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"1e2aab4072196f59a0a9a8f016bf39cd","trace_id":"1e2aab4072196f59a0a9a8f016bf39cd","span_id":"0fe8f1743d914329","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.803+0530","caller":"rest/oauth_handler.go:460","message":"One-time token verification initiated","request_id":"1e2aab4072196f59a0a9a8f016bf39cd","trace_id":"1e2aab4072196f59a0a9a8f016bf39cd","span_id":"0fe8f1743d914329","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","endpoint":"/oauth/verify","method":"GET"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.803+0530","caller":"rest/oauth_handler.go:488","message":"One-time token verification validation passed","request_id":"1e2aab4072196f59a0a9a8f016bf39cd","trace_id":"1e2aab4072196f59a0a9a8f016bf39cd","span_id":"0fe8f1743d914329","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.814+0530","caller":"rest/oauth_handler.go:542","message":"Business event","request_id":"1e2aab4072196f59a0a9a8f016bf39cd","trace_id":"1e2aab4072196f59a0a9a8f016bf39cd","span_id":"0fe8f1743d914329","event_type":"one_time_token_verified","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","is_valid":true,"duration_ms":11}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.814+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"1e2aab4072196f59a0a9a8f016bf39cd","trace_id":"1e2aab4072196f59a0a9a8f016bf39cd","span_id":"0fe8f1743d914329","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","request_id":"1e2aab4072196f59a0a9a8f016bf39cd","trace_id":"1e2aab4072196f59a0a9a8f016bf39cd","span_id":"0fe8f1743d914329","parent_span_id":"","method":"GET","path":"/verify","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.0111035}
=== RUN   TestOAuthHandler_Integration/RefreshSession
{"level":"INFO","timestamp":"2025-06-26T01:18:50.814+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"8e62fe652ea179aa82e309fb4c0331ad","trace_id":"8e62fe652ea179aa82e309fb4c0331ad","span_id":"3af25ecd7d2b930c","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"8e62fe652ea179aa82e309fb4c0331ad","trace_id":"8e62fe652ea179aa82e309fb4c0331ad","span_id":"3af25ecd7d2b930c","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.814+0530","caller":"rest/oauth_handler.go:580","message":"Session refresh initiated","request_id":"8e62fe652ea179aa82e309fb4c0331ad","trace_id":"8e62fe652ea179aa82e309fb4c0331ad","span_id":"3af25ecd7d2b930c","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","endpoint":"/oauth/refresh","method":"POST"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.814+0530","caller":"rest/oauth_handler.go:598","message":"Session refresh validation passed","request_id":"8e62fe652ea179aa82e309fb4c0331ad","trace_id":"8e62fe652ea179aa82e309fb4c0331ad","span_id":"3af25ecd7d2b930c","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","token_prefix":"one-time-t...","session_id":"survey-session-456"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.823+0530","caller":"rest/oauth_handler.go:637","message":"Business event","request_id":"8e62fe652ea179aa82e309fb4c0331ad","trace_id":"8e62fe652ea179aa82e309fb4c0331ad","span_id":"3af25ecd7d2b930c","event_type":"session_refreshed","user_id":"anonymous-user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","session_id":"survey-session-456","duration_ms":9}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.823+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"8e62fe652ea179aa82e309fb4c0331ad","trace_id":"8e62fe652ea179aa82e309fb4c0331ad","span_id":"3af25ecd7d2b930c","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","request_id":"8e62fe652ea179aa82e309fb4c0331ad","trace_id":"8e62fe652ea179aa82e309fb4c0331ad","span_id":"3af25ecd7d2b930c","parent_span_id":"","method":"POST","path":"/refresh","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.009083792}
--- PASS: TestOAuthHandler_Integration (0.11s)
    --- PASS: TestOAuthHandler_Integration/GoogleLogin (0.00s)
    --- PASS: TestOAuthHandler_Integration/GoogleCallback (0.05s)
    --- PASS: TestOAuthHandler_Integration/ClientCredentials (0.02s)
    --- PASS: TestOAuthHandler_Integration/CreateOneTimeToken (0.02s)
    --- PASS: TestOAuthHandler_Integration/VerifyOneTimeToken (0.01s)
    --- PASS: TestOAuthHandler_Integration/RefreshSession (0.01s)
FAIL
coverage: 36.4% of statements
FAIL	auth-service/internal/handler/rest	1.765s
=== RUN   TestNewLogger
--- PASS: TestNewLogger (0.00s)
=== RUN   TestLogger_WithRequest
--- PASS: TestLogger_WithRequest (0.00s)
=== RUN   TestLogger_WithRequest_NoHeaders
--- PASS: TestLogger_WithRequest_NoHeaders (0.00s)
=== RUN   TestRequestLogger_Methods
{"level":"INFO","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger.go:147","message":"Request started","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","method":"GET","path":"/test","client_ip":"192.0.2.1:1234","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","parent_span_id":"","method":"GET","path":"/test","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":""}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger.go:180","message":"Request completed","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","method":"GET","path":"/test","client_ip":"192.0.2.1:1234","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","parent_span_id":"","method":"GET","path":"/test","client_ip":"192.0.2.1:1234","user_id":"","tenant_id":"","status":200,"duration":0.0000001}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger.go:186","message":"Authentication successful","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","method":"GET","path":"/test","client_ip":"192.0.2.1:1234","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","user_id":"user-123","tenant_id":"tenant-123","auth_method":"password","client_ip":"192.0.2.1:1234"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger.go:199","message":"Authentication failed","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","method":"GET","path":"/test","client_ip":"192.0.2.1:1234","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","user_id":"user-123","tenant_id":"tenant-123","auth_method":"password","reason":"invalid_credentials","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.(*RequestLogger).AuthFailure\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger.go:199\nauth-service/internal/logger.TestRequestLogger_Methods\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger_test.go:94\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger.go:227","message":"OAuth flow step completed","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","method":"GET","path":"/test","client_ip":"192.0.2.1:1234","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","provider":"google","step":"login_initiated","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger_test.go:98","message":"Security event","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","event_type":"login_attempt","user_id":"user-123","tenant_id":"tenant-123","details":"Multiple failed attempts","severity":"medium","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.TestRequestLogger_Methods\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger_test.go:98\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger_test.go:99","message":"Business event","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","event_type":"user_login","user_id":"user-123","tenant_id":"tenant-123","client_ip":"192.0.2.1:1234","login_method":"password","success":true}
{"level":"INFO","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger_test.go:103","message":"Test info message","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","method":"GET","path":"/test","client_ip":"192.0.2.1:1234"}
{"level":"WARN","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger_test.go:104","message":"Test warning message","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","method":"GET","path":"/test","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.TestRequestLogger_Methods\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger_test.go:104\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
{"level":"ERROR","timestamp":"2025-06-26T01:18:50.799+0530","caller":"logger/logger_test.go:105","message":"Test error message","request_id":"d9407254d31c695ee3e3ec1cd4eaeeab","trace_id":"d9407254d31c695ee3e3ec1cd4eaeeab","span_id":"ea0273493b0c41d5","method":"GET","path":"/test","client_ip":"192.0.2.1:1234","stacktrace":"auth-service/internal/logger.TestRequestLogger_Methods\n\t/Users/Licious/Desktop/repository/auth-service/internal/logger/logger_test.go:105\ntesting.tRunner\n\t/usr/local/go/src/testing/testing.go:1690"}
--- PASS: TestRequestLogger_Methods (0.00s)
PASS
coverage: 62.7% of statements
ok  	auth-service/internal/logger	1.740s	coverage: 62.7% of statements
=== RUN   TestActuatorMiddleware
--- PASS: TestActuatorMiddleware (0.00s)
=== RUN   TestHealthCheckMiddleware
--- PASS: TestHealthCheckMiddleware (0.00s)
=== RUN   TestRBACMiddleware_UserHasPermission_Success
--- PASS: TestRBACMiddleware_UserHasPermission_Success (0.00s)
=== RUN   TestRBACMiddleware_UserDoesNotHavePermission
--- PASS: TestRBACMiddleware_UserDoesNotHavePermission (0.00s)
=== RUN   TestRBACMiddleware_MissingUserID
--- PASS: TestRBACMiddleware_MissingUserID (0.00s)
=== RUN   TestRBACMiddleware_MissingTenantID
--- PASS: TestRBACMiddleware_MissingTenantID (0.00s)
=== RUN   TestRBACMiddleware_RBACServiceError
--- PASS: TestRBACMiddleware_RBACServiceError (0.00s)
=== RUN   TestRBACMiddleware_DifferentPermissions
--- PASS: TestRBACMiddleware_DifferentPermissions (0.00s)
=== RUN   TestRBACMiddleware_DifferentUsers
--- PASS: TestRBACMiddleware_DifferentUsers (0.00s)
=== RUN   TestRBACMiddleware_DifferentTenants
--- PASS: TestRBACMiddleware_DifferentTenants (0.00s)
PASS
coverage: 20.9% of statements
ok  	auth-service/internal/middleware	0.934s	coverage: 20.9% of statements
=== RUN   TestRole_Structure
--- PASS: TestRole_Structure (0.00s)
=== RUN   TestRole_DefaultRole
--- PASS: TestRole_DefaultRole (0.00s)
=== RUN   TestPermission_Structure
--- PASS: TestPermission_Structure (0.00s)
=== RUN   TestRolePermission_Structure
--- PASS: TestRolePermission_Structure (0.00s)
=== RUN   TestUserRole_Structure
--- PASS: TestUserRole_Structure (0.00s)
=== RUN   TestServiceRole_Structure
--- PASS: TestServiceRole_Structure (0.00s)
=== RUN   TestRole_EmptyFields
--- PASS: TestRole_EmptyFields (0.00s)
=== RUN   TestPermission_EmptyFields
--- PASS: TestPermission_EmptyFields (0.00s)
=== RUN   TestRolePermission_EmptyFields
--- PASS: TestRolePermission_EmptyFields (0.00s)
=== RUN   TestUserRole_EmptyFields
--- PASS: TestUserRole_EmptyFields (0.00s)
=== RUN   TestServiceRole_EmptyFields
--- PASS: TestServiceRole_EmptyFields (0.00s)
=== RUN   TestRole_ComplexName
--- PASS: TestRole_ComplexName (0.00s)
=== RUN   TestPermission_ComplexName
--- PASS: TestPermission_ComplexName (0.00s)
=== RUN   TestRole_WithSpecialCharacters
--- PASS: TestRole_WithSpecialCharacters (0.00s)
=== RUN   TestPermission_WithSpecialCharacters
--- PASS: TestPermission_WithSpecialCharacters (0.00s)
=== RUN   TestRolePermission_WithSpecialCharacters
--- PASS: TestRolePermission_WithSpecialCharacters (0.00s)
=== RUN   TestUserRole_WithSpecialCharacters
--- PASS: TestUserRole_WithSpecialCharacters (0.00s)
=== RUN   TestServiceRole_WithSpecialCharacters
--- PASS: TestServiceRole_WithSpecialCharacters (0.00s)
=== RUN   TestRole_Validation
=== RUN   TestRole_Validation/Valid_role
=== RUN   TestRole_Validation/Empty_ID
=== RUN   TestRole_Validation/Empty_TenantID
=== RUN   TestRole_Validation/Empty_Name
--- PASS: TestRole_Validation (0.00s)
    --- PASS: TestRole_Validation/Valid_role (0.00s)
    --- PASS: TestRole_Validation/Empty_ID (0.00s)
    --- PASS: TestRole_Validation/Empty_TenantID (0.00s)
    --- PASS: TestRole_Validation/Empty_Name (0.00s)
=== RUN   TestPermission_Validation
=== RUN   TestPermission_Validation/Valid_permission
=== RUN   TestPermission_Validation/Empty_ID
=== RUN   TestPermission_Validation/Empty_Name
--- PASS: TestPermission_Validation (0.00s)
    --- PASS: TestPermission_Validation/Valid_permission (0.00s)
    --- PASS: TestPermission_Validation/Empty_ID (0.00s)
    --- PASS: TestPermission_Validation/Empty_Name (0.00s)
=== RUN   TestRolePermission_Validation
=== RUN   TestRolePermission_Validation/Valid_role_permission
=== RUN   TestRolePermission_Validation/Empty_RoleID
=== RUN   TestRolePermission_Validation/Empty_PermissionID
--- PASS: TestRolePermission_Validation (0.00s)
    --- PASS: TestRolePermission_Validation/Valid_role_permission (0.00s)
    --- PASS: TestRolePermission_Validation/Empty_RoleID (0.00s)
    --- PASS: TestRolePermission_Validation/Empty_PermissionID (0.00s)
=== RUN   TestUserRole_Validation
=== RUN   TestUserRole_Validation/Valid_user_role
=== RUN   TestUserRole_Validation/Empty_UserID
=== RUN   TestUserRole_Validation/Empty_RoleID
=== RUN   TestUserRole_Validation/Empty_TenantID
--- PASS: TestUserRole_Validation (0.00s)
    --- PASS: TestUserRole_Validation/Valid_user_role (0.00s)
    --- PASS: TestUserRole_Validation/Empty_UserID (0.00s)
    --- PASS: TestUserRole_Validation/Empty_RoleID (0.00s)
    --- PASS: TestUserRole_Validation/Empty_TenantID (0.00s)
=== RUN   TestServiceRole_Validation
=== RUN   TestServiceRole_Validation/Valid_service_role
=== RUN   TestServiceRole_Validation/Empty_ServiceID
=== RUN   TestServiceRole_Validation/Empty_RoleID
=== RUN   TestServiceRole_Validation/Empty_TenantID
--- PASS: TestServiceRole_Validation (0.00s)
    --- PASS: TestServiceRole_Validation/Valid_service_role (0.00s)
    --- PASS: TestServiceRole_Validation/Empty_ServiceID (0.00s)
    --- PASS: TestServiceRole_Validation/Empty_RoleID (0.00s)
    --- PASS: TestServiceRole_Validation/Empty_TenantID (0.00s)
PASS
coverage: 0.0% of statements
ok  	auth-service/internal/models	1.485s	coverage: 0.0% of statements
=== RUN   TestTenantBasedOTPDigitLength
=== RUN   TestTenantBasedOTPDigitLength/Basic_tenant_should_have_4-digit_OTP
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 1245 to test@example.com (tenant: tenant-basic)
=== RUN   TestTenantBasedOTPDigitLength/Pro_tenant_should_have_6-digit_OTP
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 100045 to test@example.com (tenant: tenant-pro)
=== RUN   TestTenantBasedOTPDigitLength/Enterprise_tenant_should_have_8-digit_OTP
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 10000171 to test@example.com (tenant: tenant-enterprise)
=== RUN   TestTenantBasedOTPDigitLength/Unknown_tenant_should_default_to_6-digit_OTP
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 100211 to test@example.com (tenant: unknown-tenant)
--- PASS: TestTenantBasedOTPDigitLength (0.00s)
    --- PASS: TestTenantBasedOTPDigitLength/Basic_tenant_should_have_4-digit_OTP (0.00s)
    --- PASS: TestTenantBasedOTPDigitLength/Pro_tenant_should_have_6-digit_OTP (0.00s)
    --- PASS: TestTenantBasedOTPDigitLength/Enterprise_tenant_should_have_8-digit_OTP (0.00s)
    --- PASS: TestTenantBasedOTPDigitLength/Unknown_tenant_should_default_to_6-digit_OTP (0.00s)
=== RUN   TestOTPDigitLengthValidation
=== RUN   TestOTPDigitLengthValidation/Invalid_length_0
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 100172 to test@example.com (tenant: test-tenant)
    otp_service_test.go:102: Expected error for invalid digit length 0, but got none
=== RUN   TestOTPDigitLengthValidation/Invalid_length_1
=== RUN   TestOTPDigitLengthValidation/Invalid_length_2
=== RUN   TestOTPDigitLengthValidation/Invalid_length_3
=== RUN   TestOTPDigitLengthValidation/Invalid_length_11
=== RUN   TestOTPDigitLengthValidation/Invalid_length_15
=== RUN   TestOTPDigitLengthValidation/Valid_length_4
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 1174 to test@example.com (tenant: test-tenant)
=== RUN   TestOTPDigitLengthValidation/Valid_length_6
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 100058 to test@example.com (tenant: test-tenant)
=== RUN   TestOTPDigitLengthValidation/Valid_length_8
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 10000071 to test@example.com (tenant: test-tenant)
=== RUN   TestOTPDigitLengthValidation/Valid_length_10
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 1000000050 to test@example.com (tenant: test-tenant)
--- FAIL: TestOTPDigitLengthValidation (0.00s)
    --- FAIL: TestOTPDigitLengthValidation/Invalid_length_0 (0.00s)
    --- PASS: TestOTPDigitLengthValidation/Invalid_length_1 (0.00s)
    --- PASS: TestOTPDigitLengthValidation/Invalid_length_2 (0.00s)
    --- PASS: TestOTPDigitLengthValidation/Invalid_length_3 (0.00s)
    --- PASS: TestOTPDigitLengthValidation/Invalid_length_11 (0.00s)
    --- PASS: TestOTPDigitLengthValidation/Invalid_length_15 (0.00s)
    --- PASS: TestOTPDigitLengthValidation/Valid_length_4 (0.00s)
    --- PASS: TestOTPDigitLengthValidation/Valid_length_6 (0.00s)
    --- PASS: TestOTPDigitLengthValidation/Valid_length_8 (0.00s)
    --- PASS: TestOTPDigitLengthValidation/Valid_length_10 (0.00s)
=== RUN   TestOTPGenerationWithDifferentLengths
=== RUN   TestOTPGenerationWithDifferentLengths/Length_4
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 1137 to test@example.com (tenant: test-tenant)
=== RUN   TestOTPGenerationWithDifferentLengths/Length_6
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 100095 to test@example.com (tenant: test-tenant)
=== RUN   TestOTPGenerationWithDifferentLengths/Length_8
2025/06/26 01:18:51 [OTP-EMAIL] Sent OTP 10000026 to test@example.com (tenant: test-tenant)
--- PASS: TestOTPGenerationWithDifferentLengths (0.00s)
    --- PASS: TestOTPGenerationWithDifferentLengths/Length_4 (0.00s)
    --- PASS: TestOTPGenerationWithDifferentLengths/Length_6 (0.00s)
    --- PASS: TestOTPGenerationWithDifferentLengths/Length_8 (0.00s)
=== RUN   TestTriggerTwoFactorAuth
=== RUN   TestTriggerTwoFactorAuth/Successful_2FA_trigger
2025/06/26 01:18:51 [2FA] Triggered EMAIL 2FA for user user-123 (client: tenant-pro, message_id: test-message-id)
=== RUN   TestTriggerTwoFactorAuth/Invalid_subscription
=== RUN   TestTriggerTwoFactorAuth/Feature_disabled
=== RUN   TestTriggerTwoFactorAuth/Quota_exceeded
=== RUN   TestTriggerTwoFactorAuth/Invalid_channel
=== RUN   TestTriggerTwoFactorAuth/Subscription_service_error
=== RUN   TestTriggerTwoFactorAuth/Notification_service_error
=== RUN   TestTriggerTwoFactorAuth/Different_tenant_configurations
=== RUN   TestTriggerTwoFactorAuth/Different_tenant_configurations/Tenant_tenant-basic
2025/06/26 01:18:51 [2FA] Triggered EMAIL 2FA for user user-123 (client: tenant-basic, message_id: test-message-id)
=== RUN   TestTriggerTwoFactorAuth/Different_tenant_configurations/Tenant_tenant-pro
2025/06/26 01:18:51 [2FA] Triggered EMAIL 2FA for user user-123 (client: tenant-pro, message_id: test-message-id)
=== RUN   TestTriggerTwoFactorAuth/Different_tenant_configurations/Tenant_tenant-enterprise
2025/06/26 01:18:51 [2FA] Triggered EMAIL 2FA for user user-123 (client: tenant-enterprise, message_id: test-message-id)
=== RUN   TestTriggerTwoFactorAuth/Different_tenant_configurations/Tenant_unknown-tenant
2025/06/26 01:18:51 [2FA] Triggered EMAIL 2FA for user user-123 (client: unknown-tenant, message_id: test-message-id)
--- PASS: TestTriggerTwoFactorAuth (0.00s)
    --- PASS: TestTriggerTwoFactorAuth/Successful_2FA_trigger (0.00s)
    --- PASS: TestTriggerTwoFactorAuth/Invalid_subscription (0.00s)
    --- PASS: TestTriggerTwoFactorAuth/Feature_disabled (0.00s)
    --- PASS: TestTriggerTwoFactorAuth/Quota_exceeded (0.00s)
    --- PASS: TestTriggerTwoFactorAuth/Invalid_channel (0.00s)
    --- PASS: TestTriggerTwoFactorAuth/Subscription_service_error (0.00s)
    --- PASS: TestTriggerTwoFactorAuth/Notification_service_error (0.00s)
    --- PASS: TestTriggerTwoFactorAuth/Different_tenant_configurations (0.00s)
        --- PASS: TestTriggerTwoFactorAuth/Different_tenant_configurations/Tenant_tenant-basic (0.00s)
        --- PASS: TestTriggerTwoFactorAuth/Different_tenant_configurations/Tenant_tenant-pro (0.00s)
        --- PASS: TestTriggerTwoFactorAuth/Different_tenant_configurations/Tenant_tenant-enterprise (0.00s)
        --- PASS: TestTriggerTwoFactorAuth/Different_tenant_configurations/Tenant_unknown-tenant (0.00s)
=== RUN   TestRBACService_AssignRoleToUser_Success
--- PASS: TestRBACService_AssignRoleToUser_Success (0.00s)
=== RUN   TestRBACService_AssignRoleToUser_Error
--- PASS: TestRBACService_AssignRoleToUser_Error (0.00s)
=== RUN   TestRBACService_AssignRoleToService_Success
--- PASS: TestRBACService_AssignRoleToService_Success (0.00s)
=== RUN   TestRBACService_AssignRoleToService_Error
--- PASS: TestRBACService_AssignRoleToService_Error (0.00s)
=== RUN   TestRBACService_AssignPermissionToRole_Success
--- PASS: TestRBACService_AssignPermissionToRole_Success (0.00s)
=== RUN   TestRBACService_AssignPermissionToRole_Error
--- PASS: TestRBACService_AssignPermissionToRole_Error (0.00s)
=== RUN   TestRBACService_UserHasPermission_Success
--- PASS: TestRBACService_UserHasPermission_Success (0.00s)
=== RUN   TestRBACService_UserHasPermission_NoPermission
--- PASS: TestRBACService_UserHasPermission_NoPermission (0.00s)
=== RUN   TestRBACService_UserHasPermission_Error
--- PASS: TestRBACService_UserHasPermission_Error (0.00s)
=== RUN   TestRBACService_ServiceHasPermission_Success
--- PASS: TestRBACService_ServiceHasPermission_Success (0.00s)
=== RUN   TestRBACService_ServiceHasPermission_NoPermission
--- PASS: TestRBACService_ServiceHasPermission_NoPermission (0.00s)
=== RUN   TestRBACService_ServiceHasPermission_Error
--- PASS: TestRBACService_ServiceHasPermission_Error (0.00s)
=== RUN   TestRBACService_GetUserRoles_Success
--- PASS: TestRBACService_GetUserRoles_Success (0.00s)
=== RUN   TestRBACService_GetUserRoles_Error
--- PASS: TestRBACService_GetUserRoles_Error (0.00s)
=== RUN   TestRBACService_GetRolePermissions_Success
--- PASS: TestRBACService_GetRolePermissions_Success (0.00s)
=== RUN   TestRBACService_GetRolePermissions_Error
--- PASS: TestRBACService_GetRolePermissions_Error (0.00s)
=== RUN   TestRBACService_Integration_UserRoleAssignment
--- PASS: TestRBACService_Integration_UserRoleAssignment (0.00s)
=== RUN   TestRBACService_Integration_ServiceRoleAssignment
--- PASS: TestRBACService_Integration_ServiceRoleAssignment (0.00s)
FAIL
coverage: 32.2% of statements
FAIL	auth-service/internal/service	2.215s
=== RUN   TestExtractTracingFromRequest_StandardHeaders
--- PASS: TestExtractTracingFromRequest_StandardHeaders (0.00s)
=== RUN   TestExtractTracingFromRequest_XRayHeaders
--- PASS: TestExtractTracingFromRequest_XRayHeaders (0.00s)
=== RUN   TestExtractTracingFromRequest_CloudTraceHeaders
--- PASS: TestExtractTracingFromRequest_CloudTraceHeaders (0.00s)
=== RUN   TestExtractTracingFromRequest_RequestIDFallback
--- PASS: TestExtractTracingFromRequest_RequestIDFallback (0.00s)
=== RUN   TestExtractTracingFromRequest_NoHeaders
--- PASS: TestExtractTracingFromRequest_NoHeaders (0.00s)
=== RUN   TestExtractXRayTraceID
=== RUN   TestExtractXRayTraceID/valid_xray_header
=== RUN   TestExtractXRayTraceID/xray_header_without_parent
=== RUN   TestExtractXRayTraceID/invalid_xray_header
=== RUN   TestExtractXRayTraceID/empty_header
--- PASS: TestExtractXRayTraceID (0.00s)
    --- PASS: TestExtractXRayTraceID/valid_xray_header (0.00s)
    --- PASS: TestExtractXRayTraceID/xray_header_without_parent (0.00s)
    --- PASS: TestExtractXRayTraceID/invalid_xray_header (0.00s)
    --- PASS: TestExtractXRayTraceID/empty_header (0.00s)
=== RUN   TestExtractXRaySpanID
=== RUN   TestExtractXRaySpanID/valid_xray_header_with_parent
=== RUN   TestExtractXRaySpanID/xray_header_without_parent
=== RUN   TestExtractXRaySpanID/invalid_xray_header
--- PASS: TestExtractXRaySpanID (0.00s)
    --- PASS: TestExtractXRaySpanID/valid_xray_header_with_parent (0.00s)
    --- PASS: TestExtractXRaySpanID/xray_header_without_parent (0.00s)
    --- PASS: TestExtractXRaySpanID/invalid_xray_header (0.00s)
=== RUN   TestExtractCloudTraceID
=== RUN   TestExtractCloudTraceID/valid_cloud_trace_header
=== RUN   TestExtractCloudTraceID/cloud_trace_header_without_span
=== RUN   TestExtractCloudTraceID/invalid_cloud_trace_header
=== RUN   TestExtractCloudTraceID/empty_header
--- PASS: TestExtractCloudTraceID (0.00s)
    --- PASS: TestExtractCloudTraceID/valid_cloud_trace_header (0.00s)
    --- PASS: TestExtractCloudTraceID/cloud_trace_header_without_span (0.00s)
    --- PASS: TestExtractCloudTraceID/invalid_cloud_trace_header (0.00s)
    --- PASS: TestExtractCloudTraceID/empty_header (0.00s)
=== RUN   TestGenerateTraceID
--- PASS: TestGenerateTraceID (0.00s)
=== RUN   TestGenerateSpanID
--- PASS: TestGenerateSpanID (0.00s)
=== RUN   TestAddTracingHeaders
--- PASS: TestAddTracingHeaders (0.00s)
=== RUN   TestGetTracingContextFromContext
--- PASS: TestGetTracingContextFromContext (0.00s)
=== RUN   TestCreateSpan
--- PASS: TestCreateSpan (0.00s)
=== RUN   TestPropagateTracing
--- PASS: TestPropagateTracing (0.00s)
=== RUN   TestTracingContext_String
--- PASS: TestTracingContext_String (0.00s)
=== RUN   TestExtractTracingFromRequest_PriorityOrder
--- PASS: TestExtractTracingFromRequest_PriorityOrder (0.00s)
=== RUN   TestExtractTracingFromRequest_RequestIDPriority
--- PASS: TestExtractTracingFromRequest_RequestIDPriority (0.00s)
PASS
coverage: 89.7% of statements
ok  	auth-service/internal/tracing	1.952s	coverage: 89.7% of statements
FAIL
